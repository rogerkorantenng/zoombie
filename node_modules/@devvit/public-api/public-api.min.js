var Qc=Object.create;var pd=Object.defineProperty;var Yc=Object.getOwnPropertyDescriptor;var em=Object.getOwnPropertyNames;var tm=Object.getPrototypeOf,im=Object.prototype.hasOwnProperty;var gd=i=>{throw TypeError(i)};var di=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var rm=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of em(e))!im.call(i,s)&&s!==t&&pd(i,s,{get:()=>e[s],enumerable:!(r=Yc(e,s))||r.enumerable});return i};var hd=(i,e,t)=>(t=i!=null?Qc(tm(i)):{},rm(e||!i||!i.__esModule?pd(t,"default",{value:i,enumerable:!0}):t,i));var $o=(i,e,t)=>e.has(i)||gd("Cannot "+t);var n=(i,e,t)=>($o(i,e,"read from private field"),t?t.call(i):e.get(i)),l=(i,e,t)=>e.has(i)?gd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),d=(i,e,t,r)=>($o(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),h=(i,e,t)=>($o(i,e,"access private method"),t);var fd=(i,e,t,r)=>({set _(s){d(i,e,s,t)},get _(){return n(i,e,r)}});var Sa=di((sv,Ul)=>{var kp=Object.prototype.toString;Ul.exports=function(e){if(e===void 0)return"undefined";if(e===null)return"null";var t=typeof e;if(t==="boolean")return"boolean";if(t==="string")return"string";if(t==="number")return"number";if(t==="symbol")return"symbol";if(t==="function")return Fp(e)?"generatorfunction":"function";if(Cp(e))return"array";if(Tp(e))return"buffer";if(Ip(e))return"arguments";if(Sp(e))return"date";if(Pp(e))return"error";if(wp(e))return"regexp";switch(Ol(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(xp(e))return"generator";switch(t=kp.call(e),t){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function Ol(i){return typeof i.constructor=="function"?i.constructor.name:null}function Cp(i){return Array.isArray?Array.isArray(i):i instanceof Array}function Pp(i){return i instanceof Error||typeof i.message=="string"&&i.constructor&&typeof i.constructor.stackTraceLimit=="number"}function Sp(i){return i instanceof Date?!0:typeof i.toDateString=="function"&&typeof i.getDate=="function"&&typeof i.setDate=="function"}function wp(i){return i instanceof RegExp?!0:typeof i.flags=="string"&&typeof i.ignoreCase=="boolean"&&typeof i.multiline=="boolean"&&typeof i.global=="boolean"}function Fp(i,e){return Ol(i)==="GeneratorFunction"}function xp(i){return typeof i.throw=="function"&&typeof i.return=="function"&&typeof i.next=="function"}function Ip(i){try{if(typeof i.length=="number"&&typeof i.callee=="function")return!0}catch(e){if(e.message.indexOf("callee")!==-1)return!0}return!1}function Tp(i){return i.constructor&&typeof i.constructor.isBuffer=="function"?i.constructor.isBuffer(i):!1}});var Bl=di((ov,Dl)=>{"use strict";var Ml=Symbol.prototype.valueOf,Ap=Sa();function Ep(i,e){switch(Ap(i)){case"array":return i.slice();case"object":return Object.assign({},i);case"date":return new i.constructor(Number(i));case"map":return new Map(i);case"set":return new Set(i);case"buffer":return Mp(i);case"symbol":return Dp(i);case"arraybuffer":return Op(i);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return Up(i);case"regexp":return Rp(i);case"error":return Object.create(i);default:return i}}function Rp(i){let e=i.flags!==void 0?i.flags:/\w+$/.exec(i)||void 0,t=new i.constructor(i.source,e);return t.lastIndex=i.lastIndex,t}function Op(i){let e=new i.constructor(i.byteLength);return new Uint8Array(e).set(new Uint8Array(i)),e}function Up(i,e){return new i.constructor(i.buffer,i.byteOffset,i.length)}function Mp(i){let e=i.length,t=Buffer.allocUnsafe?Buffer.allocUnsafe(e):Buffer.from(e);return i.copy(t),t}function Dp(i){return Ml?Object(Ml.call(i)):{}}Dl.exports=Ep});var Ll=di((av,Nl)=>{"use strict";Nl.exports=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}});var jl=di((dv,Hl)=>{"use strict";var Bp=Ll();function _l(i){return Bp(i)===!0&&Object.prototype.toString.call(i)==="[object Object]"}Hl.exports=function(e){var t,r;return!(_l(e)===!1||(t=e.constructor,typeof t!="function")||(r=t.prototype,_l(r)===!1)||r.hasOwnProperty("isPrototypeOf")===!1)}});var Vl=di((lv,Wl)=>{"use strict";var Np=Bl(),Lp=Sa(),_p=jl();function wa(i,e){switch(Lp(i)){case"object":return Hp(i,e);case"array":return jp(i,e);default:return Np(i)}}function Hp(i,e){if(typeof e=="function")return e(i);if(e||_p(i)){let t=new i.constructor;for(let r in i)t[r]=wa(i[r],e);return t}return i}function jp(i,e){let t=new i.constructor(i.length);for(let r=0;r<i.length;r++)t[r]=wa(i[r],e);return t}Wl.exports=wa});var Mc=di(Bo=>{"use strict";Bo.byteLength=fg;Bo.toByteArray=bg;Bo.fromByteArray=Cg;var De=[],Se=[],hg=typeof Uint8Array<"u"?Uint8Array:Array,td="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Qt=0,Oc=td.length;Qt<Oc;++Qt)De[Qt]=td[Qt],Se[td.charCodeAt(Qt)]=Qt;var Qt,Oc;Se[45]=62;Se[95]=63;function Uc(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=i.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function fg(i){var e=Uc(i),t=e[0],r=e[1];return(t+r)*3/4-r}function yg(i,e,t){return(e+t)*3/4-t}function bg(i){var e,t=Uc(i),r=t[0],s=t[1],o=new hg(yg(i,r,s)),a=0,c=s>0?r-4:r,m;for(m=0;m<c;m+=4)e=Se[i.charCodeAt(m)]<<18|Se[i.charCodeAt(m+1)]<<12|Se[i.charCodeAt(m+2)]<<6|Se[i.charCodeAt(m+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=e&255;return s===2&&(e=Se[i.charCodeAt(m)]<<2|Se[i.charCodeAt(m+1)]>>4,o[a++]=e&255),s===1&&(e=Se[i.charCodeAt(m)]<<10|Se[i.charCodeAt(m+1)]<<4|Se[i.charCodeAt(m+2)]>>2,o[a++]=e>>8&255,o[a++]=e&255),o}function vg(i){return De[i>>18&63]+De[i>>12&63]+De[i>>6&63]+De[i&63]}function kg(i,e,t){for(var r,s=[],o=e;o<t;o+=3)r=(i[o]<<16&16711680)+(i[o+1]<<8&65280)+(i[o+2]&255),s.push(vg(r));return s.join("")}function Cg(i){for(var e,t=i.length,r=t%3,s=[],o=16383,a=0,c=t-r;a<c;a+=o)s.push(kg(i,a,a+o>c?c:a+o));return r===1?(e=i[t-1],s.push(De[e>>2]+De[e<<4&63]+"==")):r===2&&(e=(i[t-2]<<8)+i[t-1],s.push(De[e>>10]+De[e>>4&63]+De[e<<2&63]+"=")),s.join("")}});var te={APP:0,USER:1,UNSPECIFIED:2};import{Scope as Ag}from"@devvit/protos/json/reddit/devvit/app_permission/v1/app_permission.js";function p(i,e){if(i==null)throw Error(e??"Expected nonnullish value.")}import*as k from"@devvit/protos";import{Scope as tn}from"@devvit/protos/json/reddit/devvit/app_permission/v1/app_permission.js";var Zs=class{constructor(e){}};var nm=/\.[a-zA-Z]{2,}$/;function yd(i){if(i.length>25)throw new Error("The size of requestedFetchDomains is limited to 25 domains.")}function bd(i){let e=new Set;for(let t of i)try{if(!nm.test(t))throw new Error("The domain does not have a valid top-level domain.");t.includes("://")||(t="http://"+t);let s=new URL(t).hostname.replace(/^www\./,"");e.add(s)}catch(r){throw new Error(`Failed to determine hostname from requested domain: '${t}'. ${r}`)}return Array.from(e)}import"@devvit/protos/json/devvit/events/v1alpha/events.js";import{DeletionReason as rh,EventSource as nh}from"@devvit/protos/json/devvit/events/v1alpha/events.js";import{CrowdControlLevel as oh,DistinguishType as ah}from"@devvit/protos/json/devvit/reddit/v2alpha/postv2.js";import{SubredditRating as lh,SubredditType as uh}from"@devvit/protos/json/devvit/reddit/v2alpha/subredditv2.js";var ze;(function(i){i.Installation="installation",i.App="app"})(ze||(ze={}));function $e(i,e){if(!i)throw Error(e)}var vd;(function(i){i.COMMENT="t1_",i.ACCOUNT="t2_",i.LINK="t3_",i.MESSAGE="t4_",i.SUBREDDIT="t5_",i.AWARD="t6_"})(vd||(vd={}));function Ut(i,e=new Set){for(let t of i){if(t.type==="group"){Ut(t.fields,e);continue}let r=t.name;if(e.has(r))throw new Error(`Duplicate field name: ${r}`);e.add(r)}sm(i)}function sm(i){for(let e of i)if(e.type==="string"&&e.isSecret&&e.scope!==ze.App)throw`Invalid setting: only app settings can be secrets. Add "scope: SettingScope.App" to field "${e.name}"`}var qe=Object.freeze({INTERVAL:0,FORM:1,STATE:2,CHANNEL:3,WEB_VIEW:4});var Ah=["3rd-party","a11y","activity","add-emoji","add","add-filter","add-media","add-to-feed","admin","ads","ai","align-center","align-left","align-right","all","ama","answers","appearance","approve","archived","aspect-ratio-12","aspect-ratio","aspect-rectangle","attach","audience","audio","author","automod","avatar-style","award","back","backup","ban","best","beta-advertise-2","beta-advertise-3","beta-advertise-4","beta-advertise-5","binoculars","block","blockchain","bold","boost","bot","bounce","brand-awareness","browse","browser","business","cake","calendar","camera","campaign","caret-down","caret-left","caret-right","caret-up","caret-updown","chat","chat-group","chat-new","chat-private","checkbox-dismiss","checkbox","checkmark","chrome","clear","client-list","close","closed-captioning","club-12","club","code-block","code-inline","coins-color-old","coins","collapse-left","collapse-right","collectible-expressions","collection","comment","comments","communities","community","confidence","confidence-outline-null","contest","controversial","conversion","copy-clipboard","crop","crosspost","crowd-control","custom-feed","customize","dashboard","day","delete-column","delete","delete-row","devvit","discover","dismiss-all","distinguish","down-arrow","down","download","downvote","downvotes","drag","drugs","duplicate","edit","effect","embed","emoji","end-live-chat","error","expand-left-12","expand-left","expand-right-12","expand-right","external","feed-video","filter","fork","format","forward","funnel","gif-post","gold","happy-face","hashtag","heart","help","hide","history","home","hot","ignore-reports","image-post","inbox","infinity-12","infinity","info","insert-column-left","insert-column-right","insert-row-above","insert-row-below","internet","invite","italic","join","joined","jump-down","jump-up","karma","keyboard","keyword","kick","language","leave","left","line-graph","link","link-post","list-bulleted","list-numbered","live-chat","live","load","location","lock","logout","loop","macro","mark-read","marketplace","mask","media-gallery","meme","menu","merge","message","mic","mic-mute","mod","mod-mail","mod-mode","mod-mute","mod-overflow","mod-queue","mod-unmute","music","mute","neutral-face","new","new-guide","night","no-internet","notification","notification-frequent","notification-off","nsfw-alt","nsfw","nsfw-language","nsfw-violence","official","original","overflow-caret","overflow-horizontal","overflow-vertical","partner-community","pause","payment","peace","pending-posts","phone","pin","planet","play","poll-post","popular","posts","powerup","predictions","premium","privacy","profile","qa","qr-code","quarantined","quote","r-slash","radar","radio-button","raise-hand","random","ratings-everyone","ratings-mature","ratings-nsfw","ratings-violence","recovery-phrase","refresh","removal-reasons","remove","reply","report","reverse","rich-text","right","rising","rotate","rotate-image","rpan","rules","sad-face","safari","save","save-view","saved","saved-response","search","self","send","settings","severity","share-android","share","share-ios","share-new","show","side-menu","skipback10","skipforward10","sort-az","sort","sort-price","sort-za","spam","spoiler","sponsored","spreadsheet","star","statistics","status-live","sticker","strikethrough","subtract","superscript","swap-camera","swipe-back","swipe-down","swipe","swipe-up","table","tag","tap","telescope","text","text-post","text-size","thumbs-down","thumbs-up","toggle","tools","top","topic-activism","topic-addictionsupport","topic-advice","topic-animals","topic-anime","topic-art","topic-beauty","topic-business","topic-careers","topic-cars","topic-celebrity","topic-craftsdiy","topic-crypto","topic-culture","topic-diy","topic-entertainment","topic-ethics","topic-family","topic-fashion","topic","topic-fitness","topic-food","topic-funny","topic-gender","topic-health","topic-help","topic-history","topic-hobbies","topic-homegarden","topic-internet","topic-law","topic-learning","topic-lifestyle","topic-marketplace","topic-mature","topic-mensfashion","topic-menshealth","topic-meta","topic-military","topic-movies","topic-music","topic-news","topic-other","topic-outdoors","topic-pets","topic-photography","topic-places","topic-podcasts","topic-politics","topic-programming","topic-reading","topic-religion","topic-science","topic-sexorientation","topic-sports","topic-style","topic-tabletop","topic-technology","topic-television","topic-traumasupport","topic-travel","topic-videogaming","topic-womensfashion","topic-womenshealth","translate","translation-off","trim","u-slash","unban","undo","unheart","unlock","unmod","unpin","unstar","unverified","up-arrow","up","upload","upvote","upvotes","user","user-note","users","vault","verified","video-camera","video-feed","video-live","video-post","video-thread","video-transcription","view-card","view-classic","view-compact","view-grid","view-sort","views","voiceover","volume","wallet","warning","webhook","whale","wiki-ban","wiki","wiki-unban","world","coins-color","powerup-color","powerup-fill-color","video-live-1","video-live-fill-1"];import{DeletionReason as Uh,EventSource as Mh}from"@devvit/protos";import{AppSettingsDefinition as Em,GetFieldsResponse as Rm}from"@devvit/protos";import{FormFieldType as fe}from"@devvit/protos";function Ne(i){return i.map(e=>{switch(e.type){case"string":return om(e);case"image":return am(e);case"paragraph":return dm(e);case"number":return lm(e);case"select":return um(e);case"boolean":return cm(e);case"group":return mm(e);default:throw new Error("Unknown field type.")}})}function om(i){return{defaultValue:{fieldType:fe.STRING,stringValue:i.defaultValue},disabled:i.disabled,fieldConfig:{stringConfig:{placeholder:i.placeholder}},fieldId:i.name,fieldType:fe.STRING,helpText:i.helpText,label:i.label,required:i.required,isSecret:i.isSecret}}function am(i){return{disabled:i.disabled,fieldId:i.name,fieldType:fe.IMAGE,helpText:i.helpText,label:i.label,required:i.required}}function dm(i){return{defaultValue:{fieldType:fe.PARAGRAPH,stringValue:i.defaultValue},disabled:i.disabled,fieldConfig:{paragraphConfig:{lineHeight:i.lineHeight,placeholder:i.placeholder}},fieldId:i.name,fieldType:fe.PARAGRAPH,helpText:i.helpText,label:i.label,required:i.required}}function lm(i){return{defaultValue:{fieldType:fe.NUMBER,numberValue:i.defaultValue},disabled:i.disabled,fieldConfig:{numberConfig:{}},fieldId:i.name,fieldType:fe.NUMBER,helpText:i.helpText,label:i.label,required:i.required}}function um(i){return{defaultValue:{fieldType:fe.SELECTION,selectionValue:{values:i.defaultValue??[]}},disabled:i.disabled,fieldConfig:{selectionConfig:{choices:i.options,multiSelect:i.multiSelect}},fieldId:i.name,fieldType:fe.SELECTION,helpText:i.helpText,label:i.label,required:i.required}}function cm(i){return{defaultValue:{fieldType:fe.BOOLEAN,boolValue:i.defaultValue},disabled:i.disabled,fieldId:i.name,fieldType:fe.BOOLEAN,helpText:i.helpText,label:i.label}}function mm(i){return{fieldId:"",fieldType:fe.GROUP,fieldConfig:{groupConfig:{fields:Ne(i.fields)}},label:i.label,helpText:i.helpText}}function O(i,e){u.prototype[i]=e}import{ValidateFormResponse as Am}from"@devvit/protos";import{RealtimeSubscriptionStatus as Cd}from"@devvit/protos";var P=Object.freeze({Actor:"devvit-actor",App:"devvit-app",AppDependencies:"devvit-app-dependencies",AppUser:"devvit-app-user",AppViewerAuthToken:"devvit-app-viewer-authorization",Caller:"devvit-caller",CallerPortID:"devvit-caller-port-id",Canary:"devvit-canary",Context:"devvit-context",Debug:"devvit-debug",GQLHost:"devvit-gql-host",Installation:"devvit-installation",ModPermissions:"devvit-mod-permissions",Post:"devvit-post",PostAuthor:"devvit-post-author",PostData:"devvit-post-data",R2Auth:"devvit-sec-authorization",R2Host:"devvit-r2-host",RemoteHostname:"devvit-remote-hostname",SettingsUri:"devvit-sec-settings-uri",StreamID:"devvit-stream-id",Subreddit:"devvit-subreddit",SubredditName:"devvit-subreddit-name",TraceID:"devvit-trace-id",User:"devvit-user",Username:"devvit-user-name",UserSnoovatarUrl:"devvit-user-snoovatar-url",UserAgent:"devvit-user-agent",Version:"devvit-version",Language:"devvit-accept-language",Timezone:"devvit-accept-timezone",Traceparent:"traceparent"});var kd;(function(i){i.Blocks="blocks",i.EmitSnapshots="emitSnapshots",i.EmitState="emitState",i.Realtime="realtime",i.Runtime="runtime",i.Surface="surface",i.UseAsync="useAsync",i.Payments="payments",i.Bootstrap="bootstrap",i.WebView="webView"})(kd||(kd={}));function Pd(i){function e(t){let s=i.currentHookIndex,o=i.getCurrentComponentState(),a=i.getPreviousComponentState(),c=i.metadata[P.App]?.values[0];p(c,"useChannel - app is missing from Context");let m=i.metadata[P.Installation]?.values[0];p(m,"useChannel - installation is missing from Context");async function y(N){let B=o[s].channel;if(o[s].active)if(o[s].connected)await i.realtime.send(B,N);else throw Error(`Failed to send to channel '${B}'; it is active but not yet connected`);else throw Error(`Cannot send a message over inactive channel: ${B}`)}function v(){if(!o[s].active){let N=o[s].channel;o[s].active=!0,i.addRealtimeChannel(N)}}function f(){if(o[s].active){let N=o[s].channel;o[s].active=!1,i.removeRealtimeChannel(N)}}function S(N){return async()=>{let B;switch(N.status){case Cd.REALTIME_SUBSCRIBED:o[s].connected=!0,B=t.onSubscribed?.();break;case Cd.REALTIME_UNSUBSCRIBED:o[s].connected=!1,B=t.onUnsubscribed?.();break;default:B=t.onMessage(N.event?.data?.msg);break}await B}}let b={channel:`${c}:${m}:${t.name}`,active:!1,connected:!1,preventCallback:!1,type:qe.CHANNEL};s in o?b=o[s]:s in a&&(b=a[s]);let _=i.realtimeEvent;i.isInitialRender?b.active=!1:_&&b.active&&_.event.channel===b.channel&&(b.preventCallback||i.runHook(S(_)),i.rerenderIn(0)),o[s]=b,i.currentHookIndex++;let I=0;return b.active&&b.connected?I=2:b.active&&!b.connected?I=1:!b.active&&b.connected?I=3:!b.active&&!b.connected&&(I=4),{subscribe:v,unsubscribe:f,send:y,status:I}}return e}import{FormFieldType as li}from"@devvit/protos";function qo(i){switch(i.fieldType){case li.STRING:return i.stringValue;case li.IMAGE:return i.stringValue;case li.PARAGRAPH:return i.stringValue;case li.NUMBER:return i.numberValue;case li.BOOLEAN:return i.boolValue;case li.SELECTION:return i.selectionValue?.values??[];default:return}}function Ke(i){return Object.keys(i).reduce((e,t)=>{let r=qo(i[t]);return r!==void 0&&(e[t]=r),e},{})}function Sd(i){function e(t,r){let s=i.currentHookIndex,o=i.getCurrentComponentKey(),a=i.getCurrentComponentState(),c=i.getPreviousComponentState(),m=`form.hook.${o}.${s}`,y={formKey:m,preventSubmit:!1,type:qe.FORM};s in a?y=a[s]:s in c&&(y=c[s]),a[s]=y,i.forms.set(m,t);let v=i.formSubmittedEvent;return v&&!y.preventSubmit&&v.formId===m&&i.runHook(async()=>{let f=r(Ke(v.results));f&&f instanceof Promise&&await f,i.rerenderIn(0)}),a[s].preventSubmit=!1,i.currentHookIndex++,m}return e}function wd(i){function e(t,r){let s=i.currentHookIndex,o=i.getCurrentComponentState(),a=i.getPreviousComponentState(),c=100,m=Math.max(c,r),y={lastRun:void 0,running:!1,preventCallback:!1,type:qe.INTERVAL};s in o?y=o[s]:s in a&&(y=a[s]);function v(){r<c&&console.error(`useInterval delay must be at least ${c}ms. Your interval of ${r}ms was automatically extended.`);for(let[S,b]of Object.entries(o))if(S!==s.toString()&&b?.type===qe.INTERVAL&&b?.running)throw new Error("Only one useInterval hook may be running at a time");o[s]={running:!0,lastRun:o[s]?.lastRun??Date.now(),preventCallback:!1,type:qe.INTERVAL},i.rerenderIn(m)}function f(){o[s].running=!1,o[s].lastRun=void 0,o[s].preventCallback=!1}return i.isEffectRender&&y.running&&(y.preventCallback||(y.lastRun===void 0||y.lastRun+m<Date.now())&&i.runHook(async()=>{let S=t();S&&S instanceof Promise&&await S,y.lastRun=Date.now()}),i.rerenderIn(m)),y.preventCallback=!1,o[s]=y,i.currentHookIndex++,{start:v,stop:f}}return e}function Fd(i){function e(t){let r=i.currentHookIndex,s=i.getCurrentComponentState(),o=i.getPreviousComponentState();if(r in s)return i.currentHookIndex++,[s[r],a];if(i.isInitialRender||!(r in o)){let c=t instanceof Function?t():t;if(c instanceof Promise)throw(async()=>{s[r]=await c,i.currentHookIndex=0})();s[r]=c}else s[r]=o[r];function a(c){if(i.isRendering)throw new Error("Cannot call setState while rendering.");s[r]=c instanceof Function?c(s[r]):c}return i.currentHookIndex++,[s[r],a]}return e}var Qo={now(){return new Date}};function xd(i){return`__autocache__${i}`}function Id(i){return`__lock__${i}`}var gm=300,hm=1e3,Qs=5e3,Ko=3,Td=.1,Ad=1e3,fm=3e4;function Ed(i){if(i.error)throw new Error(i.error);return i.value}var Xe,Ze,ye,ui,z,Rd,Od,Ud,Xo,Md,Dd,Zo,Bd,Ys=class{constructor(e,t,r=Qo){l(this,z);l(this,Xe);l(this,Ze,{});l(this,ye);l(this,ui);d(this,Xe,e),d(this,ui,t),d(this,ye,r)}async cache(e,t){d(this,Ze,n(this,ui).__cache=n(this,ui).__cache??{}),h(this,z,Bd).call(this,t);let r=h(this,z,Rd).call(this,t.key);if(r!==void 0)return r;let s=await h(this,z,Zo).call(this,t.key),o=await h(this,z,Od).call(this,t,s,e);return Ed(o)}};Xe=new WeakMap,Ze=new WeakMap,ye=new WeakMap,ui=new WeakMap,z=new WeakSet,Rd=function(e){let t=n(this,Ze)[e];if(t){let r=n(this,ye).now().getTime(),s=t?.error&&t?.errorTime&&t.errorCount<Ko&&Math.random()<Td&&t.errorTime+Ad<r;if(t?.expires&&t.expires<r&&t.checkedAt+Ad<r||s){delete n(this,Ze)[e];return}else return Ed(t)}},Od=async function(e,t,r){let s=t?.expires,o=s?h(this,z,Dd).call(this,s):1;return!t||t?.error&&t.errorCount<Ko&&Td>Math.random()||o>Math.random()?h(this,z,Ud).call(this,e,t,r):t},Ud=async function(e,t,r){let s=Id(e.key),o=n(this,ye).now().getTime(),a=new Date(o+e.ttl/2);if(await n(this,Xe).set(s,"1",{expiration:a,nx:!0}))return h(this,z,Md).call(this,e.key,t,r,e.ttl);if(t)return t;{let m=n(this,ye).now();return h(this,z,Xo).call(this,m,e.key,e.ttl)}},Xo=async function(e,t,r){let s=Math.min(r,hm),o=await h(this,z,Zo).call(this,t);if(o)return o;if(n(this,ye).now().getTime()-e.getTime()>=s)throw new Error(`Cache request timed out trying to get data at key: ${t}`);return await new Promise(a=>setTimeout(a,gm)),h(this,z,Xo).call(this,e,t,r)},Md=async function(e,t,r,s){let o=n(this,ye).now().getTime()+s;t=t??{value:null,expires:o,errorCount:0,error:null,errorTime:null,checkedAt:0};try{t.value=await r(),t.error=null,t.errorCount=0,t.errorTime=null}catch(a){t.value=null,t.error=a.message??"Unknown error",t.errorTime=n(this,ye).now().getTime(),t.errorCount++}return n(this,Ze)[e]=t,await n(this,Xe).set(xd(e),JSON.stringify(t),{expiration:new Date(o+fm)}),t.error&&t.errorCount<Ko&&await n(this,Xe).del(Id(e)),t},Dd=function(e){let t=n(this,ye).now().getTime(),r=e-t;return r<0?1:r<1e3?.1:r<2e3?.01:r<3e3?.001:0},Zo=async function(e){let t=await n(this,Xe).get(xd(e));if(t){let r=JSON.parse(t);return r.checkedAt=n(this,ye).now().getTime(),n(this,Ze)[e]=r,r}},Bd=function(e){e.ttl<Qs&&(console.warn(`Cache TTL cannot be less than ${Qs} milliseconds! Updating ttl value of ${e.ttl} to ${Qs}.`),e.ttl=Qs)};function Nd(i,e,t=Qo){let r=new Ys(i,e,t);return r.cache.bind(r)}function Ld(i){new URL(i.slice(0,i.indexOf(",")))}var ci,pi,_d,Hd,mi=class{constructor(){l(this,pi);l(this,ci,{});d(this,ci,u.webViewAssets)}getURL(e,t){return typeof e=="string"?h(this,pi,_d).call(this,e,t??{webView:!1}):h(this,pi,Hd).call(this,e,t??{webView:!1})}};ci=new WeakMap,pi=new WeakSet,_d=function(e,t){let r=t.webView?n(this,ci)[e]:u.assets[e];if(r)return r;try{return Ld(e),e}catch{return""}},Hd=function(e,t){let r={},s=[],o=t.webView?n(this,ci):u.assets;if(o)for(let a of e)if(o[a])r[a]=o[a];else try{Ld(a),r[a]=a}catch{s.push(a)}else s=e;if(s.length>0)throw new Error(`The following assets were missing from the assets list: ${s.join(", ")}`);return r};var Qe,gi=class{constructor(e){l(this,Qe);d(this,Qe,e)}async get(e){let{messages:t}=await u.kvStorePlugin.Get({keys:[e]},n(this,Qe));try{if(t[e])return JSON.parse(t[e])}catch{return}}async put(e,t){let r={};r[e]=JSON.stringify(t),await u.kvStorePlugin.Put({messages:r},n(this,Qe))}async delete(e){await u.kvStorePlugin.Del({keys:[e]},n(this,Qe))}async list(){let{keys:e}=await u.kvStorePlugin.List({filter:"*"},n(this,Qe));return e}};Qe=new WeakMap;var Mr,hi=class{constructor(e){l(this,Mr);d(this,Mr,e)}async upload(e){let t=await u.mediaPlugin.Upload(e,n(this,Mr));if(!t.mediaId)throw new Error("unable to get mediaId via uploads");return{mediaId:t.mediaId,mediaUrl:t.mediaUrl}}};Mr=new WeakMap;var Dr,fi=class{constructor(e){l(this,Dr);d(this,Dr,e)}async add(e){await u.modLogPlugin.Add(e,n(this,Dr))}};Dr=new WeakMap;var Br,yi=class{constructor(e){l(this,Br);d(this,Br,e)}async send(e,t){await u.realtimePlugin.Send({channel:e,data:{msg:t}},n(this,Br))}};Br=new WeakMap;import"@devvit/protos";var jd=(a=>(a.COMMENT="t1_",a.ACCOUNT="t2_",a.LINK="t3_",a.MESSAGE="t4_",a.SUBREDDIT="t5_",a.AWARD="t6_",a))(jd||{});function Ye(i){return i.startsWith("t1_")}function eo(i){return i.startsWith("t2_")}function Mt(i){return i.startsWith("t3_")}function Wd(i){return i.startsWith("t4_")}function Vd(i){return i.startsWith("t5_")}function Gd(i){return i.startsWith("t6_")}function ym(i){$e(Ye(i),`Expected comment id to start with t1_, got ${i}}`)}function bm(i){$e(eo(i),`Expected account id to start with t2_, got ${i}}`)}function vm(i){$e(Mt(i),`Expected link id to start with t3_, got ${i}}`)}function km(i){$e(Wd(i),`Expected message id to start with t4_, got ${i}}`)}function Cm(i){$e(Vd(i),`Expected subreddit id to start with t5_, got ${i}}`)}function Pm(i){$e(Gd(i),`Expected award id to start with t6_, got ${i}}`)}function bi(i){return ym(i),i}function ie(i){return bm(i),i}function de(i){return vm(i),i}function Sm(i){return km(i),i}function K(i){return Cm(i),i}function wm(i){return Pm(i),i}function be(i){if(Ye(i))return bi(i);if(eo(i))return ie(i);if(Mt(i))return de(i);if(Wd(i))return Sm(i);if(Vd(i))return K(i);if(Gd(i))return wm(i);throw new Error(`Expected thing id to start with ${Object.values(jd).join(", ")} got ${i}}`)}function Yo(i){return Ye(i)}var g,Nr,Lr,_r,vi=class{constructor(e){l(this,g);l(this,Nr);l(this,Lr);l(this,_r);d(this,g,e),d(this,Nr,new io(e))}get modMail(){return n(this,Nr)}getSubredditById(e){return le.getById(be(e),n(this,g))}getSubredditInfoById(e){return $d(e,n(this,g))}getSubredditByName(e){return le.getByName(e,n(this,g))}getSubredditInfoByName(e){return qd(e,n(this,g))}addSubredditRemovalReason(e,t){return le.addRemovalReason(e,t.title,t.message,n(this,g))}getSubredditRemovalReasons(e){return le.getRemovalReasons(e,n(this,g))}async getCurrentSubredditName(){let e=n(this,g)?.[P.SubredditName]?.values[0];if(e)return e;let t=n(this,g)?.[P.Subreddit]?.values[0],r=await ea(K(t),n(this,g));if(!r)throw new Error("Couldn't get current subreddit's name");return r}async getCurrentSubreddit(){let e=await le.getFromMetadata(n(this,g));if(!e)throw new Error("Couldn't get current subreddit");return e}getPostById(e){return G.getById(be(e),n(this,g))}submitPost(e){return G.submit(e,n(this,g))}crosspost(e){return G.crosspost(e,n(this,g))}getUserById(e){return C.getById(be(e),n(this,g))}getUserByUsername(e){return C.getByUsername(e,n(this,g))}async getCurrentUsername(){return n(this,_r)??d(this,_r,Jd(n(this,g))),n(this,_r)}async getCurrentUser(){return n(this,Lr)??d(this,Lr,this.getCurrentUsername().then(e=>e?C.getByUsername(e,n(this,g)):void 0)),n(this,Lr)}getAppUser(){return C.getFromMetadata(P.AppUser,n(this,g))}async getSnoovatarUrl(e){let t=await this.getCurrentUsername();if(t&&e===t){let r=n(this,g)?.[P.UserSnoovatarUrl]?.values[0];if(r)return r}return C.getSnoovatarUrl(e,n(this,g))}getCommentById(e){return Y.getById(be(e),n(this,g))}getComments(e){return Y.getComments(e,n(this,g))}getCommentsByUser(e){return Y.getCommentsByUser(e,n(this,g))}submitComment(e){return Y.submit({...e,id:be(e.id)},n(this,g))}getControversialPosts(e){return G.getControversialPosts(e,n(this,g))}getTopPosts(e){return G.getTopPosts(e,n(this,g))}getHotPosts(e){return G.getHotPosts(e,n(this,g))}getNewPosts(e){return G.getNewPosts(e,n(this,g))}getRisingPosts(e){return G.getRisingPosts(e,n(this,g))}getPostsByUser(e){return G.getPostsByUser(e,n(this,g))}getCommentsAndPostsByUser(e){return C.getOverview(e,n(this,g))}getUserKarmaFromCurrentSubreddit(e){return C.getUserKarmaFromCurrentSubreddit(e,n(this,g))}getModerationLog(e){return to(e,n(this,g))}getApprovedUsers(e){return C.getSubredditUsersByType({type:"contributors",...e},n(this,g))}approveUser(e,t){return C.createRelationship({username:e,subredditName:t,type:"contributor"},n(this,g))}removeUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"contributor"},n(this,g))}getWikiContributors(e){return C.getSubredditUsersByType({type:"wikicontributors",...e},n(this,g))}addWikiContributor(e,t){return C.createRelationship({username:e,subredditName:t,type:"wikicontributor"},n(this,g))}removeWikiContributor(e,t){return C.removeRelationship({username:e,subredditName:t,type:"wikicontributor"},n(this,g))}getBannedUsers(e){return C.getSubredditUsersByType({type:"banned",...e},n(this,g))}banUser(e){return C.createRelationship({username:e.username,subredditName:e.subredditName,type:"banned",banReason:e.reason,banMessage:e.message,note:e.note,duration:e.duration,banContext:e.context},n(this,g))}unbanUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"banned"},n(this,g))}getBannedWikiContributors(e){return C.getSubredditUsersByType({type:"wikibanned",...e},n(this,g))}banWikiContributor(e){return C.createRelationship({...e,type:"wikibanned"},n(this,g))}unbanWikiContributor(e,t){return C.removeRelationship({username:e,subredditName:t,type:"wikibanned"},n(this,g))}getModerators(e){return C.getSubredditUsersByType({type:"moderators",...e},n(this,g))}inviteModerator(e){return C.createRelationship({type:"moderator_invite",subredditName:e.subredditName,username:e.username,permissions:e.permissions??[]},n(this,g))}revokeModeratorInvite(e,t){return C.removeRelationship({username:e,subredditName:t,type:"moderator_invite"},n(this,g))}removeModerator(e,t){return C.removeRelationship({type:"moderator",subredditName:t,username:e},n(this,g))}setModeratorPermissions(e,t,r){return C.setModeratorPermissions(e,t,r,n(this,g))}getMutedUsers(e){return C.getSubredditUsersByType({type:"muted",...e},n(this,g))}muteUser(e){return C.createRelationship({...e,type:"muted"},n(this,g))}unmuteUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"muted"},n(this,g))}getModNotes(e){return ve.get(e,n(this,g))}deleteModNote(e){return ve.delete(e,n(this,g))}addModNote(e){let t={...e,redditId:e.redditId?be(e.redditId):void 0};return ve.add(t,n(this,g))}addRemovalNote(e){return ve.addRemovalNote(e,n(this,g))}async sendPrivateMessage(e){return Dt.send(e,n(this,g))}async sendPrivateMessageAsSubreddit(e){return Dt.sendAsSubreddit(e,n(this,g))}async approve(e){if(Ye(e))return Y.approve(e,n(this,g));if(Mt(e))return G.approve(e,n(this,g));throw new Error("id must start with either t1_ or t3_")}async remove(e,t){if(Ye(e))return Y.remove(e,t,n(this,g));if(Mt(e))return G.remove(e,t,n(this,g));throw new Error("id must start with either t1_ or t3_")}async getPostFlairTemplates(e){return ne.getPostFlairTemplates(e,n(this,g))}async getUserFlairTemplates(e){return ne.getUserFlairTemplates(e,n(this,g))}async createPostFlairTemplate(e){return ne.createPostFlairTemplate(e,n(this,g))}async createUserFlairTemplate(e){return ne.createUserFlairTemplate(e,n(this,g))}async editFlairTemplate(e){return ne.editFlairTemplate(e,n(this,g))}async deleteFlairTemplate(e,t){return ne.deleteFlairTemplate(e,t,n(this,g))}async setUserFlair(e){return ce.setUserFlair(e,n(this,g))}async setUserFlairBatch(e,t){return ce.setUserFlairBatch(e,t,n(this,g))}async removeUserFlair(e,t){return ce.removeUserFlair(e,t,n(this,g))}async setPostFlair(e){return ce.setPostFlair(e,n(this,g))}async removePostFlair(e,t){return ce.removePostFlair(e,de(t),n(this,g))}async getWidgets(e){return ee.getWidgets(e,n(this,g))}async deleteWidget(e,t){return ee.delete(e,t,n(this,g))}async addWidget(e){return ee.add(e,n(this,g))}async updateWidget(e){return ee.patch(e,n(this,g))}async reorderWidgets(e,t){return ee.reorder(e,t,n(this,g))}async getWikiPage(e,t,r){return ue.getPage(e,t,r,n(this,g))}async getWikiPages(e){return ue.getPages(e,n(this,g))}async createWikiPage(e){return ue.createPage(e,n(this,g))}async updateWikiPage(e){return ue.updatePage(e,n(this,g))}getWikiPageRevisions(e){return ue.getPageRevisions(e,n(this,g))}async revertWikiPage(e,t,r){return ue.revertPage(e,t,r,n(this,g))}async getWikiPageSettings(e,t){return ue.getPageSettings(e,t,n(this,g))}async updateWikiPageSettings(e){return ue.updatePageSettings(e,n(this,g))}async addEditorToWikiPage(e,t,r){return ue.addEditor(e,t,r,n(this,g))}async removeEditorFromWikiPage(e,t,r){return ue.removeEditor(e,t,r,n(this,g))}getMessages(e){return Dt.getMessages(e,n(this,g))}markAllMessagesAsRead(){return Dt.markAllAsRead(n(this,g))}report(e,t){return u.redditAPIPlugins.LinksAndComments.Report({reason:t.reason,thingId:e.id,srName:e.subredditName,usernames:e.authorName},n(this,g))}getModQueue(e){return le.aboutLocation({...e,location:"modqueue"},n(this,g))}getReports(e){return le.aboutLocation({...e,location:"reports"},n(this,g))}getSpam(e){return le.aboutLocation({...e,location:"spam"},n(this,g))}getUnmoderated(e){return le.aboutLocation({...e,location:"unmoderated"},n(this,g))}getEdited(e){return le.aboutLocation({...e,location:"edited"},n(this,g))}getVaultByAddress(e){return Zd(e,n(this,g))}getVaultByUserId(e){return Qd(be(e),n(this,g))}getSubredditLeaderboard(e){return Kd(e,n(this,g))}getSubredditStyles(e){return Xd(e,n(this,g))}async subscribeToCurrentSubreddit(){let e=await this.getCurrentSubreddit();await u.redditAPIPlugins.Subreddits.Subscribe({action:"sub",actionSource:"",srName:e.name,sr:"",skipInitialDefaults:!0},n(this,g))}async unsubscribeFromCurrentSubreddit(){let e=await this.getCurrentSubreddit();await u.redditAPIPlugins.Subreddits.Subscribe({action:"unsub",actionSource:"",srName:e.name,sr:"",skipInitialDefaults:!1},n(this,g))}};g=new WeakMap,Nr=new WeakMap,Lr=new WeakMap,_r=new WeakMap;import{BitfieldOverflowBehavior as ta,RedisKeyScope as ia}from"@devvit/protos";function Hr(i){return i&&typeof i=="object"&&"message"in i&&i.message!==void 0&&typeof i.message=="string"?i.message.includes("redis: nil"):!1}var T,A,E,ra=class{constructor(e,t,r){l(this,T);l(this,A);l(this,E);d(this,T,e),d(this,A,t),d(this,E,r)}async get(e){return await n(this,T).Get({key:e,transactionId:n(this,A)},n(this,E)),this}async multi(){await n(this,T).Multi(n(this,A),n(this,E))}async set(e,t,r){let s;return r?.expiration&&(s=Math.floor((r.expiration.getTime()-Date.now())/1e3),s<1&&(s=1)),await n(this,T).Set({key:e,value:t,nx:r?.nx===!0,xx:r?.xx===!0,expiration:s||0,transactionId:n(this,A)},n(this,E)),this}async del(...e){return await n(this,T).Del({keys:e,transactionId:n(this,A)},n(this,E)),this}async type(e){return await n(this,T).Type({key:e,transactionId:n(this,A)},n(this,E)),this}async exec(){let e=await n(this,T).Exec(n(this,A),n(this,E)),t=[];for(let r of e.response)r.members?t.push(r.members):r.nil!==void 0?t.push(null):r.num!==void 0?t.push(r.num):r.values!==void 0?t.push(r.values.values):r.str!==void 0?t.push(r.str):r.dbl!==void 0?t.push(r.dbl):r.bool!==void 0&&t.push(r.bool);return t}async discard(){await n(this,T).Discard(n(this,A),n(this,E))}async watch(...e){return await n(this,T).Watch({keys:e,transactionId:n(this,A)},n(this,E)),this}async unwatch(){return await n(this,T).Unwatch(n(this,A),n(this,E)),this}async getRange(e,t,r){return await n(this,T).GetRange({key:e,start:t,end:r,transactionId:n(this,A)},n(this,E)),this}async setRange(e,t,r){return await n(this,T).SetRange({key:e,offset:t,value:r,transactionId:n(this,A)},n(this,E)),this}async strlen(e){return this.strLen(e)}async strLen(e){return await n(this,T).Strlen({key:e,transactionId:n(this,A)},n(this,E)),this}async mget(e){return this.mGet(e)}async mGet(e){return await n(this,T).MGet({keys:e,transactionId:n(this,A)},n(this,E)),this}async mset(e){return this.mSet(e)}async mSet(e){let t=Object.entries(e).map(([r,s])=>({key:r,value:s}));return await n(this,T).MSet({kv:t,transactionId:n(this,A)},n(this,E)),this}async incrBy(e,t){return await n(this,T).IncrBy({key:e,value:t,transactionId:n(this,A)},n(this,E)),this}async expire(e,t){return await n(this,T).Expire({key:e,seconds:t,transactionId:n(this,A)},n(this,E)),this}async expireTime(e){return await n(this,T).ExpireTime({key:e,transactionId:n(this,A)},n(this,E)),this}async zAdd(e,...t){return await n(this,T).ZAdd({key:e,members:t,transactionId:n(this,A)},n(this,E)),this}async zScore(e,t){return await n(this,T).ZScore({key:{key:e,transactionId:n(this,A)},member:t},n(this,E)),this}async zRank(e,t){return await n(this,T).ZRank({key:{key:e,transactionId:n(this,A)},member:t},n(this,E)),this}async zIncrBy(e,t,r){return await n(this,T).ZIncrBy({key:e,member:t,value:r,transactionId:n(this,A)},n(this,E)),this}async zScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,transactionId:n(this,A)};return await n(this,T).ZScan(o,n(this,E)),this}async zCard(e){return await n(this,T).ZCard({key:e,transactionId:n(this,A)},n(this,E)),this}async zRange(e,t,r,s){let o={rev:!1,byLex:!1,byScore:!1,offset:0,count:1e3};if(s?.reverse&&(o.rev=s.reverse),s?.by==="lex"?o.byLex=!0:s?.by==="score"&&(o.byScore=!0),s?.limit)if(o.byLex||o.byScore)o.offset=s.limit.offset,o.count=s.limit.count;else throw new Error("zRange parsing error: 'limit' only allowed when 'options.by' is 'lex' or 'score'");return await n(this,T).ZRange({key:{key:e,transactionId:n(this,A)},start:t+"",stop:r+"",...o},n(this,E)),this}async zRem(e,t){return await n(this,T).ZRem({key:{key:e,transactionId:n(this,A)},members:t},n(this,E)),this}async zRemRangeByLex(e,t,r){return await n(this,T).ZRemRangeByLex({key:{key:e,transactionId:n(this,A)},min:t,max:r},n(this,E)),this}async zRemRangeByRank(e,t,r){return await n(this,T).ZRemRangeByRank({key:{key:e,transactionId:n(this,A)},start:t,stop:r},n(this,E)),this}async zRemRangeByScore(e,t,r){return await n(this,T).ZRemRangeByScore({key:{key:e,transactionId:n(this,A)},min:t,max:r},n(this,E)),this}async hgetall(e){return this.hGetAll(e)}async hGetAll(e){return await n(this,T).HGetAll({key:e,transactionId:n(this,A)},n(this,E)),this}async hget(e,t){return this.hGet(e,t)}async hGet(e,t){return await n(this,T).HGet({key:e,field:t,transactionId:n(this,A)},n(this,E)),this}async hMGet(e,t){return await n(this,T).HMGet({key:e,fields:t,transactionId:n(this,A)},n(this,E)),this}async hset(e,t){return this.hSet(e,t)}async hSet(e,t){let r=Object.entries(t).map(([s,o])=>({field:s,value:o}));return await n(this,T).HSet({key:e,fv:r,transactionId:n(this,A)},n(this,E)),this}async hincrby(e,t,r){return this.hIncrBy(e,t,r)}async hIncrBy(e,t,r){return await n(this,T).HIncrBy({key:e,field:t,value:r,transactionId:n(this,A)},n(this,E)),this}async hdel(e,t){return this.hDel(e,t)}async hDel(e,t){return await n(this,T).HDel({key:e,fields:t,transactionId:n(this,A)},n(this,E)),this}async hscan(e,t,r,s){return this.hScan(e,t,r,s)}async hScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,transactionId:n(this,A)};return await n(this,T).HScan(o,n(this,E)),this}async hkeys(e){return this.hKeys(e)}async hKeys(e){return await n(this,T).HKeys({key:e,transactionId:n(this,A)},n(this,E)),this}async hlen(e){return this.hLen(e)}async hLen(e){return await n(this,T).HLen({key:e,transactionId:n(this,A)},n(this,E)),this}};T=new WeakMap,A=new WeakMap,E=new WeakMap;var w,ki,na=class na{constructor(e,t=void 0,r=ia.INSTALLATION){l(this,w);l(this,ki);d(this,w,e),d(this,ki,t),this.scope=r,this.global=r===ia.INSTALLATION?new na(n(this,w),n(this,ki),ia.GLOBAL):this}get storage(){return n(this,ki)||u.redisPlugin}async watch(...e){let t=await this.storage.Watch({keys:e},n(this,w));return new ra(this.storage,t,n(this,w))}async get(e){try{let t=await this.storage.Get({key:e,scope:this.scope},{...n(this,w),"throw-redis-nil":{values:["true"]}});return t!==null?t.value??void 0:t}catch(t){if(Hr(t))return;throw t}}async getBuffer(e){try{let t=await this.storage.GetBytes({key:e,scope:this.scope},{...n(this,w),"throw-redis-nil":{values:["true"]}});return t!==null?Buffer.from(t.value):t}catch(t){if(Hr(t))return;throw t}}async set(e,t,r){let s;return r?.expiration&&(s=Math.floor((r.expiration.getTime()-Date.now())/1e3),s<1&&(s=1)),(await this.storage.Set({key:e,value:t,nx:r?.nx===!0&&!r.xx,xx:r?.xx===!0&&!r.nx,expiration:s||0,scope:this.scope},n(this,w))).value}async exists(...e){return(await this.storage.Exists({keys:e,scope:this.scope},n(this,w))).existingKeys}async del(...e){await this.storage.Del({keys:e,scope:this.scope},n(this,w))}async incrBy(e,t){return(await this.storage.IncrBy({key:e,value:t,scope:this.scope},n(this,w))).value}async getRange(e,t,r){let s=await this.storage.GetRange({key:e,start:t,end:r,scope:this.scope},n(this,w));return s!==null?s.value:s}async setRange(e,t,r){return(await this.storage.SetRange({key:e,offset:t,value:r,scope:this.scope},n(this,w))).value}async strlen(e){return this.strLen(e)}async strLen(e){return(await this.storage.Strlen({key:e,scope:this.scope},n(this,w))).value}async expire(e,t){await this.storage.Expire({key:e,seconds:t,scope:this.scope},n(this,w))}async expireTime(e){return(await this.storage.ExpireTime({key:e,scope:this.scope},n(this,w))).value}async zAdd(e,...t){return(await this.storage.ZAdd({key:e,members:t,scope:this.scope},n(this,w))).value}async zRange(e,t,r,s){let o={rev:!1,byLex:!1,byScore:!1,offset:0,count:1e3};if(s?.reverse&&(o.rev=s.reverse),s?.by==="lex"?o.byLex=!0:s?.by==="score"?o.byScore=!0:(o.offset=0,o.count=0),s?.limit)if(o.byLex||o.byScore)o.offset=s.limit.offset,o.count=s.limit.count;else throw new Error("zRange parsing error: 'limit' only allowed when 'options.by' is 'lex' or 'score'");return(await this.storage.ZRange({key:{key:e},start:t+"",stop:r+"",...o,scope:this.scope},n(this,w))).members}async zRem(e,t){return(await this.storage.ZRem({key:{key:e},members:t,scope:this.scope},n(this,w))).value}async zRemRangeByLex(e,t,r){return(await this.storage.ZRemRangeByLex({key:{key:e},min:t,max:r,scope:this.scope},n(this,w))).value}async zRemRangeByRank(e,t,r){return(await this.storage.ZRemRangeByRank({key:{key:e},start:t,stop:r,scope:this.scope},n(this,w))).value}async zRemRangeByScore(e,t,r){return(await this.storage.ZRemRangeByScore({key:{key:e},min:t,max:r,scope:this.scope},n(this,w))).value}async zScore(e,t){try{let r=await this.storage.ZScore({key:{key:e},member:t,scope:this.scope},{...n(this,w),"throw-redis-nil":{values:["true"]}});return r!==null?r.value:r}catch(r){if(Hr(r))return;throw r}}async zRank(e,t){try{let r=await this.storage.ZRank({key:{key:e},member:t,scope:this.scope},{...n(this,w),"throw-redis-nil":{values:["true"]}});return r!==null?r.value:r}catch(r){if(Hr(r))return;throw r}}async zIncrBy(e,t,r){let s=await this.storage.ZIncrBy({key:e,member:t,value:r,scope:this.scope},n(this,w));return s!==null?s.value:s}async mget(e){return this.mGet(e)}async mGet(e){let t=await this.storage.MGet({keys:e,scope:this.scope},n(this,w));return t!==null?t.values.map(r=>r||null):t}async mset(e){return this.mSet(e)}async mSet(e){let t=Object.entries(e).map(([r,s])=>({key:r,value:s}));await this.storage.MSet({kv:t,scope:this.scope},n(this,w))}async zCard(e){let t=await this.storage.ZCard({key:e,scope:this.scope},n(this,w));return t!==null?t.value:t}async zScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,scope:this.scope};return await this.storage.ZScan(o,n(this,w))}async type(e){let t=await this.storage.Type({key:e,scope:this.scope},n(this,w));return t!==null?t.value:t}async rename(e,t){return(await this.storage.Rename({key:e,newKey:t,scope:this.scope},n(this,w))).result}async hget(e,t){return this.hGet(e,t)}async hGet(e,t){try{let r=await this.storage.HGet({key:e,field:t,scope:this.scope},{...n(this,w),"throw-redis-nil":{values:["true"]}});return r!==null?r.value??void 0:r}catch(r){if(Hr(r))return;throw r}}async hMGet(e,t){let r=await this.storage.HMGet({key:e,fields:t,scope:this.scope},n(this,w));return r!==null?r.values.map(s=>s||null):r}async hset(e,t){return this.hSet(e,t)}async hSet(e,t){let r=Object.entries(t).map(([o,a])=>({field:o,value:a}));return(await this.storage.HSet({key:e,fv:r,scope:this.scope},n(this,w))).value}async hSetNX(e,t,r){return(await this.storage.HSetNX({key:e,field:t,value:r,scope:this.scope},n(this,w))).success}async hgetall(e){return this.hGetAll(e)}async hGetAll(e){let t=await this.storage.HGetAll({key:e,scope:this.scope},n(this,w));return t!==null?t.fieldValues:t}async hdel(e,t){return this.hDel(e,t)}async hDel(e,t){return(await this.storage.HDel({key:e,fields:t,scope:this.scope},n(this,w))).value}async hscan(e,t,r,s){return this.hScan(e,t,r,s)}async hScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,scope:this.scope};return await this.storage.HScan(o,n(this,w))}async hkeys(e){return this.hKeys(e)}async hKeys(e){let t=await this.storage.HKeys({key:e,scope:this.scope},n(this,w));return t!==null?t.keys:t}async hincrby(e,t,r){return this.hIncrBy(e,t,r)}async hIncrBy(e,t,r){return(await this.storage.HIncrBy({key:e,field:t,value:r,scope:this.scope},n(this,w))).value}async hlen(e){return this.hLen(e)}async hLen(e){return(await this.storage.HLen({key:e,scope:this.scope})).value}async bitfield(e,...t){let r=[];for(let o=0;o<t.length;){let a=t[o],c={};switch(a){case"get":{if(o+2>=t.length)throw Error("bitfield command parse failed; not enough arguments for 'get' command");c.get={encoding:t[o+1],offset:t[o+2].toString()},o+=3;break}case"set":{if(o+3>=t.length)throw Error("bitfield command parse failed; not enough arguments for 'set' command");c.set={encoding:t[o+1],offset:t[o+2].toString(),value:t[o+3].toString()},o+=4;break}case"incrBy":{if(o+3>=t.length)throw Error("bitfield command parse failed; not enough arguments for 'incrBy' command");c.incrBy={encoding:t[o+1],offset:t[o+2].toString(),increment:t[o+3].toString()},o+=4;break}case"overflow":{if(o+1>=t.length)throw Error("bitfield command parse failed; not enough arguments for 'overflow' command");let m=t[o+1].toString();c.overflow={behavior:Fm(m)},o+=2;break}default:throw Error(`bitfield command parse failed; ${a} unrecognized (must be 'get', 'set', 'incrBy', or 'overflow')`)}r.push(c)}return(await this.storage.Bitfield({key:e,commands:r,scope:this.scope})).results}};w=new WeakMap,ki=new WeakMap;var Ci=na;function Fm(i){let e=i.toLowerCase();switch(e){case"wrap":return ta.BITFIELD_OVERFLOW_BEHAVIOR_WRAP;case"sat":return ta.BITFIELD_OVERFLOW_BEHAVIOR_SAT;case"fail":return ta.BITFIELD_OVERFLOW_BEHAVIOR_FAIL;default:throw Error(`unknown bitfield overflow behavior: ${e}`)}}var Bt,Pi=class{constructor(e){l(this,Bt);d(this,Bt,e)}async runJob(e){return(await u.schedulerPlugin.Schedule({action:{type:e.name,data:e.data},cron:"cron"in e?e.cron:void 0,when:"runAt"in e?e.runAt:void 0},n(this,Bt))).id}async cancelJob(e){await u.schedulerPlugin.Cancel({id:e},n(this,Bt))}async listJobs(){return(await u.schedulerPlugin.List({after:new Date(0),before:new Date(Date.now()+31536e7)},n(this,Bt))).actions.map(t=>(p(t.request?.action,"Scheduled job is malformed"),"when"in t.request&&t.request.when!=null?{id:t.id,name:t.request.action.type,runAt:t.request.when,data:t.request.action.data}:{id:t.id,name:t.request.action.type,cron:t.request.cron??"",data:t.request.action.data}))}};Bt=new WeakMap;import{FormFieldType as ro}from"@devvit/protos";var jr,Si=class{constructor(e){l(this,jr);d(this,jr,e)}async get(e){return(await this.getAll())[e]}async getAll(){let t=await u.settingsPlugin.GetSettings({},n(this,jr));if(!t.installationSettings)throw new Error("Could not get installation settings");if(!t.appSettings)throw new Error("Could not get app settings");return xm(t),{...Yd(t.installationSettings.settings,u.installationSettings),...Yd(t.appSettings.settings,u.appSettings)}}};jr=new WeakMap;function xm(i){if(!i.appSettings)throw new Error("Could not get app settings");for(let[e,t]of Object.entries(i.appSettings.settings)){let r=u.appSettings?.find(s=>s.type!=="group"&&s.name===e);r&&(r.type==="boolean"&&t.fieldType===ro.STRING&&t.boolValue==null&&t.stringValue!=null?(t.fieldType=ro.BOOLEAN,t.boolValue=!!t.stringValue,delete t.stringValue):r.type==="number"&&t.fieldType===ro.STRING&&t.numberValue==null&&t.stringValue!=null&&(t.fieldType=ro.NUMBER,t.numberValue=Number(t.stringValue),delete t.stringValue))}}function Yd(i,e){let t=Object.keys(i).reduce((r,s)=>(r[s]=qo(i[s]),r),{});return e&&el(t,e),t}function el(i,e){for(let t of e)t.type==="group"?el(i,t.fields):!(t.name in i)&&"defaultValue"in t&&(i[t.name]=t.defaultValue)}import{EffectType as no,ToastAppearance as tl}from"@devvit/protos";var et,wi,Wr,oo,so=class{constructor(e){l(this,et,[]);l(this,wi);l(this,Wr);l(this,oo,(e,t)=>{let r=t!==void 0?e:"",s=t!==void 0?t:e;n(this,et).push({type:no.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:r,app:{message:s}}}})});d(this,wi,e),d(this,Wr,{postMessage:n(this,oo)})}get webView(){return n(this,Wr)}showForm(e,t){return this.showFormInternal(e,t)}showFormInternal(e,t,r){let s=u.formDefinitions?.get(e);if(!s&&n(this,wi)){let c=n(this,wi).forms.get(e);c&&(s={form:c,onSubmit:()=>{}})}if(!s)throw new Error("Form does not exist. Make sure you have added it using Devvit.createForm at the root of your app.");let o=r??(s.form instanceof Function?s.form(t??{}):s.form),a={fields:[],id:e,title:o.title,acceptLabel:o.acceptLabel,cancelLabel:o.cancelLabel,shortDescription:o.description};Ut(o.fields),a.fields=Ne(o.fields),n(this,et).push({type:no.EFFECT_SHOW_FORM,showForm:{form:a}})}showToast(e){let t;e instanceof Object?t={text:e.text,appearance:e.appearance==="success"?tl.SUCCESS:tl.NEUTRAL}:t={text:e},n(this,et).push({type:no.EFFECT_SHOW_TOAST,showToast:{toast:t}})}navigateTo(e){let t=typeof e=="string"?e:e.url;if(!URL.canParse(t))throw new TypeError(`Invalid URL: ${t}`);let r=new URL(t).toString();n(this,et).push({type:no.EFFECT_NAVIGATE_TO_URL,navigateToUrl:{url:r}})}get __effects(){return n(this,et)}};et=new WeakMap,wi=new WeakMap,Wr=new WeakMap,oo=new WeakMap;function ke({metadata:i,ui:e,hooks:t,reconciler:r}){let s=new fi(i),o=new gi(i),a=new Ci(i),c=Nd(a,r?r.state:{}),m=new vi(i),y=new Pi(i),v=new Si(i),f=e?new so(r):void 0,S=new hi(i),b=new mi,_=new yi(i),I=t&&r?Fd(r):void 0,N=t&&r?wd(r):void 0,B=t&&r?Sd(r):void 0,ai=t&&r?Pd(r):void 0;return{modLog:s,kvStore:o,redis:a,reddit:m,scheduler:y,settings:v,media:S,assets:b,realtime:_,get useForm(){return B??(()=>{throw new Error("useForm() is unavailable")})},get cache(){return c??(()=>{throw new Error("cache() is unavailable")})},get useState(){return I??(()=>{throw new Error("useState() is unavailable")})},get useInterval(){return N??(()=>{throw new Error("useInterval() is unavailable")})},get useChannel(){return ai??(()=>{throw new Error("useChannel() is unavailable")})},get ui(){if(!f)throw new Error("ui client is not available");return f}}}var il={name:"@devvit/public-api",version:"0.12.8-dev",license:"BSD-3-Clause",repository:{type:"git",url:"https://developers.reddit.com/"},type:"module",exports:{".":"./dist/index.js","./package.json":"./package.json","./*":"./dist/*"},main:"./dist/index.js",files:["dist/**"],scripts:{build:"yarn build:icon-types && yarn build:semantic-colors && tsc && cp -af devvit.tsconfig.json dist/ && yarn build:min","build:icon-types":"make-icons src/types/icons.ts","build:min":"esbuild --bundle --sourcemap=linked --target=es2020 --format=esm  --metafile=dist/meta.min.json --outfile=dist/public-api.min.js --external:@devvit/protos --minify src/index.ts","build:semantic-colors":"node scripts/make-semantic-colors.js",clean:"rm -rf .turbo coverage dist src/devvit/internals/semanticColors.ts src/types/icons.ts || :",clobber:"yarn clean && rm -rf node_modules",dev:"tsc -w","dev:build":"chokidar ./src ../shared-types/dist --command 'yarn build' --ignore './src/types/icons.ts' --ignore './src/devvit/internals/semanticColors.ts'",lint:"redlint .","lint:fix":"yarn lint --fix",prepublishOnly:"publish-package-json",test:"yarn test:unit && yarn test:types && yarn test:size","test:size":"filesize","test:types":"tsc --noEmit","test:unit":"vitest run","test:unit-with-coverage":"vitest run --coverage"},types:"./dist/index.d.ts",dependencies:{"@devvit/metrics":"0.12.8-dev","@devvit/protos":"0.12.8-dev","@devvit/shared":"0.12.8-dev","@devvit/shared-types":"0.12.8-dev","base64-js":"1.5.1","clone-deep":"4.0.1",moderndash:"4.0.0"},devDependencies:{"@ampproject/filesize":"4.3.0","@devvit/repo-tools":"0.12.8-dev","@devvit/tsconfig":"0.12.8-dev","@reddit/faceplate-ui":"18.2.2","@reddit/rpl-styles":"1.0.2","@types/clone-deep":"4.0.1","@types/node":"20.14.12","chokidar-cli":"3.0.0",esbuild:"0.25.9",eslint:"9.11.1",typescript:"5.8.3",vitest:"4.0.15"},publishConfig:{directory:"dist"},filesize:{"dist/public-api.min.js":{gzip:"65 KB",none:"225 KB"}},source:"./src/index.ts"};function se(i,e,t){let r=i[P.Subreddit]?.values[0];p(r,"subreddit is missing from Context");let s=i[P.SubredditName]?.values[0],o,a=i[P.PostData]?.values[0];a&&(o=JSON.parse(a).developerData);let c=i[P.AppUser]?.values[0],m=i[P.App]?.values[0],y=i[P.Version]?.values[0],v=i[P.UserSnoovatarUrl]?.values[0],f=i[P.Username]?.values[0],S=i[P.User]?.values[0],b=Tm(i);return{get appAccountId(){return p(c,"appAccountId is missing from Context"),c},subredditId:r,subredditName:s,userId:S,postId:e,postData:o,commentId:t,appName:m,appVersion:y,snoovatar:v,username:f,debug:b,metadata:i,toJSON(){return{appAccountId:c,appName:m,appVersion:y,subredditId:r,subredditName:s,userId:S,postId:e,postData:o,commentId:t,snoovatar:v,username:f,debug:b,metadata:i}}}}function Tm(i){let e={blocks:void 0,emitSnapshots:void 0,emitState:void 0,realtime:void 0,runtime:void 0,surface:void 0,useAsync:void 0,payments:void 0,bootstrap:void 0,webView:void 0},t={};for(let s in e)t[s.toLowerCase()]=s;let r={};for(let s of(i[P.Debug]?.values??[]).join().split(",")){let[o,a]=s.split("=");o&&(o=o.trim(),a=a?.trim(),o.toLowerCase()in t&&(o=t[o.toLowerCase()]),r[o]??(r[o]=a||"true"))}return i[P.Debug]&&console.info(`[api] @devvit/public-api v${il.version} ${Object.entries(r).map(([s,o])=>`${s}=${o}`).join(" ")}`),{...r,metadata:i}}function rl(i){return i.flatMap(e=>e.type==="group"?rl(e.fields):e)}async function ao(i,e,t){if(!e)throw new Error("Settings were not defined.");let r={success:!0,errors:{}},s=Ke(i.fieldValues),o=rl(e);return await Promise.all(o.map(async a=>{let c=a.name;if(c&&a.onValidate){let m=s[c],y=a.onValidate,v=Object.assign(ke({metadata:t}),se(t)),f=await y({value:m,isEditing:i.editing},v);f&&(r.success=!1,r.errors[c]=f)}})),Am.fromJSON(r)}async function Om(){return Rm.fromJSON({fields:{fields:Ne(u.appSettings??[])}})}async function Um(i,e){return ao(i,u.appSettings,e)}function nl(i){i.provides(Em),O("GetAppSettingsFields",Om),O("ValidateAppForm",Um)}import{CustomPostDefinition as Hm,RenderPostResponse as jm}from"@devvit/protos";import{BlockRenderEventType as ba,EffectType as vl}from"@devvit/protos";function Fi(i){return i.__effects}function sl(){let i=new Set;return e=>{let t=e,r=1;for(;i.has(t);)t=`${e}.${r++}`;return i.add(t),t}}import{BlockActionType as ya,BlockAvatarBackground as hl,BlockAvatarFacing as fl,BlockAvatarSize as tt,BlockBorderWidth as mo,BlockButtonAppearance as it,BlockButtonSize as la,BlockGap as po,BlockHorizontalAlignment as ua,BlockIconSize as go,BlockImageResizeMode as Vr,BlockPadding as Gr,BlockRadius as Jr,BlockSpacerShape as ca,BlockSpacerSize as ho,BlockStackDirection as ma,BlockTextOutline as pa,BlockTextOverflow as ga,BlockTextSize as Ii,BlockTextStyle as ha,BlockTextWeight as yl,BlockType as Re,BlockVerticalAlignment as fa}from"@devvit/protos";var sa={"alienblue-100":"#DCE2FB","alienblue-200":"#B8C5FC","alienblue-25":"#F7F8FD","alienblue-300":"#90A9FD","alienblue-400":"#648EFC","alienblue-50":"#EEF0FB","alienblue-500":"#1870F4","alienblue-600":"#115BCA","alienblue-700":"#0A449B","alienblue-75":"#E6E9FB","alienblue-800":"#0A2F6C","alienblue-900":"#0A1A3F","alienblue-950":"#07102B","berrypurple-100":"#F3DAFB","berrypurple-200":"#EAB3FD","berrypurple-25":"#FBF6FD","berrypurple-300":"#DE8BFF","berrypurple-400":"#CF5FFF","berrypurple-50":"#F8EDFC","berrypurple-500":"#BC0EFF","berrypurple-600":"#9B00D4","berrypurple-700":"#7600A3","berrypurple-75":"#F6E4FB","berrypurple-800":"#520472","berrypurple-900":"#300643","berrypurple-950":"#20042A",black:"#000000","black-opacity-0":"#00000000","black-opacity-10":"#00000019","black-opacity-15":"#00000026","black-opacity-20":"#00000033","black-opacity-25":"#0000003F","black-opacity-33":"#00000054","black-opacity-5":"#0000000C","black-opacity-50":"#0000007F","black-opacity-60":"#00000099","black-opacity-67":"#000000AA","black-opacity-80":"#000000CC","black-opacity-90":"#000000E5","brand-secondary-bananayellow_base":"#FFBF0B","brand-secondary-bananayellow_highlight":"#FFDE55","brand-secondary-bananayellow_shade":"#F27300","brand-secondary-bananayellow_tint":"#FFF3C0","brand-secondary-guavapink_base":"#FF5FC2","brand-secondary-guavapink_highlight":"#FF9FDF","brand-secondary-guavapink_shade":"#D3168B","brand-secondary-guavapink_tint":"#FFE6F9","brand-secondary-juniperblue_base":"#00E2B7","brand-secondary-juniperblue_highlight":"#92FFEA","brand-secondary-juniperblue_shade":"#08A59D","brand-secondary-juniperblue_tint":"#E6FFFA","brand-secondary-limegreen_base":"#AEEF0F","brand-secondary-limegreen_highlight":"#E4FF45","brand-secondary-limegreen_shade":"#65B200","brand-secondary-limegreen_tint":"#F0FFB3","brand-secondary-orangered_base":"#FF4500","brand-secondary-orangered_highlight":"#FF8864","brand-secondary-orangered_shade":"#D82400","brand-secondary-orangered_tint":"#FFDAD7","brown-100":"#F1DFCF","brown-200":"#E9BE95","brown-25":"#FBF7F4","brown-300":"#DC9D5D","brown-400":"#BA854E","brown-50":"#F7EFE9","brown-500":"#9A6D3F","brown-600":"#7B5631","brown-700":"#5D4023","brown-75":"#F4E7DC","brown-800":"#3F2C19","brown-900":"#221A11","brown-950":"#15100A","coolgray-100":"#DBE4E9","coolgray-150":"#C9D7DE","coolgray-200":"#B7CAD4","coolgray-25":"#F6F8F9","coolgray-250":"#A4BDCA","coolgray-300":"#97AFBC","coolgray-350":"#8BA2AD","coolgray-400":"#7F949F","coolgray-450":"#748791","coolgray-50":"#EEF1F3","coolgray-500":"#667780","coolgray-525":"#576F76","coolgray-550":"#5C6C74","coolgray-600":"#536168","coolgray-650":"#48545B","coolgray-700":"#3D494E","coolgray-75":"#E5EBEE","coolgray-750":"#333D42","coolgray-800":"#2A3236","coolgray-850":"#21272A","coolgray-900":"#181C1F","coolgray-950":"#0E1113","global-black":{light:"#000000",dark:"#000000"},"global-brand-orangered":{light:"#FF4500",dark:"#FF4500"},"global-white":{light:"#FFFFFF",dark:"#FFFFFF"},"kiwigreen-100":"#A8F5A0","kiwigreen-200":"#58E15B","kiwigreen-25":"#EBFDE7","kiwigreen-300":"#00C61C","kiwigreen-400":"#01A816","kiwigreen-50":"#DDF8D7","kiwigreen-500":"#008A10","kiwigreen-600":"#016E0B","kiwigreen-700":"#005306","kiwigreen-75":"#CAF5C2","kiwigreen-800":"#033902","kiwigreen-900":"#0D2005","kiwigreen-950":"#081404","lightblue-100":"#CAE7FB","lightblue-200":"#87D0FD","lightblue-25":"#F3F9FD","lightblue-300":"#02B9FB","lightblue-400":"#029DD5","lightblue-50":"#E6F3FC","lightblue-500":"#007FAE","lightblue-600":"#01668D","lightblue-700":"#014D6B","lightblue-75":"#D9EDFB","lightblue-800":"#03354B","lightblue-900":"#051E2B","lightblue-950":"#04131A","lime-100":"#B7F28E","lime-200":"#90DA58","lime-25":"#EEFDDC","lime-300":"#6DBF01","lime-400":"#5BA200","lime-50":"#E0F8C8","lime-500":"#4A8500","lime-600":"#3A6A00","lime-700":"#2A5000","lime-75":"#CEF5AD","lime-800":"#1E3702","lime-900":"#151E05","lime-950":"#0D1304","mintgreen-100":"#9BF5D9","mintgreen-200":"#00E2B7","mintgreen-25":"#E7FDF5","mintgreen-300":"#00C29D","mintgreen-400":"#01A484","mintgreen-50":"#D7F8EC","mintgreen-500":"#01876D","mintgreen-600":"#006C56","mintgreen-700":"#015140","mintgreen-75":"#C0F5E3","mintgreen-800":"#00382B","mintgreen-900":"#032019","mintgreen-950":"#03140F","orangered-100":"#FCDBCF","orangered-200":"#FDB498","orangered-25":"#FDF6F4","orangered-300":"#FF895D","orangered-400":"#FF4500","orangered-50":"#FCEEE8","orangered-500":"#D93900","orangered-600":"#AE2C00","orangered-700":"#842100","orangered-75":"#FBE5DC","orangered-800":"#591B02","orangered-900":"#2F1405","orangered-950":"#1C0D04","periwinkle-100":"#E6DFFB","periwinkle-200":"#CDBEFD","periwinkle-25":"#F9F7FD","periwinkle-300":"#B29FFF","periwinkle-400":"#9580FF","periwinkle-50":"#F2EFFC","periwinkle-500":"#6A5CFF","periwinkle-600":"#523DFF","periwinkle-700":"#4001EA","periwinkle-75":"#ECE7FB","periwinkle-800":"#250AA6","periwinkle-900":"#160E5B","periwinkle-950":"#0C083F","poopbrown-100":"#FEEEDD","poopbrown-200":"#F6DDC3","poopbrown-300":"#EECCAA","poopbrown-400":"#CAA075","poopbrown-50":"#FEF7EE","poopbrown-500":"#9A6D3F","poopbrown-600":"#6E4924","poopbrown-700":"#54371A","poopbrown-800":"#3B2510","poopbrown-900":"#29190A","poopbrown-950":"#110B04","puregray-100":"#F2F2F2","puregray-150":"#EBEBEB","puregray-200":"#E4E4E4","puregray-250":"#DDDDDD","puregray-300":"#D6D6D6","puregray-350":"#C3C3C3","puregray-400":"#ACACAC","puregray-450":"#919191","puregray-50":"#F8F8F8","puregray-500":"#767676","puregray-550":"#5C5C5C","puregray-600":"#434343","puregray-650":"#393939","puregray-700":"#303030","puregray-750":"#272727","puregray-800":"#1E1E1E","puregray-850":"#181818","puregray-900":"#131313","puregray-950":"#080808","red-100":"#FBDBD4","red-200":"#FDB3A4","red-25":"#FDF6F5","red-300":"#FF8773","red-400":"#FF4F40","red-50":"#FCEEEA","red-500":"#EB001F","red-600":"#BC0117","red-700":"#90000F","red-75":"#FBE4DF","red-800":"#650405","red-900":"#340F05","red-950":"#1F0B04","sakurapink-100":"#FBD9EB","sakurapink-200":"#FDAEDA","sakurapink-25":"#FDF6F9","sakurapink-300":"#FF7ECA","sakurapink-400":"#FF38BB","sakurapink-50":"#FCEDF4","sakurapink-500":"#DE019F","sakurapink-600":"#B2007F","sakurapink-700":"#880060","sakurapink-75":"#FBE3EF","sakurapink-800":"#5F0443","sakurapink-900":"#380626","sakurapink-950":"#250419",transparent:"transparent",white:"#ffffff","white-opacity-0":"#FFFFFF00","white-opacity-10":"#FFFFFF19","white-opacity-15":"#FFFFFF26","white-opacity-20":"#FFFFFF33","white-opacity-25":"#FFFFFF3F","white-opacity-5":"#FFFFFF0C","white-opacity-50":"#FFFFFF7F","yellow-100":"#FFE284","yellow-200":"#FFBF0B","yellow-25":"#FFF9E0","yellow-300":"#D8A100","yellow-400":"#B78800","yellow-50":"#FFF3C0","yellow-500":"#977000","yellow-600":"#785800","yellow-700":"#5B4200","yellow-75":"#FFEAA2","yellow-800":"#3F2D00","yellow-900":"#231A03","yellow-950":"#161003","yelloworange-100":"#FCDCC8","yelloworange-200":"#FDB586","yelloworange-25":"#FDF7F3","yelloworange-300":"#FF8A35","yelloworange-400":"#E46C00","yelloworange-50":"#FCEEE6","yelloworange-500":"#BD5800","yelloworange-600":"#974500","yelloworange-700":"#733300","yelloworange-75":"#FBE5D7","yelloworange-800":"#4E2402","yelloworange-900":"#2A1705","yelloworange-950":"#1A0E04","action-downvote":{light:"#6A5CFF",dark:"#6A5CFF"},"action-upvote":{light:"#D93900",dark:"#D93900"},"ai-background-weaker":{light:"#E7FDF5",dark:"#00382B"},"ai-plain":{light:"#006C56",dark:"#01A484"},"ai-plain-hover":{light:"#015140",dark:"#00C29D"},"alert-caution":{light:"#977000",dark:"#977000"},"avatar-gradient":{light:"",dark:""},"avatar-media-gradient":{light:"",dark:""},"brand-background":{light:"#D93900",dark:"#D93900"},"brand-background-hover":{light:"#AE2C00",dark:"#AE2C00"},"brand-gradient-active":{light:"",dark:""},"brand-gradient-active-highlight":{light:"",dark:""},"brand-gradient-default":{light:"",dark:""},"brand-gradient-default-highlight":{light:"",dark:""},"brand-gradient-hover":{light:"",dark:""},"brand-gradient-hover-highlight":{light:"",dark:""},"brand-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"category-live":{light:"#D93900",dark:"#D93900"},"category-nsfw":{light:"#DE019F",dark:"#DE019F"},"category-spoiler":{light:"#131313",dark:"#F2F2F2"},"caution-background":{light:"#FFBF0B",dark:"#D8A100"},"caution-background-hover":{light:"#D8A100",dark:"#FFBF0B"},"caution-onBackground":{light:"#000000",dark:"#000000"},"caution-plain":{light:"#785800",dark:"#FFBF0B"},"caution-plain-hover":{light:"#5B4200",dark:"#FFE284"},"danger-background":{light:"#EB001F",dark:"#BC0117"},"danger-background-disabled":{light:"#FDB3A4",dark:"#340F05"},"danger-background-hover":{light:"#BC0117",dark:"#EB001F"},"danger-background-weaker":{light:"#FBDBD4",dark:"#650405"},"danger-content":{light:"#BC0117",dark:"#FF4F40"},"danger-content-default":{light:"#ffffff",dark:"#ffffff"},"danger-content-hover":{light:"#90000F",dark:"#FF8773"},"danger-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"danger-plain":{light:"#BC0117",dark:"#FF8773"},"danger-plain-hover":{light:"#90000F",dark:"#FDB3A4"},"downvote-background":{light:"#6A5CFF",dark:"#6A5CFF"},"downvote-background-disabled":{light:"#6a5cff4d",dark:"#6a5cff4d"},"downvote-background-hover":{light:"#523DFF",dark:"#523DFF"},"downvote-content":{light:"#523DFF",dark:"#9580FF"},"downvote-content-weak":{light:"#6A5CFF",dark:"#6A5CFF"},"downvote-disabled":{light:"#523DFF4c",dark:"#9580FF4c"},"downvote-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"downvote-onStrongScrim":{light:"#B29FFF",dark:"#B29FFF"},"downvote-onStrongScrim-disabled":{light:"#b29fff4d",dark:"#b29fff4d"},"downvote-onStrongScrim-weaker":{light:"#9580FF",dark:"#9580FF"},"downvote-plain":{light:"#523DFF",dark:"#9580FF"},"downvote-plain-disabled":{light:"#523dff4d",dark:"#9580ff4d"},"downvote-plain-weaker":{light:"#6A5CFF",dark:"#6A5CFF"},"elevation-large1":{light:"#0000003F",dark:"#0000007F"},"elevation-large2":{light:"#00000026",dark:"#00000033"},"elevation-medium1":{light:"#0000003F",dark:"#0000007F"},"elevation-medium2":{light:"#00000019",dark:"#00000033"},"elevation-small":{light:"#00000026",dark:"#00000054"},"elevation-xsmall":{light:"#0000003F",dark:"#000000AA"},favorite:{light:"#977000",dark:"#B78800"},"global-admin":{light:"#D93900",dark:"#D93900"},"global-alienblue":{light:"#1870F4",dark:"#1870F4"},"global-darkblue":{light:"#2A3236",dark:"#2A3236"},"global-focus":{light:"Highlight",dark:"Highlight"},"global-gold":{light:"#B78800",dark:"#D8A100"},"global-moderator":{light:"#008A10",dark:"#008A10"},"global-nsfw":{light:"#DE019F",dark:"#DE019F"},"global-offline":{light:"#667780",dark:"#667780"},"global-online":{light:"#00C61C",dark:"#00C61C"},"global-orangered":{light:"#FF4500",dark:"#FF4500"},"global-stars":{light:"#977000",dark:"#D8A100"},"gradient-media":{light:"",dark:""},"gradient-media-strong":{light:"",dark:""},"identity-admin":{light:"#D93900",dark:"#D93900"},"identity-coins":{light:"#B78800",dark:"#B78800"},"identity-moderator":{light:"#008A10",dark:"#008A10"},"identity-self":{light:"#01876D",dark:"#01876D"},"interactive-background-disabled":{light:"#0000000C",dark:"#FFFFFF0C"},"interactive-content-disabled":{light:"#0000003F",dark:"#FFFFFF3F"},"interactive-focused":{light:"#007FAE",dark:"#007FAE"},"interactive-pressed":{light:"#00000026",dark:"#FFFFFF26"},"inverted-interactive-background-disabled":{light:"#FFFFFF0C",dark:"#0000000C"},"inverted-interactive-content-disabled":{light:"#FFFFFF3F",dark:"#0000003F"},"inverted-interactive-pressed":{light:"#FFFFFF26",dark:"#00000026"},"inverted-neutral-background":{light:"#0E1113",dark:"#FFFFFF"},"inverted-neutral-background-hover":{light:"#181C1F",dark:"#F6F8F9"},"inverted-neutral-border":{light:"#FFFFFF33",dark:"#00000033"},"inverted-neutral-content":{light:"#B7CAD4",dark:"#333D42"},"inverted-neutral-content-strong":{light:"#EEF1F3",dark:"#181C1F"},"inverted-secondary-background":{light:"#2A3236",dark:"#E5EBEE"},"inverted-secondary-background-hover":{light:"#333D42",dark:"#DBE4E9"},"inverted-secondary-background-selected":{light:"#3D494E",dark:"#C9D7DE"},"inverted-secondary-onBackground":{light:"#FFFFFF",dark:"#000000"},"inverted-secondary-plain":{light:"#DBE4E9",dark:"#181C1F"},"inverted-secondary-plain-hover":{light:"#FFFFFF",dark:"#000000"},"media-background":{light:"#00000099",dark:"#00000099"},"media-background-hover":{light:"#000000cc",dark:"#000000cc"},"media-background-selected":{light:"#000000cc",dark:"#000000cc"},"media-border-selected":{light:"#FFFFFF",dark:"#FFFFFF"},"media-border-weak":{light:"#FFFFFF19",dark:"#FFFFFF19"},"media-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"media-onBackground-disabled":{light:"#FFFFFF3F",dark:"#FFFFFF3F"},"media-onBackground-weak":{light:"#E5EBEE",dark:"#E5EBEE"},"media-onbackground":{light:"#ffffff",dark:"#ffffff"},"media-onbackground-disabled":{light:"#ffffff3f",dark:"#ffffff3f"},"media-onbackground-weak":{light:"#B7CAD4",dark:"#B7CAD4"},"neutral-background":{light:"#FFFFFF",dark:"#0E1113"},"neutral-background-container":{light:"#F6F8F9",dark:"#181C1F"},"neutral-background-container-hover":{light:"#EEF1F3",dark:"#21272A"},"neutral-background-container-strong":{light:"#EEF1F3",dark:"#21272A"},"neutral-background-container-strong-hover":{light:"#E5EBEE",dark:"#2A3236"},"neutral-background-gilded":{light:"#FFF9E0",dark:"#181C1F"},"neutral-background-gilded-hover":{light:"#FFF3C0",dark:"#21272A"},"neutral-background-highlighted":{light:"#F6F8F9",dark:"#181C1F"},"neutral-background-highlighted-strong":{light:"#FFF9E0",dark:"#2A3236"},"neutral-background-hover":{light:"#F6F8F9",dark:"#181C1F"},"neutral-background-medium":{light:"#F8F8F8",dark:"#131313"},"neutral-background-pinned":{light:"#FFFFFF",dark:"#0E1113"},"neutral-background-selected":{light:"#E5EBEE",dark:"#2A3236"},"neutral-background-strong":{light:"#FFFFFF",dark:"#181C1F"},"neutral-background-strong-hover":{light:"#F6F8F9",dark:"#21272A"},"neutral-background-weak":{light:"#F6F8F9",dark:"#000000"},"neutral-background-weak-hover":{light:"#EEF1F3",dark:"#0E1113"},"neutral-border":{light:"#00000033",dark:"#FFFFFF33"},"neutral-border-medium":{light:"#0000007F",dark:"#FFFFFF7F"},"neutral-border-strong":{light:"#181C1F",dark:"#F6F8F9"},"neutral-border-weak":{light:"#00000019",dark:"#FFFFFF19"},"neutral-content":{light:"#333D42",dark:"#B7CAD4"},"neutral-content-disabled":{light:"#D6D6D6",dark:"#303030"},"neutral-content-strong":{light:"#181C1F",dark:"#EEF1F3"},"neutral-content-weak":{light:"#5C6C74",dark:"#8BA2AD"},offline:{light:"#767676",dark:"#767676"},online:{light:"#01A816",dark:"#01A816"},"opacity-08":{light:"#13131314",dark:"#13131314"},"opacity-50":{light:"#0000007f",dark:"#F2F2F27f"},"opacity-highlight":{light:"",dark:""},pizzaRed:{light:"#ef5350",dark:"#c62828"},primary:{light:"#115BCA",dark:"#648EFC"},"primary-background":{light:"#0A449B",dark:"#115BCA"},"primary-background-hover":{light:"#0A2F6C",dark:"#1870F4"},"primary-background-selected":{light:"#0A1A3F",dark:"#648EFC"},"primary-border":{light:"#0A449B",dark:"#648EFC"},"primary-border-hover":{light:"#0A2F6C",dark:"#90A9FD"},"primary-hover":{light:"#0A449B",dark:"#90A9FD"},"primary-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"primary-onBackground-selected":{light:"#FFFFFF",dark:"#000000"},"primary-plain":{light:"#0A449B",dark:"#648EFC"},"primary-plain-hover":{light:"#0A2F6C",dark:"#90A9FD"},"primary-plain-visited":{light:"#7600A3",dark:"#CF5FFF"},"primary-visited":{light:"#9B00D4",dark:"#CF5FFF"},scrim:{light:"#00000099",dark:"#00000099"},"scrim-background":{light:"#00000099",dark:"#00000099"},"scrim-background-strong":{light:"#000000CC",dark:"#000000CC"},"scrim-gradient":{light:"",dark:""},"scrim-strong":{light:"#000000cc",dark:"#000000cc"},secondary:{light:"#21272A",dark:"#DBE4E9"},"secondary-background":{light:"#E5EBEE",dark:"#2A3236"},"secondary-background-hover":{light:"#DBE4E9",dark:"#333D42"},"secondary-background-selected":{light:"#C9D7DE",dark:"#3D494E"},"secondary-hover":{light:"#000000",dark:"#ffffff"},"secondary-onBackground":{light:"#000000",dark:"#FFFFFF"},"secondary-plain":{light:"#181C1F",dark:"#DBE4E9"},"secondary-plain-hover":{light:"#000000",dark:"#FFFFFF"},"secondary-plain-weak":{light:"#5C6C74",dark:"#8BA2AD"},"secondary-weak":{light:"#576F76",dark:"#748791"},"success-background":{light:"#008A10",dark:"#016E0B"},"success-background-hover":{light:"#016E0B",dark:"#008A10"},"success-content":{light:"#016E0B",dark:"#01A816"},"success-hover":{light:"#005306",dark:"#00C61C"},"success-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"success-plain":{light:"#016E0B",dark:"#00C61C"},"success-plain-hover":{light:"#005306",dark:"#58E15B"},"tone-1":{light:"#131313",dark:"#F2F2F2"},"tone-2":{light:"#434343",dark:"#ACACAC"},"tone-3":{light:"#ACACAC",dark:"#434343"},"tone-4":{light:"#E4E4E4",dark:"#303030"},"tone-5":{light:"#F2F2F2",dark:"#1E1E1E"},"tone-6":{light:"#F8F8F8",dark:"#131313"},"tone-7":{light:"#ffffff",dark:"#080808"},"transparent-background-hover":{light:"#74879119",dark:"#66778019"},"ui-canvas":{light:"#F2F2F2",dark:"#080808"},"ui-modalbackground":{light:"#FFFFFF",dark:"#181C1F"},"upvote-background":{light:"#D93900",dark:"#D93900"},"upvote-background-disabled":{light:"#d939004d",dark:"#d939004d"},"upvote-background-hover":{light:"#AE2C00",dark:"#AE2C00"},"upvote-content":{light:"#AE2C00",dark:"#FF4500"},"upvote-content-weak":{light:"#FF4500",dark:"#FF4500"},"upvote-disabled":{light:"#AE2C004c",dark:"#FF45004c"},"upvote-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"upvote-onStrongScrim":{light:"#FF895D",dark:"#FF895D"},"upvote-onStrongScrim-disabled":{light:"#ff895d4d",dark:"#ff895d4d"},"upvote-onStrongScrim-weaker":{light:"#FF4500",dark:"#FF4500"},"upvote-plain":{light:"#AE2C00",dark:"#FF895D"},"upvote-plain-disabled":{light:"#ae2c004d",dark:"#ff895d4d"},"upvote-plain-weaker":{light:"#FF4500",dark:"#FF4500"},"warning-background":{light:"#B78800",dark:"#B78800"},"warning-background-hover":{light:"#977000",dark:"#D8A100"},"warning-content":{light:"#785800",dark:"#B78800"},"warning-content-hover":{light:"#5B4200",dark:"#D8A100"},"warning-onBackground":{light:"#000000",dark:"#000000"}};var ol={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",transparent:"#FFFFFF00",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},al=i=>!!i.match(/^(#[0-9a-fA-F]{3,8}).*/),dl=i=>i in sa,oa=i=>i in ol,ll=i=>!!i.match(/^rgba?\(.*/),ul=i=>!!i.match(/^hsla?\(.*/),cl=(i,e="light")=>{if(oa(i))return lo(i);let r=sa[i];return typeof r=="string"?r:r[e]},lo=i=>ol[i]??i,ml=i=>{let[e,t,r,s]=i.replace(/^rgba?\(|\s+|\)$/g,"").split(",");if(!e||!t||!r)return i;let a=[...[e,t,r].map(m=>parseFloat(m))];if(s){let m=parseFloat(s),y=Math.round(m*255);a.push(y)}return`#${a.map(m=>m.toString(16).padStart(2,"0")).join("")}`};import{BlockStackDirection as uo}from"@devvit/protos";var aa={stackParentLayout:{hasHeight:!0,hasWidth:!0,direction:uo.UNRECOGNIZED,alignment:void 0}};function gl(i,e,t){if(!e)return{hasHeight:!1,hasWidth:!1};let{growDirection:r,stretchDirection:s}=Mm(i?.grow,e.direction,e.alignment),o=t?.height?.value?.value||t?.height?.min?.value||pl(2,r,s,e.hasHeight),a=t?.width?.value?.value||t?.width?.min?.value||pl(1,r,s,e.hasWidth);return{hasHeight:!!o,hasWidth:!!a}}function pl(i,e,t,r){return e===i&&r||t===i&&r}function Mm(i,e,t){let r=e===uo.STACK_VERTICAL||e===uo.UNRECOGNIZED,s=e===uo.STACK_HORIZONTAL,o=0;s&&i?o=1:r&&i&&(o=2);let a=t===void 0||t.horizontal===void 0,c=t===void 0||t.vertical===void 0,m=s?!!c:r?!!a:!1,y=0;return s&&m?y=2:r&&m&&(y=1),{growDirection:o,stretchDirection:y}}import{BlockSizeUnit as Nt,BlockStackDirection as co}from"@devvit/protos";function xi(i){if(i==null)return;if(typeof i=="number")return{value:i,unit:Nt.SIZE_UNIT_PERCENT};let e=i.match(/^(\d+(?:\.\d+)?)(px|%)?$/);if(e==null)return;let t=Nt.SIZE_UNIT_PERCENT;return e.at(2)==="px"&&(t=Nt.SIZE_UNIT_PIXELS),{value:Number.parseFloat(e[1]),unit:t}}function Dm(i,e){return(i.width?.value?.unit===Nt.SIZE_UNIT_PERCENT||i.width?.min?.unit===Nt.SIZE_UNIT_PERCENT)&&(e.direction===co.STACK_HORIZONTAL||e.direction===co.STACK_DEPTH)&&(e.hasWidth||(i.width=void 0)),(i.height?.value?.unit===Nt.SIZE_UNIT_PERCENT||i.height?.min?.unit===Nt.SIZE_UNIT_PERCENT)&&(e.direction===co.STACK_VERTICAL||e.direction===co.STACK_DEPTH)&&(e.hasHeight||(i.height=void 0)),i}function da(i,e){if(i){let t=i.width!=null||i.minWidth!=null||i.maxWidth!=null,r=i.height!=null||i.minHeight!=null||i.maxHeight!=null;if(t||r||i.grow!=null){let s={width:t?{value:xi(i.width),min:xi(i.minWidth),max:xi(i.maxWidth)}:void 0,height:r?{value:xi(i.height),min:xi(i.minHeight),max:xi(i.maxHeight)}:void 0,grow:i.grow};return e.stackParentLayout&&(s=Dm(s,e.stackParentLayout)),s}}}var bl="data-",Bm=new Set(["onPress","onMessage"]),Nm=new Map([["onPress",ya.ACTION_CLICK],["onMessage",ya.ACTION_WEBVIEW]]),zr,Ti=class{constructor(e=()=>{}){l(this,zr);d(this,zr,e)}createBlocksElementOrThrow({type:e,props:t,children:r}){let s=this.createBlocksElement({type:e,props:t,children:r},aa);if(!s)throw new Error(`Could not create block of type ${e}`);return s}createBlocksElement({type:e,props:t,children:r},s){switch(e){case"blocks":return this.makeRoot(t,...r);case"hstack":return this.makeHStack(t,s,...r);case"vstack":return this.makeVStack(t,s,...r);case"zstack":return this.makeZStack(t,s,...r);case"text":return this.makeText(t,s,...r);case"button":return this.makeButton(t,s,...r);case"image":return this.makeImage(t,s);case"spacer":return this.makeSpacer(t,s);case"icon":return this.makeIcon(t,s);case"avatar":return this.makeAvatar(t,s);case"webview":return this.makeWebView(t,s);case"__fragment":throw new Error("root fragment is not supported - use 'blocks' instead")}}makeRootHeight(e){switch(e){case"regular":return 320;case"tall":return 512}}makeBlockPadding(e){switch(e){case"none":return Gr.PADDING_NONE;case"xsmall":return Gr.PADDING_XSMALL;case"small":return Gr.PADDING_SMALL;case"medium":return Gr.PADDING_MEDIUM;case"large":return Gr.PADDING_LARGE}}makeBlockRadius(e){switch(e){case"none":return Jr.RADIUS_NONE;case"small":return Jr.RADIUS_SMALL;case"medium":return Jr.RADIUS_MEDIUM;case"large":return Jr.RADIUS_LARGE;case"full":return Jr.RADIUS_FULL}}makeBlockGap(e){switch(e){case"none":return po.GAP_NONE;case"small":return po.GAP_SMALL;case"medium":return po.GAP_MEDIUM;case"large":return po.GAP_LARGE}}makeBlockAlignment(e){if(e===void 0)return;let t,r;if(e.includes("top")?t=fa.ALIGN_TOP:e.includes("middle")?t=fa.ALIGN_MIDDLE:e.includes("bottom")&&(t=fa.ALIGN_BOTTOM),e.includes("start")?r=ua.ALIGN_START:e.includes("center")?r=ua.ALIGN_CENTER:e.includes("end")&&(r=ua.ALIGN_END),t!==void 0||r!==void 0)return{vertical:t,horizontal:r}}makeBlockBorder(e,t,r,s){if(!e&&!t)return;let o;switch(e){case"none":o=mo.BORDER_WIDTH_NONE;break;case"thin":o=mo.BORDER_WIDTH_THIN;break;case"thick":o=mo.BORDER_WIDTH_THICK;break;default:o=mo.BORDER_WIDTH_THIN;break}let a=t??"neutral-border-weak",c=this.getThemedColors(a,r,s);return{width:o,color:c?.light,colors:c}}makeBlockTextSize(e){switch(e){case"xsmall":return Ii.TEXT_SIZE_XSMALL;case"small":return Ii.TEXT_SIZE_SMALL;case"medium":return Ii.TEXT_SIZE_MEDIUM;case"large":return Ii.TEXT_SIZE_LARGE;case"xlarge":return Ii.TEXT_SIZE_XLARGE;case"xxlarge":return Ii.TEXT_SIZE_XXLARGE}}makeBlockTextStyle(e){switch(e){case"body":return ha.TEXT_STYLE_BODY;case"metadata":return ha.TEXT_STYLE_METADATA;case"heading":return ha.TEXT_STYLE_HEADING}}makeBlockTextOutline(e){switch(e){case"none":return pa.TEXT_OUTLINE_NONE;case"thin":return pa.TEXT_OUTLINE_THIN;case"thick":return pa.TEXT_OUTLINE_THICK}}makeBlockTextWeight(e){switch(e){case"regular":return yl.TEXT_WEIGHT_REGULAR;case"bold":return yl.TEXT_WEIGHT_BOLD}}makeBlockTextOverflow(e){switch(e){case"clip":return ga.TEXT_OVERFLOW_CLIP;case"ellipsis":return ga.TEXT_OVERFLOW_ELLIPSE}return ga.TEXT_OVERFLOW_ELLIPSE}makeBlockButtonAppearance(e){switch(e){case"secondary":return it.BUTTON_APPEARANCE_SECONDARY;case"primary":return it.BUTTON_APPEARANCE_PRIMARY;case"plain":return it.BUTTON_APPEARANCE_PLAIN;case"bordered":return it.BUTTON_APPEARANCE_BORDERED;case"media":return it.BUTTON_APPEARANCE_MEDIA;case"destructive":return it.BUTTON_APPEARANCE_DESTRUCTIVE;case"caution":return it.BUTTON_APPEARANCE_CAUTION;case"success":return it.BUTTON_APPEARANCE_SUCCESS}}makeBlockButtonSize(e){switch(e){case"small":return la.BUTTON_SIZE_SMALL;case"medium":return la.BUTTON_SIZE_MEDIUM;case"large":return la.BUTTON_SIZE_LARGE}}makeBlockImageResizeMode(e){switch(e){case"none":return Vr.IMAGE_RESIZE_NONE;case"fit":return Vr.IMAGE_RESIZE_FIT;case"fill":return Vr.IMAGE_RESIZE_FILL;case"cover":return Vr.IMAGE_RESIZE_COVER;case"scale-down":return Vr.IMAGE_RESIZE_SCALE_DOWN}}makeBlockSpacerSize(e){switch(e){case"xsmall":return ho.SPACER_XSMALL;case"small":return ho.SPACER_SMALL;case"medium":return ho.SPACER_MEDIUM;case"large":return ho.SPACER_LARGE}}makeBlockSpacerShape(e){switch(e){case"invisible":return ca.SPACER_INVISIBLE;case"thin":return ca.SPACER_THIN;case"square":return ca.SPACER_SQUARE}}makeBlockIconSize(e){switch(e){case"xsmall":return go.ICON_SIZE_XSMALL;case"small":return go.ICON_SIZE_SMALL;case"medium":return go.ICON_SIZE_MEDIUM;case"large":return go.ICON_SIZE_LARGE}}makeBlockAvatarSize(e){switch(e){case"xxsmall":return tt.AVATAR_SIZE_XXSMALL;case"xsmall":return tt.AVATAR_SIZE_XSMALL;case"small":return tt.AVATAR_SIZE_SMALL;case"medium":return tt.AVATAR_SIZE_MEDIUM;case"large":return tt.AVATAR_SIZE_LARGE;case"xlarge":return tt.AVATAR_SIZE_XXLARGE;case"xxlarge":return tt.AVATAR_SIZE_XXLARGE;case"xxxlarge":return tt.AVATAR_SIZE_XXXLARGE}}makeBlockAvatarFacing(e){switch(e){case"left":return fl.AVATAR_FACING_LEFT;case"right":return fl.AVATAR_FACING_RIGHT}}makeBlockAvatarBackground(e){switch(e){case"dark":return hl.AVATAR_BG_DARK;case"light":return hl.AVATAR_BG_LIGHT}}getDataSet(e){return Object.keys(e).filter(t=>t.startsWith(bl)).reduce((t,r)=>(t[r.substring(bl.length)]=e[r],t),{})}makeActions(e,t){let r=[],s=this.getDataSet(t);return Bm.forEach(o=>{if(o in t){let a=t[o];r.push({type:Nm.get(o)??ya.UNRECOGNIZED,id:a.toString(),data:s})}}),r}blockColorToHex(e,t="light"){if(e)return e=e.toLowerCase(),al(e)?e:dl(e)?cl(e,t):oa(e)?lo(e):ll(e)?ml(e):ul(e)?e:(console.warn(`Could not parse color: ${e}.`),lo("red"))}childrenToBlocks(e,t){return e.flatMap(r=>(typeof r!="string"?this.createBlocksElement(r,t):void 0)??[])}getThemedColors(e,t,r){let s=this.blockColorToHex(t,"light"),o=this.blockColorToHex(r,"dark"),a=[];if(e&&(!s||!o)){let c=Array.from(e?.matchAll(/[\w#-]+(?:\([\w\t ,.#-]+\))?/g)??[]);a.push(...c.map(m=>m[0]))}return s||(s=this.blockColorToHex(a?.at(0),"light")),o||(o=this.blockColorToHex(a?.at(1)??a?.at(0),"dark")),s||o?{light:s,dark:o}:void 0}parsePixels(e){return typeof e=="string"?Number(e.slice(0,-2)):e}resolveAssetUrl(e,t){return n(this,zr).call(this)?.getURL(e,t)??e}childrenToString(e){return e.map(t=>t.toString()).join("")}makeRoot(e,...t){return this.wrapRoot(e,this.childrenToBlocks(t,aa))}wrapRoot(e,t){return this.makeBlock(Re.BLOCK_ROOT,{},{},{rootConfig:{children:t,height:this.makeRootHeight(u.customPostType?.height??e?.height??"regular")}})}makeStackBlock(e,t,r,s){let o=this.getThemedColors(t?.backgroundColor,t?.lightBackgroundColor,t?.darkBackgroundColor),a=this.makeBlockAlignment(t?.alignment),c=da(t,r),m=gl(t,r.stackParentLayout,c);return this.makeBlock(Re.BLOCK_STACK,t,r,{stackConfig:{alignment:a,backgroundColor:o?.light,backgroundColors:o,border:this.makeBlockBorder(t?.border,t?.borderColor,t?.lightBorderColor,t?.darkBorderColor),children:this.childrenToBlocks(s,{stackParentLayout:{...m,direction:e,alignment:a}}),cornerRadius:this.makeBlockRadius(t?.cornerRadius),direction:e,gap:this.makeBlockGap(t?.gap),padding:this.makeBlockPadding(t?.padding),reverse:t?.reverse}})}makeHStack(e,t,...r){return this.makeStackBlock(ma.STACK_HORIZONTAL,e,t,r)}makeVStack(e,t,...r){return this.makeStackBlock(ma.STACK_VERTICAL,e,t,r)}makeZStack(e,t,...r){return this.makeStackBlock(ma.STACK_DEPTH,e,t,r)}makeText(e,t,...r){let s=this.getThemedColors(e?.color,e?.lightColor,e?.darkColor);return this.makeBlock(Re.BLOCK_TEXT,e,t,{textConfig:{alignment:this.makeBlockAlignment(e?.alignment),color:s?.light,colors:s,outline:this.makeBlockTextOutline(e?.outline),size:this.makeBlockTextSize(e?.size),style:this.makeBlockTextStyle(e?.style),text:this.childrenToString(r),weight:this.makeBlockTextWeight(e?.weight),selectable:e?.selectable,wrap:e?.wrap,overflow:this.makeBlockTextOverflow(e?.overflow)}})}makeButton(e,t,...r){let s=this.getThemedColors(e?.textColor,e?.lightTextColor,e?.darkTextColor);return this.makeBlock(Re.BLOCK_BUTTON,e,t,{buttonConfig:{buttonAppearance:this.makeBlockButtonAppearance(e?.appearance),icon:e?.icon,buttonSize:this.makeBlockButtonSize(e?.size),text:this.childrenToString(r),textColor:s?.light,textColors:s,disabled:e?.disabled}})}makeImage(e,t){return e&&this.makeBlock(Re.BLOCK_IMAGE,e,t,{imageConfig:{description:e?.description,resizeMode:this.makeBlockImageResizeMode(e.resizeMode),url:this.resolveAssetUrl(e.url),width:this.parsePixels(e.imageWidth),height:this.parsePixels(e.imageHeight)}})}makeSpacer(e,t){return this.makeBlock(Re.BLOCK_SPACER,e,t,{spacerConfig:{size:this.makeBlockSpacerSize(e?.size),shape:this.makeBlockSpacerShape(e?.shape)}})}makeIcon(e,t){let r=this.getThemedColors(e?.color,e?.lightColor,e?.darkColor);return e&&this.makeBlock(Re.BLOCK_ICON,e,t,{iconConfig:{icon:e.name,color:r?.light,colors:r,size:this.makeBlockIconSize(e.size)}})}makeAvatar(e,t){return e&&this.makeBlock(Re.BLOCK_AVATAR,e,t,{avatarConfig:{thingId:e.thingId,size:this.makeBlockAvatarSize(e.size),facing:this.makeBlockAvatarFacing(e.facing),background:this.makeBlockAvatarBackground(e.background)}})}makeWebView(e,t){return e&&this.makeBlock(Re.BLOCK_WEBVIEW,e,t,{webviewConfig:{url:this.resolveAssetUrl(e.url,{webView:!0})}})}makeBlock(e,t,r,s){return{type:e,sizes:da(t,r),config:s,actions:(t&&this.makeActions(e,t))??[],id:t?.id,key:t?.key}}ensureRootBlock(e){let t;if(e.type===Re.BLOCK_ROOT?(e.config?.rootConfig&&u.customPostType?.height&&(e.config.rootConfig.height=this.makeRootHeight(u.customPostType?.height)),t=e):t=this.wrapRoot(void 0,[e]),!t)throw new Error("Could not create root block");return t}};zr=new WeakMap;function kl(i){if(typeof i=="string")throw new Error("Root element cannot be a string")}var Cl=i=>{let e="",t=i.props?Object.keys(i.props).map(r=>r==="onPress"?"":`${r}="${i.props[r]}"`).join(" "):"";e+=`<${i.type}${t?" "+t:""}>`;for(let r of i.children)typeof r=="string"?e+=r:e+=Cl(r);return e+=`</${i.type}>`,e};function Lm(i){return"  ".repeat(i)}function _m(i){let e="",t=0,r=i.split(/>\s*</);for(let s=0;s<r.length;s++){let o=r[s];s===0&&(o=o.trim()),s===r.length-1&&(o=o.trim());let a=o.charAt(0)==="/";a&&t--,e+=Lm(t),s!==0&&(e+="<"),e+=o,s!==r.length-1&&(e+=`>
`),!a&&o.indexOf("</")===-1&&o.charAt(o.length-1)!=="/"&&t++}return e}var Ce,Pl,$r,va,qr,Le=class{constructor(e,t,r,s,o){l(this,Ce);this.renderState={};this.currentComponentKey=[];this.currentHookIndex=0;this.actions=new Map;this.forms=new Map;this.realtimeChannels=[];this.realtimeUpdated=!1;this.pendingHooks=[];this.isRendering=!1;this.transformer=new Ti(()=>this.assets);this.effects=[];l(this,qr,!1);this.component=e,this.event=t,this.state={__renderState:{},...r},this.metadata=s,this.state.__realtimeChannels&&(this.realtimeChannels=this.state.__realtimeChannels);let a=ke({reconciler:this,hooks:!0,ui:!0,metadata:s});this.cache=a.cache,this.modLog=a.modLog,this.reddit=a.reddit,this.kvStore=a.kvStore,this.redis=a.redis,this.settings=a.settings,this.scheduler=a.scheduler,this.media=a.media,this.assets=a.assets,this.realtime=a.realtime,this.dimensions=o,this.ui=a.ui,this.hooks={useState:a.useState,useInterval:a.useInterval,useForm:a.useForm,useChannel:a.useChannel}}emitEffect(e,t){this.effects.push(t)}async render(){await this.reconcile(),this.isRendering=!0;let e=await this.buildBlocksUI();return this.isRendering=!1,e}makeUniqueActionID(e){let t=e,r=1;for(;this.actions.has(t);)t=`${e}.${r++}`;return t}async reconcile(){let e=h(this,Ce,$r).call(this),t={type:this.component,props:e,children:[]},r=await this.processBlock(t);if(kl(r),this.transformer.createBlocksElementOrThrow(r),this.isUserActionRender&&this.blockRenderEventId){let s=this.actions.get(this.blockRenderEventId);s&&await s(this.event.data)}for(let s of this.pendingHooks)await s();this.buildNextState(),h(this,Ce,Pl).call(this)}async buildBlocksUI(){let e=h(this,Ce,$r).call(this),t={type:this.component,props:e,children:[]},r=await this.renderElement(e,t);return this.transformer.ensureRootBlock(r)}async renderElement(e,t){let r=await this.processBlock(t);return kl(r),(u.debug.emitSnapshots||e.debug.emitSnapshots)&&console.debug(_m(Cl(r))),(u.debug.emitState||e.debug.emitState)&&console.debug(JSON.stringify(this.state,void 0,2)),this.transformer.createBlocksElementOrThrow(r)}async processProps(e){let t=e.props??{},r=["onPress","onMessage"];for(let s of r)if(s in t){let o=t[s],a=o?.name,c=this.makeUniqueActionID(`${e.type}.${a??s}`);this.actions.set(c,o),t[s]=c}}async processBlock(e,t=sl(),r=[]){let s=e;if(typeof s.type=="string"){let c=[];for(let f=0;f<s.children.length;f++){let S=s.children[f];S!=null&&c.push(await this.processBlock(S,t,[...r,`${s.type}.${f}`]))}let m=c.flat(),y=h(this,Ce,va).call(this,m);return await this.processProps(s),{type:s.type,props:s.props,children:y}}if(typeof s.type=="function"){let c=t(`${r.length?r.join("."):"root"}.${s.type.name.length?s.type.name:"anonymous"}`);this.currentComponentKey.push(c),this.renderState[c]||(this.renderState[c]={});let m=s.children.flatMap(f=>f),y={...h(this,Ce,$r).call(this),...s.props,children:m},v;for(;v===void 0;)try{v=await s.type(y,h(this,Ce,$r).call(this))}catch(f){if(f instanceof Promise)v=await f;else throw f}if(!this.isInitialRender){let f=this.getPreviousComponentState();if(Object.keys(f).length!==this.currentHookIndex)throw new Error("Invalid hook call. Hooks can only be called at the top-level of a function component. Make sure that you are not calling hooks inside loops, conditions, or nested functions.")}if(this.currentComponentKey.pop(),this.currentHookIndex=0,typeof v=="object")return this.processBlock(v,t,[...r,s.type.name])}if(typeof s=="string")return s;if(typeof s=="number")return`${s}`;let o=[],a="";return Array.isArray(s)?o=s:typeof s.type>"u"&&s.children&&(o=s.children,a="fragmentChild."),{type:"__fragment",props:void 0,children:await Promise.all(o.flatMap(async(c,m)=>await this.processBlock(c,t,[...r,`${a}${m}`])))}}getCurrentComponentKey(){if(!this.currentComponentKey.at(-1))throw new Error("Current component key is missing");return this.currentComponentKey}getCurrentComponentState(){let e=this.currentComponentKey.at(-1);if(!e)throw new Error("Current component key is missing");return this.renderState[e]}getPreviousComponentState(){let e=this.currentComponentKey.at(-1);if(!e)throw new Error("Current component key is missing");return this.state.__renderState[e]||(this.state.__renderState[e]={}),this.state.__renderState[e]}get isInitialRender(){return this.event?this.event.type===ba.RENDER_INITIAL:!1}get isUserActionRender(){return this.event?this.event.type===ba.RENDER_USER_ACTION:!1}get isEffectRender(){return this.event?this.event.type===ba.RENDER_EFFECT_EVENT:!1}get formSubmittedEvent(){return this.event?this.event.formSubmitted:!1}get blockRenderEventId(){return this.event?this.event.id:!1}get realtimeEvent(){if(!this.event)return!1;let e=this.event.realtimeEvent;return e?.event?.channel?e:!1}runHook(e){this.pendingHooks.push(e)}rerenderIn(e){n(this,qr)||(d(this,qr,!0),this.effects.push({type:vl.EFFECT_RERENDER_UI,rerenderUi:{delaySeconds:e/1e3}}))}addRealtimeChannel(e){this.realtimeChannels.push(e),this.realtimeUpdated=!0}removeRealtimeChannel(e){this.realtimeChannels=this.realtimeChannels.filter(t=>t!==e),this.realtimeUpdated=!0}get realtimeEffect(){return this.realtimeUpdated&&this.realtimeChannels.length>0?[{type:vl.EFFECT_REALTIME_SUB,realtimeSubscriptions:{subscriptionIds:this.realtimeChannels}}]:[]}getEffects(){return[...Fi(this.ui),...this.effects,...this.realtimeEffect]}buildNextState(){for(let e of Object.keys(this.renderState))this.renderState[e]=Object.values(this.renderState[e]);this.state={__postData:this.state.__postData,__renderState:this.renderState,__cache:this.state.__cache,...this.realtimeChannels.length>0?{__realtimeChannels:this.realtimeChannels}:{}}}};Ce=new WeakSet,Pl=function(){this.actions.clear(),this.currentComponentKey=[],this.currentHookIndex=0,this.pendingHooks=[],this.realtimeChannels=[],this.realtimeUpdated=!1},$r=function(){let e={...se(this.metadata,this.state.__postData?.thingId),modLog:this.modLog,reddit:this.reddit,cache:this.cache,kvStore:this.kvStore,redis:this.redis,settings:this.settings,scheduler:this.scheduler,media:this.media,assets:this.assets,realtime:this.realtime,ui:this.ui,dimensions:this.dimensions,uiEnvironment:{timezone:this.metadata[P.Timezone]?.values[0],locale:this.metadata[P.Language]?.values[0],dimensions:this.dimensions},...this.hooks};return e.debug.effects=this,e},va=function(e){let t=[];for(let r of e)typeof r=="string"?t.push(r):r.type==="__fragment"?t.push(...h(this,Ce,va).call(this,r.children)):t.push(r);return t},qr=new WeakMap;async function Wm(i,e){let t=u.customPostType;if(!t)throw new Error("Custom post type not registered");let r=new Le((o,a)=>t.render(a),i.blocks,i.state,e,i.dimensions),s=await r.render();return jm.fromJSON({state:r.state,blocks:{ui:s},effects:r.getEffects()})}function Sl(i){i.provides(Hm),O("RenderPost",Wm)}import{GetFieldsResponse as Vm,InstallationSettingsDefinition as Gm}from"@devvit/protos";async function Jm(){return Vm.fromJSON({fields:{fields:Ne(u.installationSettings??[])}})}async function zm(i,e){return ao(i,u.installationSettings,e)}function wl(i){i.provides(Gm),O("GetSettingsFields",Jm),O("ValidateForm",zm)}import{ContextActionDefinition as $m,ContextActionList as qm,ContextActionResponse as Km}from"@devvit/protos";function ka(i){let e=i.metadata[P.User].values[0];if(!e)throw new Error("User missing from context");return e}function Ca(i){let e=i.metadata[P.Subreddit].values[0];if(!e)throw new Error("Subreddit missing from context");return e}async function Fl(i,e){let t=ka(i),r=Ca(i);if(!t||!r)throw new Error("User or subreddit missing from context");let s=e.comment?.id&&`t1_${e.comment.id}`,o=e.post?.id&&`t3_${e.post.id}`,a=e.subreddit?.id&&`t5_${e.subreddit.id}`,c=s||o||a;if(!c)throw new Error("targetId is missing from ContextActionRequest");if(s){let f=await i.reddit.getCommentById(s);if(!f)throw new Error(`Comment ${s} not found`);if(f.subredditId!==r)throw new Error("Comment does not belong to the subreddit")}if(o){let f=await i.reddit.getPostById(o);if(!f)throw new Error(`Post ${o} not found`);if(f.subredditId!==r)throw new Error("Post does not belong to the subreddit")}if(a&&a!==r)throw new Error(`Subreddit ${a} ${r} not found`);let m=Kr(e.actionId);if(!m)throw new Error("Action not found");let y=!!m.forUserType?.includes("moderator");if(y&&!xl(i))throw new Error("User is not a moderator");let v={needsModCheck:y};await i.redis.set(`${t}${r}${c}${e.actionId}`,JSON.stringify(v)),await i.redis.expire(`${t}${r}${c}${e.actionId}`,600)}async function xl(i){let e=ka(i),t=Ca(i),r=await i.reddit.getSubredditInfoById(t);return!!(await i.reddit.getModerators({subredditName:r.name}).all()).find(o=>o.id===e)}async function Il(i,e){let t=ka(i),r=Ca(i),{actionId:s,thingId:o}=e.state?.__contextAction??{},a=await i.redis.get(`${t}${r}${o}${s}`);if(!a)throw new Error("CSRF token not found");if(JSON.parse(a).needsModCheck&&!await xl(i))throw new Error("User is not a moderator: "+t+"; "+r)}var Tl=i=>`menuItem.${i}`;function Kr(i){return u.menuItems.find((e,t)=>Tl(t)===i)}function Pa(i,e){return i?Array.isArray(i.location)?i.location.includes(e):i.location===e:!1}async function Xm(i,e){let r=u.menuItems.map((s,o)=>({actionId:Tl(o),name:s.label,description:s.description,contexts:{subreddit:s.location.includes("subreddit"),post:s.location.includes("post"),comment:s.location.includes("comment")},users:{loggedOut:s.forUserType?.includes("loggedOut"),moderator:s.forUserType?.includes("moderator")},postFilters:s.postFilter==="currentApp"?{currentApp:!0}:void 0}));return qm.fromJSON({actions:r})}async function Zm(i,e){let t=Kr(i.actionId);if(!t)throw new Error(`MenuItem ${i.actionId} not found`);let r=i.comment?.id&&`t1_${i.comment.id}`,s=i.post?.id&&`t3_${i.post.id}`,o=i.subreddit?.id&&`t5_${i.subreddit.id}`,a=r||s||o;p(a,"targetId is missing from ContextActionRequest");let c={targetId:a,location:i.comment?"comment":i.post?"post":"subreddit"},m=Object.assign(ke({ui:!0,metadata:e}),se(e,s,r),{uiEnvironment:{timezone:e[P.Timezone]?.values[0],locale:e[P.Language]?.values[0]}});return await Fl(m,i),await t.onPress(c,m),Km.fromJSON({effects:Fi(m.ui)})}function Al(i){i.provides($m),O("GetActions",Xm),O("OnAction",Zm)}function Fe(i){return i?i===!0?!0:i.enabled:!1}import{SchedulerHandlerDefinition as Qm}from"@devvit/protos";async function Ym(i,e){let t=i.type,r=u.scheduledJobHandlers?.get(t);if(!r)throw new Error(`Job ${t} not found`);let s={name:t,data:i.data},o=Object.assign(ke({metadata:e}),se(e));return await r(s,o),{}}function El(i){i.provides(Qm),O("HandleScheduledAction",Ym)}import{OnAppInstallDefinition as ep,OnAppUpgradeDefinition as tp,OnAutomoderatorFilterCommentDefinition as ip,OnAutomoderatorFilterPostDefinition as rp,OnCommentCreateDefinition as np,OnCommentDeleteDefinition as sp,OnCommentReportDefinition as op,OnCommentSubmitDefinition as ap,OnCommentUpdateDefinition as dp,OnModActionDefinition as lp,OnModMailDefinition as up,OnPostCreateDefinition as cp,OnPostDeleteDefinition as mp,OnPostFlairUpdateDefinition as pp,OnPostNsfwUpdateDefinition as gp,OnPostReportDefinition as hp,OnPostSpoilerUpdateDefinition as fp,OnPostSubmitDefinition as yp,OnPostUpdateDefinition as bp}from"@devvit/protos";var rt;(function(i){function e(a,c){return a.length<=c?a:`${a.slice(0,c-1)}\u2026`}i.ellipsize=e;function t(a){return a[0]==null?a:`${a[0].toLocaleUpperCase()}${a.slice(1)}`}i.capitalize=t;function r(a){return a==null||/^\s*$/.test(a)}i.isBlank=r;function s(a,c="stack"){return a instanceof Error?`${a[c]||a.stack||a.message||a.name}`:String(a)}i.caughtToString=s;function o(a,c="stack"){return a instanceof Error?`${a[c]||a.stack||a.message||a.name}`:String(a)}i.caughtToStringUntyped=o})(rt||(rt={}));function q(i,e){return p(e),async(t,r)=>{let s={...t,type:i},o=Object.assign(ke({metadata:r}),se(r)),a=await Promise.allSettled(e.map(m=>m(s,o))),c=vp(a);if(c)throw c.err;return{}}}function Rl(i){for(let e of u.triggerOnEventHandlers.keys())switch(e){case"PostSubmit":i.provides(yp),O("OnPostSubmit",q("PostSubmit",u.triggerOnEventHandlers.get(e)));break;case"PostCreate":i.provides(cp),O("OnPostCreate",q("PostCreate",u.triggerOnEventHandlers.get(e)));break;case"PostUpdate":i.provides(bp),O("OnPostUpdate",q("PostUpdate",u.triggerOnEventHandlers.get(e)));break;case"PostReport":i.provides(hp),O("OnPostReport",q("PostReport",u.triggerOnEventHandlers.get(e)));break;case"PostDelete":i.provides(mp),O("OnPostDelete",q("PostDelete",u.triggerOnEventHandlers.get(e)));break;case"PostFlairUpdate":i.provides(pp),O("OnPostFlairUpdate",q("PostFlairUpdate",u.triggerOnEventHandlers.get(e)));break;case"CommentSubmit":i.provides(ap),O("OnCommentSubmit",q("CommentSubmit",u.triggerOnEventHandlers.get(e)));break;case"CommentCreate":i.provides(np),O("OnCommentCreate",q("CommentCreate",u.triggerOnEventHandlers.get(e)));break;case"CommentUpdate":i.provides(dp),O("OnCommentUpdate",q("CommentUpdate",u.triggerOnEventHandlers.get(e)));break;case"CommentReport":i.provides(op),O("OnCommentReport",q("CommentReport",u.triggerOnEventHandlers.get(e)));break;case"CommentDelete":i.provides(sp),O("OnCommentDelete",q("CommentDelete",u.triggerOnEventHandlers.get(e)));break;case"AppInstall":i.provides(ep),O("OnAppInstall",q("AppInstall",u.triggerOnEventHandlers.get(e)));break;case"AppUpgrade":i.provides(tp),O("OnAppUpgrade",q("AppUpgrade",u.triggerOnEventHandlers.get(e)));break;case"ModAction":i.provides(lp),O("OnModAction",q("ModAction",u.triggerOnEventHandlers.get(e)));break;case"ModMail":i.provides(up),O("OnModMail",q("ModMail",u.triggerOnEventHandlers.get(e)));break;case"PostNsfwUpdate":i.provides(gp),O("OnPostNsfwUpdate",q("PostNsfwUpdate",u.triggerOnEventHandlers.get(e)));break;case"PostSpoilerUpdate":i.provides(fp),O("OnPostSpoilerUpdate",q("PostSpoilerUpdate",u.triggerOnEventHandlers.get(e)));break;case"AutomoderatorFilterPost":i.provides(rp),O("OnAutomoderatorFilterPost",q("AutomoderatorFilterPost",u.triggerOnEventHandlers.get(e)));break;case"AutomoderatorFilterComment":i.provides(ip),O("OnAutomoderatorFilterComment",q("AutomoderatorFilterComment",u.triggerOnEventHandlers.get(e)));break;default:throw new Error(`Unknown trigger event: ${e}`)}}function vp(i){let e=i.reduce((t,r)=>r.status==="rejected"?[...t,r.reason]:t,[]);if(e.length!==0)return e.length===1?{err:e[0]}:{err:new Error(e.map(t=>rt.caughtToString(t)).join(`
`))}}import{EffectType as Vp,HandleUIEventResponse as Fa,UIEventHandlerDefinition as Gp}from"@devvit/protos";var ql=hd(Vl(),1);function Gl(i){return i?.constructor===Object}function Lt(i,e){return Object.is(i,e)?!0:typeof i!=typeof e?!1:Array.isArray(i)&&Array.isArray(e)?Jl(i,e):i instanceof Date&&e instanceof Date?i.getTime()===e.getTime():i instanceof RegExp&&e instanceof RegExp?i.toString()===e.toString():Gl(i)&&Gl(e)?Wp(i,e):i instanceof ArrayBuffer&&e instanceof ArrayBuffer?zl(new DataView(i),new DataView(e)):i instanceof DataView&&e instanceof DataView?zl(i,e):$l(i)&&$l(e)?i.byteLength!==e.byteLength?!1:Jl(i,e):!1}function Wp(i,e){let t=Object.keys(i),r=Object.keys(e);if(!Lt(t,r))return!1;for(let s of t)if(!Lt(i[s],e[s]))return!1;return!0}function Jl(i,e){return i.length!==e.length?!1:i.every((t,r)=>Lt(t,e[r]))}function zl(i,e){if(i.byteLength!==e.byteLength)return!1;for(let t=0;t<i.byteLength;t++)if(i.getUint8(t)!==e.getUint8(t))return!1;return!0}function $l(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}async function Jp(i,e){let t=i.state??{},r=(0,ql.default)(t),s=ke({ui:!0,metadata:e});if(i.event?.formSubmitted&&i.event.formSubmitted.formId){let m=i.event.formSubmitted.formId;if(m.includes("form.hook.")&&u.customPostType){let b=new Le((_,I)=>u.customPostType?.render(I)??null,i.event,i.state,e,void 0);return await b.reconcile(),Fa.fromJSON({state:b.state,effects:b.getEffects()})}let y=u.formDefinitions?.get(m);if(!y)throw new Error(`Form with key ${m} not found`);let v,f;if(r.__contextAction){let{actionId:b,thingId:_}=r.__contextAction,I=Kr(b);Pa(I,"post")?v=_:Pa(I,"comment")&&(f=_)}let S=Object.assign(s,se(e,v,f),{uiEnvironment:{timezone:e[P.Timezone]?.values[0],locale:e[P.Language]?.values[0]}});await Il(S,i),await y.onSubmit({values:Ke(i.event.formSubmitted.results)},S)}else if(i.event?.realtimeEvent){if(u.customPostType){let m=new Le((y,v)=>u.customPostType?.render(v)??null,i.event,i.state,e,void 0);return await m.reconcile(),Fa.fromJSON({state:m.state,effects:m.getEffects()})}}else if(i.event?.toastAction)throw new Error("Toast actions not yet implemented");let o=!Lt(t,r),a=Fi(s.ui),c=o?[...a,{type:Vp.EFFECT_RERENDER_UI,rerenderUi:{delaySeconds:0}}]:a;return Fa.fromJSON({state:r,effects:c})}function Kl(i){i.provides(Gp),O("HandleUIEvent",Jp)}import{CustomPostDefinition as Ao,UIResponse as Pu}from"@devvit/protos";import{UIEventScope as Yp}from"@devvit/protos";var xa="ServerCallRequired";function fo(i){return i?.message===xa}var Ea={now(){return new Date}};function Xl(i){return`__autocache__${i}`}function Zl(i){return`__lock__${i}`}var zp=300,$p=1e3,yo=5e3,Ia=3,Ql=.1,Yl=1e3,qp=3e4;function eu(i){if(i.error)throw new Error(i.error);return i.value}var nt,st,Pe,Ai,$,tu,iu,ru,Ta,nu,su,Aa,ou,bo=class{constructor(e,t,r=Ea){l(this,$);l(this,nt);l(this,st,{});l(this,Pe);l(this,Ai);d(this,nt,e),d(this,Ai,t),d(this,Pe,r)}async cache(e,t){var a;(a=n(this,Ai)).__cache??(a.__cache={}),d(this,st,n(this,Ai).__cache),h(this,$,ou).call(this,t);let r=h(this,$,tu).call(this,t.key);if(r!==void 0)return r;let s=await h(this,$,Aa).call(this,t.key),o=await h(this,$,iu).call(this,t,s,e);return eu(o)}};nt=new WeakMap,st=new WeakMap,Pe=new WeakMap,Ai=new WeakMap,$=new WeakSet,tu=function(e){let t=n(this,st)[e];if(t){let r=n(this,Pe).now().getTime(),s=t?.error&&t?.errorTime&&t.errorCount<Ia&&Math.random()<Ql&&t.errorTime+Yl<r;if(t?.expires&&t.expires<r&&t.checkedAt+Yl<r||s){delete n(this,st)[e];return}else return eu(t)}},iu=async function(e,t,r){let s=t?.expires,o=s?h(this,$,su).call(this,s):1;return!t||t?.error&&t.errorCount<Ia&&Ql>Math.random()||o>Math.random()?h(this,$,ru).call(this,e,t,r):t},ru=async function(e,t,r){let s=Zl(e.key),o=n(this,Pe).now().getTime(),a=new Date(o+e.ttl/2);if(await n(this,nt).set(s,"1",{expiration:a,nx:!0}))return h(this,$,nu).call(this,e.key,t,r,e.ttl);if(t)return t;{let m=n(this,Pe).now();return h(this,$,Ta).call(this,m,e.key,e.ttl)}},Ta=async function(e,t,r){let s=Math.min(r,$p),o=await h(this,$,Aa).call(this,t);if(o)return o;if(n(this,Pe).now().getTime()-e.getTime()>=s)throw new Error(`Cache request timed out trying to get data at key: ${t}`);return await new Promise(a=>setTimeout(a,zp)),h(this,$,Ta).call(this,e,t,r)},nu=async function(e,t,r,s){let o=n(this,Pe).now().getTime()+s;t=t??{value:null,expires:o,errorCount:0,error:null,errorTime:null,checkedAt:0};try{t.value=await r(),t.error=null,t.errorCount=0,t.errorTime=null}catch(a){t.value=null,t.error=a.message??"Unknown error",t.errorTime=n(this,Pe).now().getTime(),t.errorCount++}return n(this,st)[e]=t,await n(this,nt).set(Xl(e),JSON.stringify(t),{expiration:new Date(o+qp)}),t.error&&t.errorCount<Ia&&await n(this,nt).del(Zl(e)),t},su=function(e){let t=n(this,Pe).now().getTime(),r=e-t;return r<0?1:r<1e3?.1:r<2e3?.01:r<3e3?.001:0},Aa=async function(e){let t=await n(this,nt).get(Xl(e));if(t){let r=JSON.parse(t);return r.checkedAt=n(this,Pe).now().getTime(),n(this,st)[e]=r,r}},ou=function(e){e.ttl<yo&&(console.warn(`Cache TTL cannot be less than ${yo} milliseconds! Updating ttl value of ${e.ttl} to ${yo}.`),e.ttl=yo)};function au(i,e,t=Ea){let r=new bo(i,e,t);return r.cache.bind(r)}import{EffectType as vo,ToastAppearance as uu}from"@devvit/protos";function du(i){let e=i.match(/form\.hook\.(.+)\.0/);if(e?.[1])return e[1]}var Ra=class{constructor(e,t,r){this.state=null;this.hookId=e.hookId,this.form=t,this.onSubmit=r,this.onUIEvent=async s=>{s.formSubmitted&&await r(Ke(s.formSubmitted.results))}}};function Oa(i,e){let t=me({namespace:"useForm",initializer:r=>new Ra(r,i,e)});return Kp({id:t.hookId})}function Kp(i){return`form.hook.${i.id}.0`}function lu(i,e){let t=du(e);return i.getHook({id:t})}var _e,Co,Xr,Po,ko=class{constructor(e){l(this,_e);l(this,Co,0);l(this,Xr);l(this,Po,(e,t)=>{let r=t!==void 0?e:"",s=t!==void 0?t:e;n(this,_e).emitEffect(`postMessage${fd(this,Co)._++}`,{type:vo.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:r,app:{message:s,jsonString:JSON.stringify(s)}}}})});d(this,_e,e),d(this,Xr,{postMessage:n(this,Po)})}get webView(){return n(this,Xr)}showForm(e,t){return this.showFormInternal(e,t)}showFormInternal(e,t,r){let s=lu(n(this,_e),e);if(!s)throw new Error("Form does not exist. Make sure you have added it using useForm.");let o=r??(s.form instanceof Function?s.form(t??{}):s.form),a={fields:[],id:e,title:o.title,acceptLabel:o.acceptLabel,cancelLabel:o.cancelLabel,shortDescription:o.description};Ut(o.fields),a.fields=Ne(o.fields),n(this,_e).emitEffect(e,{type:vo.EFFECT_SHOW_FORM,showForm:{form:a}})}showToast(e){let t;e instanceof Object?t={text:e.text,appearance:e.appearance==="success"?uu.SUCCESS:uu.NEUTRAL}:t={text:e},n(this,_e).emitEffect(e.toString(),{type:vo.EFFECT_SHOW_TOAST,showToast:{toast:t}})}navigateTo(e){let t=typeof e=="string"?e:e.url;if(!URL.canParse(t))throw new TypeError(`Invalid URL: ${t}`);let r=new URL(t).toString();n(this,_e).emitEffect(r,{type:vo.EFFECT_NAVIGATE_TO_URL,navigateToUrl:{url:r}})}};_e=new WeakMap,Co=new WeakMap,Xr=new WeakMap,Po=new WeakMap;import{EffectType as Xp,RealtimeSubscriptionStatus as cu}from"@devvit/protos";var ot,Oe,at,_t,Zr,Ma,So=class So{constructor(e,t){l(this,Zr);l(this,ot);l(this,Oe);l(this,at);l(this,_t);d(this,ot,t.context),d(this,Oe,!!t.context._devvitContext?.debug.realtime),d(this,_t,e),d(this,at,t.invalidate);let r=t.context.meta[P.App]?.values[0];if(!r)throw Error("useChannel missing app ID metadata");let s=t.context.meta[P.Installation]?.values[0];if(!s)throw Error("useChannel missing install ID from metadata");let o=`${r}:${s}:${e.name}`;if(Object.values(n(this,ot)._hooks).filter(c=>c instanceof So).some(c=>c.state.channel===o))throw Error(`useChannel channel names must be unique; "${o}" duplicated`);this.state={channel:o,connected:!1,subscribed:!1}}async onUIEvent(e){let t=e.realtimeEvent;if(!(!t||!this.state.subscribed))switch(t.status){case cu.REALTIME_SUBSCRIBED:n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" connected`),this.state.connected=!0,n(this,at).call(this),await n(this,_t).onSubscribed?.();break;case cu.REALTIME_UNSUBSCRIBED:n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" disconnected`),this.state.connected=!1,n(this,at).call(this),await n(this,_t).onUnsubscribed?.();break;default:n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" received message: ${JSON.stringify(e,void 0,2)}`),n(this,_t).onMessage(t.event?.data?.msg);break}}async send(e){if(n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" send message: ${JSON.stringify(e,void 0,2)}`),!this.state.subscribed||!this.state.connected)throw console.debug(`[realtime] "${this.state.channel}" send failed; channel not connected`),Error(`useChannel send failed; "${this.state.channel}" channel not connected`);await n(this,ot).devvitContext.realtime.send(this.state.channel,e)}get status(){return this.state.subscribed&&this.state.connected?2:this.state.subscribed&&!this.state.connected?1:!this.state.subscribed&&this.state.connected?3:4}subscribe(){this.state.subscribed||(n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" subscribed`),this.state.subscribed=!0,n(this,at).call(this),h(this,Zr,Ma).call(this))}unsubscribe(){this.state.subscribed&&(n(this,Oe)&&console.debug(`[realtime] "${this.state.channel}" unsubscribed`),this.state.subscribed=!1,n(this,at).call(this),h(this,Zr,Ma).call(this))}};ot=new WeakMap,Oe=new WeakMap,at=new WeakMap,_t=new WeakMap,Zr=new WeakSet,Ma=function(){let e=Object.values(n(this,ot)._hooks).filter(t=>t instanceof So&&t.state.subscribed).map(t=>t.state.channel);n(this,ot).emitEffect(this.state.channel,{type:Xp.EFFECT_REALTIME_SUB,realtimeSubscriptions:{subscriptionIds:e}})};var Ua=So;function Da(i){if(!i.name||/[^a-zA-Z0-9_]/.test(i.name))throw Error(`useChannel error: The name "${i.name}" you provided for the hook is invalid. Valid names can only contain letters, numbers, and underscores (_).`);let e=`useChannel:${i.name}`;return me({id:e,namespace:e,initializer:t=>new Ua(i,t)})}import{EffectType as Ba}from"@devvit/protos";function mu(i){return typeof i=="object"&&i!==null&&"__deleted"in i}var Ht,dt,Ei=class Ei{constructor(e,t){l(this,Ht);this._segments=[];l(this,dt,{});this._prevHooks={};this._prevHookId="";this._effects={};this._changed={};this._touched={};this._requeueEvents=[];this._rootProps={};this._generated={};this._undeliveredHandlers={};this.request=e,this.meta=t,d(this,Ht,e.state??{__cache:{}}),this._rootProps=e.props??{}}get devvitContext(){if(!this._devvitContext)throw new Error("Devvit context not available");return this._devvitContext}set devvitContext(e){this._devvitContext=e}get _changedState(){let e={__cache:n(this,Ht).__cache??{}};for(let r in this._changed)e[r]=this._state[r];let t=new Set(Object.keys(this._state));return Object.keys(n(this,dt)).forEach(r=>{r!=="__cache"&&t.delete(r)}),t.forEach(r=>{if(r==="__cache")return;let s={__deleted:!0};this._state[r]=e[r]=s}),e}get _hooks(){return n(this,dt)}set _hooks(e){this._prevHooks=n(this,dt),d(this,dt,e)}get _state(){return n(this,Ht)}set _state(e){d(this,Ht,e)}push(e){this._segments.push({...e,next:0})}pop(){this._segments.pop()}addUndeliveredEventHandler(e,t){this._undeliveredHandlers[e]=t}addGlobalUndeliveredEventHandler(e,t){Ei.addGlobalUndeliveredEventHandler(e,t)}getHook(e){return n(this,dt)[e.id]}static addGlobalUndeliveredEventHandler(e,t){Ei._staticUndeliveredHandlers[e]=t}async handleUndeliveredEvent(e){let t={...Ei._staticUndeliveredHandlers,...this._undeliveredHandlers};for(let[r,s]of Object.entries(t))await s(e,this)}emitEffect(e,t){this._effects[e]=t}addToRequeueEvents(...e){this._devvitContext?.debug.blocks&&console.debug("[blocks] requeueing events",e);let t=e.reduce((r,s)=>(s.retry?r.retry.push(s):r.normal.push(s),r),{retry:[],normal:[]});this._requeueEvents=[...t.retry,...this._requeueEvents,...t.normal]}get effects(){return Object.values(this._effects)}nextHookId(e){e.key===void 0&&(e.key=this._segments[this._segments.length-1].next+++""),this.push(e);try{let t=[];for(let s=this._segments.length-1;s>=0;s--){let o=this._segments[s];if(o.id){t.unshift(o.id);break}let a=[];o.namespace&&a.push(o.namespace),o.key!==void 0&&o.key!==!1&&a.push(o.key),t.unshift(a.join("-"))}let r=t.join(".");if(this._generated[r]&&!e.shared)throw new Error(`Hook id ${r} already used, cannot register another hook with the same id`);return this._generated[r]=!0,this._prevHookId=r,r}finally{this.pop()}}};Ht=new WeakMap,dt=new WeakMap,Ei._staticUndeliveredHandlers={};var Ri=Ei;var lt={};Ri.addGlobalUndeliveredEventHandler("intervals",async(i,e)=>{i.timer&&i.hook&&(delete lt[i.hook],e.emitEffect("timers",{type:Ba.EFFECT_SET_INTERVALS,interval:{intervals:lt}}))});var ut,Oi,Qr,Ui,Na=class{constructor(e,t,r){l(this,ut);l(this,Oi);l(this,Qr);l(this,Ui);this.state={duration:{seconds:0,nanos:0},running:!1};d(this,Oi,r.invalidate),d(this,ut,r.hookId),d(this,Qr,e),d(this,Ui,r.context);let s=Math.floor(t/1e3),o=t%1e3*1e6;this.state.duration={seconds:s,nanos:o}}onStateLoaded(){this.state.running?lt[n(this,ut)]={duration:this.state.duration}:delete lt[n(this,ut)]}async onUIEvent(e){await n(this,Qr).call(this)}start(){lt[n(this,ut)]={duration:this.state.duration},this.state.running=!0,n(this,Oi).call(this),n(this,Ui).emitEffect("timers",{type:Ba.EFFECT_SET_INTERVALS,interval:{intervals:lt}})}stop(){delete lt[n(this,ut)],this.state.running=!1,n(this,Oi).call(this),n(this,Ui).emitEffect("timers",{type:Ba.EFFECT_SET_INTERVALS,interval:{intervals:lt}})}};ut=new WeakMap,Oi=new WeakMap,Qr=new WeakMap,Ui=new WeakMap;function La(i,e){let t=me({namespace:"useInterval",initializer:r=>new Na(i,e,r)});return{start:()=>t.start(),stop:()=>t.stop()}}import{UIEventScope as Qp}from"@devvit/protos";var jt=class extends Error{};import{UIEventScope as pu}from"@devvit/protos";function Ha(i){if(i instanceof Error){if(i.message===xa)throw i;return console.error(i),{message:i.message,details:i.stack??""}}else return console.error(i),{message:"Unknown error",details:rt.caughtToString(i)}}var xe,Ue,Mi,Yr,Di,_a=class{constructor(e,t,r){l(this,xe);l(this,Ue);l(this,Mi);l(this,Yr);l(this,Di);d(this,xe,!!r.context.devvitContext.debug.useAsync),n(this,xe)&&console.debug("[useAsync] v1",t),this.state={data:null,load_state:"initial",error:null,depends:null},d(this,Ue,r.hookId),this.initializer=e,d(this,Mi,r.invalidate),d(this,Yr,r.context),this.localDepends=t.depends??null,d(this,Di,t)}onStateLoaded(){if(n(this,xe)&&console.debug("[useAsync] async onLoad ",n(this,Ue),this.state),n(this,xe)&&console.debug("[useAsync] async onLoad have ",this.localDepends,"and",this.state.depends),!Lt(this.localDepends,this.state.depends)||this.state.load_state==="initial"){n(this,xe)&&console.debug("[useAsync] attempting to resolve for hookId",n(this,Ue)),this.state.load_state="loading",this.state.depends=this.localDepends,n(this,Mi).call(this);let e={scope:pu.ALL,hook:n(this,Ue),async:!0,asyncRequest:{requestId:n(this,Ue)+"-"+JSON.stringify(this.state.depends)}};n(this,xe)&&console.debug("[useAsync] onLoad requeue"),n(this,Yr).addToRequeueEvents(e)}}async onUIEvent(e,t){if(e.asyncRequest){let r={requestId:e.asyncRequest.requestId};try{r.data={value:await this.initializer()}}catch(o){r.error=Ha(o)}let s={scope:pu.ALL,asyncResponse:r,hook:n(this,Ue)};n(this,xe)&&console.debug("[useAsync] onReq requeue"),t.addToRequeueEvents(s)}else if(e.asyncResponse){let r=n(this,Ue)+"-"+JSON.stringify(this.state.depends);e.asyncResponse.requestId===r?(this.state={...this.state,data:e.asyncResponse.data?.value??null,error:e.asyncResponse.error??null,load_state:e.asyncResponse.error?"error":"loaded"},n(this,Di).finally&&await n(this,Di).finally(this.state.data,this.state.error?new Error(this.state.error?.message??"Unknown error"):null),n(this,Mi).call(this)):n(this,xe)&&console.debug("[useAsync] onResp skip, stale event",e.asyncResponse.requestId," !== ",r)}else throw new Error("Unknown event type")}};xe=new WeakMap,Ue=new WeakMap,Mi=new WeakMap,Yr=new WeakMap,Di=new WeakMap;function Zp(i,e={}){let t=me({namespace:"useAsync",initializer:r=>new _a(i,e,r)});return{data:t.state.data,error:t.state.error,loading:t.state.load_state==="loading"}}var He,Bi,Wt,ct,ja=class{constructor(e,t){this.state={value:null,load_state:"initial",error:null};l(this,He);l(this,Bi);l(this,Wt);l(this,ct);d(this,Wt,e),d(this,ct,t.hookId),d(this,He,t.invalidate),d(this,Bi,t.context)}async onUIEvent(){if(this.state.load_state==="loading"&&this._promise){try{this.state.value=await this._promise,this.state.load_state="loaded"}catch(e){this.state.load_state="error",this.state.error=Ha(e)}n(this,He).call(this)}else console.warn(`Invalid state for hook (${n(this,ct)}):`,this.state.load_state,this._promise)}setter(e){this.state.value=e instanceof Function?e(this.state.value):e,this.state.load_state="loaded",n(this,He).call(this)}onStateLoaded(){if(this._promise=n(this,Bi)._prevHooks[n(this,ct)]?._promise,this.state.load_state==="loading")throw new jt;if(this.state.load_state==="error")throw new Error(this.state.error?.message??"Unknown error");if(this.state.load_state==="initial"){let e;try{e=n(this,Wt)instanceof Function?n(this,Wt).call(this):n(this,Wt)}catch(t){console.log("error in loading async",t),this.state.load_state="error",n(this,He).call(this);return}if(e instanceof Promise){this._promise=e,this.state.load_state="loading";let t={scope:Qp.ALL,asyncRequest:{requestId:n(this,ct)},hook:n(this,ct)};throw n(this,Bi).addToRequeueEvents(t),n(this,He).call(this),new jt}else this.state.value=e,this.state.load_state="loaded";n(this,He).call(this)}}};He=new WeakMap,Bi=new WeakMap,Wt=new WeakMap,ct=new WeakMap;function Wa(i){let e=me({namespace:"useState",initializer:t=>new ja(i,t)});return[e.state.value,e.setter.bind(e)]}var wo=class{buildContext(e,t,r){let s=new fi(r),o=new gi(r),a=new Ci(r),c=new vi(r),m=new Pi(r),y=new Si(r),v=new ko(e),f=new hi(r),S=new mi,b=new yi(r),_=au(a,e._state),I={modLog:s,kvStore:o,redis:a,reddit:c,scheduler:m,settings:y,media:f,assets:S,realtime:b,ui:v,useState:Wa,useChannel:Da,useInterval:La,useForm:Oa,cache:_,dimensions:t.env?.dimensions,uiEnvironment:{timezone:r[P.Timezone]?.values[0],locale:r[P.Language]?.values[0],dimensions:t.env?.dimensions,colorScheme:t.env?.colorScheme}},N=se(r,t.props?.postId);return N.debug.effects=e,{...N,...I}}};var pe=null;function gu(i){return JSON.parse(JSON.stringify(i))}function eg(i){if(!(i!==""&&!/[-.]/.test(i)))throw new Error(`Hook with namespace '${i}' is invalid. Hook namespaces cannot be empty string or contain dashes/dots because they are used as delimiters internally. Please update the hook namespace and try again.`)}function me({initializer:i,...e}){if(!pe)throw new Error("Hooks can only be declared at the top of a component.  You cannot declare hooks outside of components or inside of event handlers.  It's almost always a mistake to declare hooks inside of loops or conditionals.");eg(e.namespace);let t=pe.nextHookId(e),r=pe,s={hookId:t,invalidate:()=>{r._changed[t]=!0,r._state[t]=r?._hooks[t]?.state},context:pe},o=pe._state[t]===void 0||mu(pe._state[t]);pe._hooks[t]=pe._hooks[t]??i(s);let a=pe._hooks[t];return o||(a.state=pe._state[t]),a.onStateLoaded?.(),o&&a.state!==void 0&&a.state!==null&&s.invalidate(),a}var tg=null,Fo=128,Ni,To,en,F,oe,xo,hu,Va,fu,Ga,Ja,Io,za,yu,Vt=class{constructor(e){l(this,F);l(this,Ni);l(this,To,new wo);l(this,en,new Ti(()=>this._latestRenderContext?.devvitContext?.assets));this._latestRenderContext=null;n(this,F,oe)&&console.debug("[blocks] BlocksHandler v1"),d(this,Ni,e),tg=this}async handle(e,t){let r=new Ri(e,t),s=n(this,To).buildContext(r,e,t);r.devvitContext=s;let o,a=e.events.length-Fo,c=e.events;if(a>0){c=[];{let I=0;for(let N of e.events)I<a&&N.realtimeEvent?I++:c.push(N)}for(;c.length>Fo;)c.shift();console.warn(`dropped ${a} events`)}let y=!c.length||c.some(I=>!I.async),v=c.some(I=>I.blocking),f,S,b=[...c];c.length===0&&c.push({scope:Yp.ALL}),n(this,F,oe)&&console.debug("[blocks] starting processing events");let _=0;for(;c.length>0;){if(_++>Fo)throw new Error(`Exceeded maximum iterations of ${Fo}`);n(this,F,oe)&&console.debug("[blocks] processing events loop iteration",c.length);let I=[];if(!c[0].async)I.push(c.shift());else for(;c[0]?.async;)I.push(c.shift());if(!I.length)throw Error("batch must have at least one event");try{if(I[0].async){let B=gu(r._state);await h(this,F,hu).call(this,r,...I),r._state=B}else await h(this,F,fu).call(this,r,...I)}catch(B){if(!fo(B))throw B;if(n(this,F,oe)&&console.debug("[blocks] caught in handler",B),r._latestRenderContent=void 0,S){r._state=S._state,r._changed=f,r._effects=S._effects;let ai=b.map(cd=>{let md={...cd};return md.retry=!0,md});r.addToRequeueEvents(...ai);break}else throw fo(B)||console.error("[blocks] unhandled error in handler",B),B}n(this,F,oe)&&console.debug("[blocks] remaining events",r._requeueEvents);let N=[];for(let B of r._requeueEvents){if(!y&&!B.async){n(this,F,oe)&&console.debug("[blocks] NOT reprocessing event in BlocksHandler, sync mismatch A",B),N.push(B);continue}if(y&&B.async&&!v){n(this,F,oe)&&console.debug("[blocks] NOT reprocessing event in BlocksHandler, sync mismatch B",B),N.push(B);continue}n(this,F,oe)&&console.debug("[blocks] reprocessing event in BlocksHandler",B),c.push(B)}r._requeueEvents=N,c.length>0&&(f={...r._changed},S={_state:gu(r._state),_effects:{...r._effects}},b=[...c])}if(y){r._latestRenderContent||(r._latestRenderContent=h(this,F,Ga).call(this,n(this,Ni),r.request.props??{},r));let I=r._latestRenderContent;I&&(o=n(this,en).createBlocksElementOrThrow(I),o=n(this,en).ensureRootBlock(o))}return{state:r._changedState,effects:r.effects,blocks:o,events:r._requeueEvents}}};Ni=new WeakMap,To=new WeakMap,en=new WeakMap,F=new WeakSet,oe=function(){return!!this._latestRenderContext?.devvitContext.debug.blocks},xo=function(e,...t){e._hooks={},h(this,F,Ga).call(this,n(this,Ni),e.request.props??{},e)},hu=async function(e,...t){h(this,F,xo).call(this,e,...t),await Promise.all(t.map(async r=>{if(!r.async)throw new Error("You can't mix main and other queues in one batch.  This is likely a platform bug.  Please file an issue in the Discord for someone to help! https://discord.com/channels/1050224141732687912/1115441897079574620");await h(this,F,Va).call(this,e,r)}))},Va=async function(e,t){let r=e._hooks[t.hook];if(r?.onUIEvent)try{await r.onUIEvent(t,e)}catch(s){throw fo(s)?n(this,F,oe)&&console.error("Server call required",s):console.error("Error in event handler",s),s}else await e.handleUndeliveredEvent(t)},fu=async function(e,...t){for(let r of t)n(this,F,oe)&&console.log("[blocks] handling main queue event",r),n(this,F,oe)&&console.log("[blocks] before",e._state),h(this,F,xo).call(this,e,r),await h(this,F,Va).call(this,e,r),n(this,F,oe)&&console.log("[blocks] after",e._state);h(this,F,xo).call(this,e)},Ga=function(e,t,r){n(this,F,oe)&&console.debug("[blocks] renderRoot"),r._generated={},pe=r,this._latestRenderContext=r;try{let s=h(this,F,Ja).call(this,e,t,r);if(s.length!==1)throw new Error(`There can only be one root element, received: ${s.length}. Please wrap these elements in a <vstack></vstack> or <hstack></hstack> to continue. Fragments cannot be used as a root element.`);let o=s[0];if(o==="[object Promise]")throw new Error('Root elements cannot be async. To use data from an async endpoint, please use "const [data] = useState(async () => {/** your async code */})".');if(typeof o=="string")throw new Error("The root element must return a valid block, not a string. Try wrapping the element in a <text>your content</text> tag to continue.");return r._latestRenderContent=o,o}catch(s){if(s instanceof jt)return;throw s}finally{pe=null}},Ja=function(e,t,r){r.push({namespace:e.name||"anonymous",...t});try{let s=e(t,r.devvitContext);if(s instanceof Promise)throw new Error(`Components (found: ${e.name??"unknown component"}) cannot be async. To use data from an async endpoint, please use "const [data] = useState(async () => {/** your async code */})".`);return h(this,F,za).call(this,s,r)}finally{r.pop()}},Io=function(e,t){return e=e.flat(1/0),e.flatMap((r,s)=>(r&&typeof r=="object"&&"props"in r&&(r.props?.key||(r.props=r.props??{},r.props.key=`${s}`)),h(this,F,za).call(this,r,t)))},za=function(e,t){if(Array.isArray(e))return h(this,F,Io).call(this,e,t);if(ig(e))if(e.type===void 0)try{return t.push({namespace:"fragment",...e.props}),h(this,F,Io).call(this,e.children,t)}finally{t.pop()}else if(typeof e.type=="function"){let r={...e.props,children:e.children.flat(1/0)};return h(this,F,Ja).call(this,e.type,r,t)}else try{t.push({namespace:e.type,...e.props});let r=h(this,F,Io).call(this,e.children,t),s=h(this,F,yu).call(this,e.props??{});return[{type:e.type,children:r,props:s}]}finally{t.pop()}else return[(e??"").toString()]},yu=function(e){let t={};for(let r in e)if(!(typeof e[r]>"u"))if(typeof e[r]=="function"){let s=me({namespace:r,key:!1,initializer:({hookId:o})=>({hookId:o,state:null,onUIEvent:a=>{if(a.userAction)return e[r](a.userAction.data);if(a.webView?.postMessage){let c=a.webView.postMessage.jsonString?JSON.parse(a.webView.postMessage.jsonString):a.webView.postMessage.message;return e[r](c)}}})});t[r]=s.hookId,"captureHookRef"in e[r]&&e[r].captureHookRef()}else{let s=JSON.parse(JSON.stringify(e[r]));s!=null&&(t[r]=s)}return t};function ig(i){return typeof i=="object"&&i!=null&&"type"in i}var bu=i=>{let e=Number(i.trim().split(".").pop());return isNaN(e)?void 0:e},vu=i=>{let[e,t,r]=i.trim().split(";");if(!e||!t||!r){console.warn(`Received a malformed devvit-user-agent! Received: '${i}'`);return}if(e!=="Reddit"){console.warn(`Received unknown company name in user agent! Received: '${i}'`);return}if(t==="iOS"){let s=bu(r);if(s===void 0){console.warn(`Could not parse version number from user agent! Received: '${i}'`);return}return{company:"Reddit",platform:"iOS",rawVersion:r,versionNumber:s}}if(t==="Android"){let s=bu(r);if(s===void 0){console.warn(`Could not parse version number from user agent! Received: '${i}'`);return}return{company:"Reddit",platform:"Android",rawVersion:r,versionNumber:s}}if(t==="Shreddit")return{company:"Reddit",platform:"Shreddit",rawVersion:r};console.warn("Received unknown platform:",t)},ku=i=>i?i.platform==="Android"?i.versionNumber<1875012:i.platform==="iOS"?i.versionNumber<614973:!1:(console.warn(`Could not parse devvit-user-agent! Received: '${JSON.stringify(i)}'`),!1),rg=i=>{switch(i){case"Android":return"https://play.google.com/store/apps/details?id=com.reddit.frontpage";case"iOS":return"https://apps.apple.com/us/app/reddit/id1064216828";case"Shreddit":break;default:console.error(`No upgrade link for platform: ${i}`)}},ng=({platform:i},e)=>u.createElement("blocks",null,u.createElement("vstack",{alignment:"middle center",height:100,width:100},u.createElement("vstack",{maxWidth:"300px",gap:"large",alignment:"middle center"},u.createElement("vstack",{gap:"medium",alignment:"middle center"},u.createElement("image",{imageHeight:100,imageWidth:100,url:"https://i.redd.it/p1vmc5ulmpib1.png"}),u.createElement("text",{size:"large",weight:"bold",wrap:!0,alignment:"center"},"Uh oh, the app you're trying to use requires the latest version of Reddit. Please upgrade your app to continue.")),u.createElement("hstack",{alignment:"middle center"},u.createElement("button",{onPress:()=>{let t=rg(i);t?e.ui.navigateTo(t):console.warn("No upgrade link found for platform:",i)}},"Upgrade"))))),Cu=i=>()=>u.createElement(ng,{platform:i});var sg=()=>u.createElement("vstack",{alignment:"center middle",width:"100%",height:"100%"},u.createElement("text",null,"This feature is not available yet")),og=[[Ao,Ao.methods.renderPostContent,(i,e)=>u.customPostType?.render(e)??null],[Ao,Ao.methods.renderPostComposer,(i,e)=>u.createElement(sg,null)]];function ag(i){return async(e,t)=>{let r=vu(t["devvit-user-agent"]?.values?.[0]??"");if(r&&ku(r)){let o=new Vt(Cu(r.platform));return Pu.fromJSON(await o.handle(e,t))}let s=new Vt(i);return Pu.fromJSON(await s.handle(e,t))}}function Su(i){for(let[e,t,r]of og)i.provides(e),O(t.name,ag(r))}var je,Gt,Jt,mt,We,zt,pt,gt,rn,Li,ht,nn,$t,j,Eo,wu,M=class M extends Zs{static configure(e){d(this,Gt,{...n(this,Gt),...e});let t=e.http,r=typeof t=="object"&&"domains"in t;Fe(r?{enabled:!0}:t)&&(r&&(yd(t.domains),d(this,Li,bd(t.domains))),this.use(k.HTTPDefinition)),(e.redis===void 0||Fe(e.kvStore)||Fe(e.redis))&&(this.use(k.KVStoreDefinition),this.use(k.RedisAPIDefinition)),Fe(e.media)&&this.use(k.MediaServiceDefinition),Fe(e.modLog)&&this.use(k.ModlogDefinition),Fe(e.redditAPI)&&(this.use(k.FlairDefinition),this.use(k.GraphQLDefinition),this.use(k.LinksAndCommentsDefinition),this.use(k.ListingsDefinition),this.use(k.ModerationDefinition),this.use(k.ModNoteDefinition),this.use(k.NewModmailDefinition),this.use(k.PrivateMessagesDefinition),this.use(k.SubredditsDefinition),this.use(k.UsersDefinition),this.use(k.WidgetsDefinition),this.use(k.WikiDefinition)),Fe(e.realtime)&&this.use(k.RealtimeDefinition);let a=e.userActions,m=typeof a=="object"&&"scopes"in a?{enabled:!0}:a;Fe(m)&&(this.use(k.UserActionsDefinition),d(this,ht,h(this,Eo,wu).call(this,e)))}static addMenuItem(e){this._initMenu(),n(this,zt).push(e)}static addCustomPostType(e){d(this,Jt,e)}static createForm(e,t){this._initForms();let r=`form.${n(this,mt).size}`;return n(this,mt).set(r,{form:e,onSubmit:t}),r}static addSchedulerJob(e){if(this._initScheduler(),n(this,pt).has(e.name))throw new Error(`Job ${e.name} is already defined`);n(this,pt).set(e.name,e.onRun)}static addSettings(e){var o;let t=Array.isArray(e)?e:[e],r=t.filter(a=>a.type==="group"||!a.scope||a.scope===ze.Installation),s=t.filter(a=>a.type!=="group"&&a.scope===ze.App);this._initSettings(s.length>0,r.length>0),r.length>0&&n(this,We).push(...r),s.length>0&&n(this,je).push(...s),Ut([...n(this,We)??[],...n(this,je)??[]]),n(this,j)[k.SettingsDefinition.fullName]||this.use(k.SettingsDefinition),globalThis.devvit??(globalThis.devvit={}),(o=globalThis.devvit).settings??(o.settings={}),globalThis.devvit.settings.app=n(this,je),globalThis.devvit.settings.installation=n(this,We)}static addTrigger(e){if("events"in e){for(let t of e.events)this.addTrigger({event:t,onEvent:(r,s)=>e.onEvent(r,s)});return this}return n(this,gt).has(e.event)?n(this,gt).get(e.event)?.push(e.onEvent):n(this,gt).set(e.event,[e.onEvent]),M}static provide(e){n(this,nn).push(e)}static use(e){n(this,$t)[e.fullName]={def:e,handler:void 0};let t={};for(let r of Object.values(e.methods))t[r.name]=(s,o)=>n(this,$t)[e.fullName].handler?.[r.name]?.(r.requestType?.fromPartial(s??{}),o);return n(this,j)[e.fullName]=t,t}static get redditAPIPlugins(){if(!Fe(n(this,Gt).redditAPI))throw new Error("Reddit API is not enabled. You can enable it by passing `redditAPI: true` to `Devvit.configure`.");return{Flair:n(this,j)[k.FlairDefinition.fullName],GraphQL:n(this,j)[k.GraphQLDefinition.fullName],LinksAndComments:n(this,j)[k.LinksAndCommentsDefinition.fullName],Listings:n(this,j)[k.ListingsDefinition.fullName],Moderation:n(this,j)[k.ModerationDefinition.fullName],ModNote:n(this,j)[k.ModNoteDefinition.fullName],NewModmail:n(this,j)[k.NewModmailDefinition.fullName],PrivateMessages:n(this,j)[k.PrivateMessagesDefinition.fullName],Subreddits:n(this,j)[k.SubredditsDefinition.fullName],Users:n(this,j)[k.UsersDefinition.fullName],Widgets:n(this,j)[k.WidgetsDefinition.fullName],Wiki:n(this,j)[k.WikiDefinition.fullName]}}static get modLogPlugin(){let e=n(this,j)[k.ModlogDefinition.fullName];if(!e)throw new Error("ModLog is not enabled. You can enable it by passing `modLog: true` to `Devvit.configure`");return e}static get schedulerPlugin(){let e=n(this,j)[k.SchedulerDefinition.fullName];if(!e)throw new Error("Scheduler is not enabled. You can enable it by calling `Devvit.addSchedulerJob` at the top level of your app.");return e}static get kvStorePlugin(){let e=n(this,j)[k.KVStoreDefinition.fullName];if(!e)throw new Error("Key Value Store is not enabled. You can enable it by passing `kvStore: true` to `Devvit.configure`");return e}static get redisPlugin(){let e=n(this,j)[k.RedisAPIDefinition.fullName];if(!e)throw new Error("Redis is not enabled. You can enable it by passing `redis: true` to `Devvit.configure`");return e}static get mediaPlugin(){let e=n(this,j)[k.MediaServiceDefinition.fullName];if(!e)throw new Error("MediaService is not enabled. You can enable it by passing `media: true` to `Devvit.configure`");return e}static get settingsPlugin(){let e=n(this,j)[k.SettingsDefinition.fullName];if(!e)throw new Error("Settings must first be configured with `Devvit.addSettings()` before they can be accessed");return e}static get realtimePlugin(){let e=n(this,j)[k.RealtimeDefinition.fullName];if(!e)throw new Error("Realtime is not enabled. You can enable it by passing `realtime: true` to `Devvit.configure`");return e}static get userActionsPlugin(){if(!(n(this,ht).length>0&&Fe(n(this,Gt).redditAPI)))throw new Error("UserActions is not enabled. You can enable it by passing scopes in `userActions: { scopes: [...scopes] }` and `redditAPI: true` to `Devvit.configure`");return n(this,j)[k.UserActionsDefinition.fullName]}static get scopes(){return n(this,ht)}static get menuItems(){return n(this,zt)??[]}static get customPostType(){return n(this,Jt)}static get formDefinitions(){return n(this,mt)}static get scheduledJobHandlers(){return n(this,pt)}static get installationSettings(){return n(this,We)}static get appSettings(){return n(this,je)}static get triggerOnEventHandlers(){return n(this,gt)}static get assets(){return globalThis.devvit?.assets??{}}static get webViewAssets(){return n(this,rn)}static _initForms(){n(this,mt)??d(this,mt,new Map)}static _initMenu(){n(this,zt)??d(this,zt,[])}static _initScheduler(){n(this,j)[k.SchedulerDefinition.fullName]||this.use(k.SchedulerDefinition),n(this,pt)??d(this,pt,new Map)}static _initSettings(e,t){e&&(n(this,je)??d(this,je,[])),t&&(n(this,We)??d(this,We,[]))}constructor(e){var t,r;super(e),globalThis.devvit??(globalThis.devvit={}),(t=globalThis.devvit).assets??(t.assets=e.assets),(r=globalThis.devvit).appConfig??(r.appConfig=globalThis.__devvit__?.config),d(M,rn,e.webviewAssets??{});for(let s in n(M,$t)){let o=n(M,$t)[s];o.handler=e.use(o.def)}n(M,zt)&&Al(e),n(M,pt)&&El(e),n(M,Jt)&&(Sl(e),Su(e)),(n(M,Jt)||n(M,mt))&&Kl(e),n(M,We)&&wl(e),n(M,je)&&nl(e),n(M,gt).size>0&&Rl(e);for(let s of n(M,nn))e.provides(s);(n(M,Li).length>0||n(M,ht).length>0)&&e.addPermissions?.({requestedFetchDomains:n(M,Li),asUserScopes:n(M,ht)})}static assertUserScope(e){let t=tn[e];if(!M.scopes.includes(e))throw Error(`To call this API with 'runAs: "USER"', set 'userActions: { scopes: [ Scope.${t} ] }' in your Devvit.configure().`)}};je=new WeakMap,Gt=new WeakMap,Jt=new WeakMap,mt=new WeakMap,We=new WeakMap,zt=new WeakMap,pt=new WeakMap,gt=new WeakMap,rn=new WeakMap,Li=new WeakMap,ht=new WeakMap,nn=new WeakMap,$t=new WeakMap,j=new WeakMap,Eo=new WeakSet,wu=function(e){let t=e.userActions;return t?typeof t=="boolean"&&t?[tn.SUBMIT_POST,tn.SUBMIT_COMMENT]:typeof t=="object"&&"enabled"in t&&t.enabled?"scopes"in t?t.scopes:[tn.SUBMIT_POST,tn.SUBMIT_COMMENT]:typeof t=="object"&&"scopes"in t?t.scopes:[]:[]},l(M,Eo),M.debug={},l(M,je),l(M,Gt,{}),l(M,Jt),l(M,mt),l(M,We),l(M,zt),l(M,pt),l(M,gt,new Map),l(M,rn,{}),l(M,Li,[]),l(M,ht,[]),l(M,nn,[]),l(M,$t,{}),l(M,j,{});var u=M;(e=>{function i(t,r,...s){return{type:t,props:r,children:s}}e.createElement=i})(u||(u={}));function X(i){let e=Object.getOwnPropertyDescriptors(i.constructor.prototype);for(let[t,r]of Object.entries(e))r.get&&Object.defineProperty(i,t,{...r,enumerable:!0})}var $a;(function(i){i[i.bold=1]="bold",i[i.italic=2]="italic",i[i.underline=4]="underline",i[i.strikethrough=8]="strikethrough",i[i.subscript=16]="subscript",i[i.superscript=32]="superscript",i[i.monospace=64]="monospace"})($a||($a={}));var Fu="text",xu="raw",Iu="br",Tu="link",Au="c/",Eu="p/",Ru="r/",Ou="u/",Uu="@",Mu="spoilertext",Du="par",Bu="h",Nu="hr",Lu="blockquote",_u="code",Hu="li",ju="list",Wu="L",Vu="R",Gu="C",Ju="table",zu="embed",$u="img",qu="gif",Ku="video";function Xu(i){return{e:qu,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur}}}function Zu(i,e){let t={},r=[];return Object.assign(t,sn(t,r),on(t,r),an(t,r),un(t,r),cn(t,r),mn(t,r)),e(t),{e:Lu,c:r,...i.author&&{a:i.author}}}function Qu(i,e){let t={},r=[];return Object.assign(t,Ka(t,r)),e(t),{e:_u,c:r,...i.language&&{l:i.language}}}function Yu(i){return{e:Au,t:i.permalink}}function ec(i,e){let t={},r=[];return Object.assign(t,Ka(t,r),ln(t,r)),e(t),{e:Bu,l:i.level,c:r}}function tc(i){return{e:zu,u:i.sourceUrl,c:i.contentUrl,x:i.width,y:i.height}}function ic(){return{e:Nu}}function rc(i){return{e:$u,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur}}}function nc(){return{e:Iu}}function sc(i){return{e:Tu,t:i.text,u:i.url,...i.formatting&&{f:i.formatting},...i.tooltip&&{a:i.tooltip}}}function oc(i,e){let t={},r=[];return Object.assign(t,Pc(t,r)),e(t),{e:ju,o:i.ordered,c:r}}function ac(i){let e={},t=[];return Object.assign(e,sn(e,t),on(e,t),an(e,t),Ro(e,t),un(e,t),cn(e,t),mn(e,t)),i(e),{e:Hu,c:t}}function dc(i){let e={},t=[];return Object.assign(e,Oo(e,t),ln(e,t),qa(e,t),Xa(e,t),dn(e,t)),i(e),{e:Du,c:t}}function lc(i){return{e:Eu,t:i.permalink}}function uc(i){return{e:xu,t:i}}function cc(i){let e={},t=[];return Object.assign(e,Oo(e,t),ln(e,t),qa(e,t)),i(e),{e:Mu,c:t}}function mc(i){return{e:Ru,t:i.subredditName,l:i.showPrefix}}function pc(i){let e={},t=[],r=[];return Object.assign(e,Sc(e,t,r)),i(e),{e:Ju,h:t,c:r}}function gc(i){let[e,t]=Cc();return i(e),{c:t}}function hc(i,e){let[t,r]=Cc();e(t);let s;switch(i.columnAlignment){case"left":s=Wu;break;case"right":s=Vu;break;case"center":s=Gu;break}return{...s&&{a:s},...r&&{c:r}}}function fc(i){let e={},t=[];return Object.assign(e,wc(e,t)),i(e),t}function yc(i){return{e:Fu,t:i.text,...i.formatting&&{f:i.formatting}}}function bc(i){return{e:Ou,t:i.username,l:i.showPrefix}}function vc(i){return{e:Uu,t:i.username,l:i.showPrefix}}function kc(i){return{e:Ku,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur},...i.thumbnail&&{p:i.thumbnail},...i.convertToGif&&{gifify:i.convertToGif}}}function Cc(){let i={},e=[];return Object.assign(i,Oo(i,e),ln(i,e),Xa(i,e),dn(i,e)),[i,e]}function sn(i,e){return{blockQuote(t,r){return e.push(Zu(t,r)),i}}}function on(i,e){return{codeBlock(t,r){return e.push(Qu(t,r)),i}}}function Fc(i,e){return{embed(t){return e.push(tc(t)),i}}}function an(i,e){return{heading(t,r){return e.push(ec(t,r)),i}}}function Ro(i,e){return{horizontalRule(){return e.push(ic()),i}}}function dn(i,e){return{image(t){return e.push(rc(t)),i},animatedImage(t){return e.push(Xu(t)),i}}}function qa(i,e){return{linebreak(){return e.push(nc()),i}}}function ln(i,e){return{link(t){return e.push(sc(t)),i},commentLink(t){return e.push(Yu(t)),i},postLink(t){return e.push(lc(t)),i},subredditLink(t){return e.push(mc(t)),i},userLink(t){return e.push(bc(t)),i},userMention(t){return e.push(vc(t)),i}}}function un(i,e){return{list(t,r){return e.push(oc(t,r)),i}}}function Pc(i,e){return{item(t){return e.push(ac(t)),i}}}function cn(i,e){return{paragraph(t){return e.push(dc(t)),i}}}function Ka(i,e){return{rawText(t){return e.push(uc(t)),i}}}function Xa(i,e){return{spoiler(t){return e.push(cc(t)),i}}}function Sc(i,e,t){return{headerCell(r,s){return e.push(hc(r,s)),i},row(r){return t.push(fc(r)),i}}}function mn(i,e){return{table(t){return e.push(pc(t)),i}}}function wc(i,e){return{cell(t){return e.push(gc(t)),i}}}function Oo(i,e){return{text(t){return e.push(yc(t)),i}}}function xc(i,e){return{video(t){return e.push(kc(t)),i}}}var dg=function(i,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!s:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(i,t):s?s.value=t:e.set(i,t),t},lg=function(i,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(i):r?r.value:e.get(i)},Uo,qt=class{constructor(){Uo.set(this,void 0);let e=[];Object.assign(this,cn(this,e),an(this,e),Ro(this,e),sn(this,e),on(this,e),Fc(this,e),un(this,e),mn(this,e),dn(this,e),xc(this,e)),dg(this,Uo,{document:e},"f")}build(){return JSON.stringify(lg(this,Uo,"f"))}paragraph(e){return this}heading(e,t){return this}horizontalRule(){return this}blockQuote(e,t){return this}codeBlock(e,t){return this}embed(e){return this}list(e,t){return this}table(e){return this}image(e){return this}animatedImage(e){return this}video(e){return this}};Uo=new WeakMap;function _i(i){let e;return i instanceof qt?e=i.build():typeof i=="object"?e=JSON.stringify(i):e=i,e}import"@devvit/protos";var ug=(t=>(t.User="USER_FLAIR",t.Post="LINK_FLAIR",t))(ug||{}),Kt,Hi,ji,Wi,Vi,Gi,Ji,zi,$i,qi,Ki,Mo,Ie=class Ie{constructor(e,t,r){l(this,Kt);l(this,Hi);l(this,ji);l(this,Wi);l(this,Vi);l(this,Gi);l(this,Ji);l(this,zi);l(this,$i);l(this,qi);X(this),p(e.id),p(e.text),d(this,Kt,e.id),d(this,Hi,t),d(this,ji,e.text),d(this,Wi,cg(e.textColor)),d(this,Vi,mg(e.backgroundColor)),d(this,Gi,pg(e.allowableContent)),d(this,Ji,e.modOnly),d(this,zi,e.maxEmojis),d(this,$i,e.textEditable),d(this,qi,r)}get id(){return n(this,Kt)}get text(){return n(this,ji)}get textColor(){return n(this,Wi)}get backgroundColor(){return n(this,Vi)}get allowableContent(){return n(this,Gi)}get modOnly(){return n(this,Ji)}get maxEmojis(){return n(this,zi)}get allowUserEdits(){return n(this,$i)}async delete(){return Ie.deleteFlairTemplate(n(this,Kt),n(this,Hi),n(this,qi))}async edit(e){return Ie.editFlairTemplate({id:n(this,Kt),subredditName:n(this,Hi),text:e.text??n(this,ji),allowableContent:e.allowableContent??n(this,Gi),backgroundColor:e.backgroundColor??n(this,Vi),maxEmojis:e.maxEmojis??n(this,zi),modOnly:e.modOnly??n(this,Ji),textColor:e.textColor??n(this,Wi),allowUserEdits:e.allowUserEdits??n(this,$i)},n(this,qi))}static async createPostFlairTemplate(e,t){var r;return h(r=Ie,Ki,Mo).call(r,{...e,flairType:"LINK_FLAIR"},t)}static async createUserFlairTemplate(e,t){var r;return h(r=Ie,Ki,Mo).call(r,{...e,flairType:"USER_FLAIR"},t)}static async editFlairTemplate(e,t){var r;return h(r=Ie,Ki,Mo).call(r,e,t)}static async getPostFlairTemplates(e,t){return(await u.redditAPIPlugins.Flair.LinkFlair({subreddit:e},t)).flair?.map(o=>new Ie(o,e,t))||[]}static async getUserFlairTemplates(e,t){return(await u.redditAPIPlugins.Flair.UserFlair({subreddit:e},t)).flair?.map(o=>new Ie(o,e,t))||[]}static async deleteFlairTemplate(e,t,r){await u.redditAPIPlugins.Flair.DeleteFlairTemplate({subreddit:e,flairTemplateId:t},r)}};Kt=new WeakMap,Hi=new WeakMap,ji=new WeakMap,Wi=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,Ji=new WeakMap,zi=new WeakMap,$i=new WeakMap,qi=new WeakMap,Ki=new WeakSet,Mo=async function(e,t){let{subredditName:r,allowableContent:s="all",backgroundColor:o="transparent",flairType:a="",maxEmojis:c=10,modOnly:m=!1,text:y,textColor:v="dark",allowUserEdits:f=!1,id:S=""}=e;if(m&&f)throw new Error("Cannot have a mod only flair that is editable by users");let _=await u.redditAPIPlugins.Flair.FlairTemplate({subreddit:r,allowableContent:s,backgroundColor:o,flairType:a,maxEmojis:c,modOnly:m,text:y,textColor:v,textEditable:f,flairTemplateId:S,cssClass:"",overrideCss:!1},t);return new Ie(_,r,t)},l(Ie,Ki);var ne=Ie;function pn(i){if(i.flairText||i.flairCssClass||i.flairTemplateId||i.flairRichtext?.length)return{backgroundColor:i.flairBackgroundColor,cssClass:i.flairCssClass,text:i.flairText,type:i.flairType,templateId:i.flairTemplateId,richtext:(i.flairRichtext??[]).map(({e,t,a:r,u:s})=>({elementType:e,text:t,emojiRef:r,url:s})),textColor:i.flairTextColor}}function gn(i){return{flairCssClass:i.flairCssClass,user:i.user,flairText:i.flairText}}var Me,Za,Ic,Qa,ft=class ft{static async getUserFlairBySubreddit(e,t){return u.redditAPIPlugins.Flair.FlairList(e,t)}static setUserFlair(e,t){var r;return h(r=ft,Me,Za).call(r,e,t)}static setUserFlairBatch(e,t,r){var s;return h(s=ft,Me,Ic).call(s,e,t,r)}static setPostFlair(e,t){var r;return h(r=ft,Me,Za).call(r,{...e,postId:de(e.postId)},t)}static async removePostFlair(e,t,r){var s;return h(s=ft,Me,Qa).call(s,e,t,void 0,r)}static async removeUserFlair(e,t,r){var s;return h(s=ft,Me,Qa).call(s,e,void 0,t,r)}};Me=new WeakSet,Za=async function(e,t){await u.redditAPIPlugins.Flair.SelectFlair({subreddit:e.subredditName,flairTemplateId:e.flairTemplateId??"",text:e.text??"",name:e.username??"",link:e.postId??"",backgroundColor:e.backgroundColor??"",textColor:e.textColor??"dark",cssClass:e.cssClass??"",returnRtjson:"none"},t)},Ic=async function(e,t,r){if(!t.length)return[];if(t.length>100)throw new Error("Unexpected input: flairs array cannot be longer than 100 entries.");let o=",",a=t.map(y=>{for(let v in y)if(y[v]?.includes(o))throw new Error(`Unexpected input: ${v} cannot contain the "," character`);return[y.username,y.text||"",y.cssClass||""].join(o)}).join(`
`);return(await u.redditAPIPlugins.Flair.FlairCsv({subreddit:e,flairCsv:a},r)).result},Qa=async function(e,t,r,s){await u.redditAPIPlugins.Flair.SelectFlair({subreddit:e,name:r??"",link:t??"",flairTemplateId:"",backgroundColor:"",text:"",textColor:"",cssClass:"",returnRtjson:"none"},s)},l(ft,Me);var ce=ft;function cg(i){if(p(i,"Flair text color is required"),i==="light"||i==="dark")return i;throw new Error(`Invalid flair text color: ${i}`)}function mg(i){if(!i||i.length===0||i==="transparent")return"transparent";if(/^#([A-Fa-f0-9]{6})$/.test(i))return i;throw new Error(`Invalid flair background color: ${i}`)}function pg(i){if(i==="all"||i==="text"||i==="emoji")return i;throw new Error(`Invalid allowable content: ${i}`)}var Tc=100,Ac=1/0,Xt,Zt,yt,Xi,Zi,Do,V=class{constructor(e){l(this,Zi);l(this,Xt);l(this,Zt);l(this,yt);l(this,Xi,!1);this.pageSize=Tc;this.limit=Ac;this.children=[];X(this),this._fetch=e.fetch,this.pageSize=e.pageSize??Tc,this.limit=e.limit??Ac,d(this,Zt,e.after),d(this,Xt,e.before),d(this,yt,e.more),e.children&&(this.children=e.children)}get hasMore(){return!n(this,Xi)||!!(n(this,Zt)||n(this,Xt)||n(this,yt))}async*[Symbol.asyncIterator](){let e=0;for(;;){if(e===this.children.length)if(this.hasMore){if((await h(this,Zi,Do).call(this)).length===0)break}else break;if(yield this.children[e],e++,e===this.limit)break}}setMore(e){d(this,yt,e)}preventInitialFetch(){d(this,Xi,!0)}async all(){for(;this.hasMore&&this.children.length<this.limit;)await h(this,Zi,Do).call(this);return this.children.slice(0,this.limit)}async get(e){let t=e<=this.limit?e:this.limit;for(;this.hasMore&&this.children.length<t;)await h(this,Zi,Do).call(this);return this.children.slice(0,t)}};Xt=new WeakMap,Zt=new WeakMap,yt=new WeakMap,Xi=new WeakMap,Zi=new WeakSet,Do=async function(){if(!this.hasMore)throw new Error("This listing does not have any more items to load.");let{children:e,before:t,after:r,more:s}=await this._fetch({before:n(this,Xt),after:n(this,Zt),limit:this.pageSize,more:n(this,yt)});return this.children.push(...e),d(this,Xt,t),d(this,Zt,r),d(this,yt,s),d(this,Xi,!0),e};var hn,Ya,ve=class{constructor(){}static get(e,t){let r=u.redditAPIPlugins.ModNote;return new V({hasMore:!0,before:e.before,limit:e.limit,pageSize:e.limit,fetch:async s=>{let o=await r.GetNotes({subreddit:e.subreddit,user:e.user,filter:e.filter,before:s.before,limit:s.limit},t);return{children:o.modNotes?.map(a=>h(this,hn,Ya).call(this,a))||[],before:o.hasNextPage?o.endCursor:void 0,hasMore:o.hasNextPage}}})}static async delete(e,t){let r=u.redditAPIPlugins.ModNote,{deleted:s}=await r.DeleteNotes(e,t);return!!s}static async add(e,t){let s=await u.redditAPIPlugins.ModNote.PostNotes(e,t);if(!s?.created)throw new Error("Failed to create mod note");return h(this,hn,Ya).call(this,s.created)}static async addRemovalNote(e,t){await u.redditAPIPlugins.ModNote.PostRemovalNote(e,t)}};hn=new WeakSet,Ya=function(e){return p(e.id,"Mod note ID is null or undefined"),p(e.createdAt,"Mod note createdAt is null or undefined"),p(e.type,"Mod note type is null or undefined"),p(e.subreddit,"Mod note subreddit is null or undefined"),p(e.subredditId,"Mod note subredditId is null or undefined"),p(e.operator,"Mod note operator is null or undefined"),p(e.operatorId,"Mod note operatorId is null or undefined"),p(e.user,"Mod note user is null or undefined"),p(e.userId,"Mod note userId is null or undefined"),p(e.userNoteData,"Mod note userNote is null or undefined"),p(e.modActionData,"Mod note modAction is null or undefined"),{id:e.id,user:{id:ie(e.userId??""),name:e.user},subreddit:{id:K(e.subredditId??""),name:e.subreddit},operator:{id:ie(e.operatorId??""),name:e.operator},createdAt:new Date(e.createdAt*1e3),userNote:{note:e.userNoteData?.note,redditId:e.userNoteData?.redditId?be(e.userNoteData?.redditId):void 0,label:e.userNoteData?.label},type:e.type}},l(ve,hn);var Z=class{static queryWithQueryString(e,t){return u.redditAPIPlugins.GraphQL.Query({query:e},t)}static query(e,t,r,s){return u.redditAPIPlugins.GraphQL.PersistedQuery({operationName:e,id:t,variables:r},s)}};var Ec=["all","wiki","posts","access","mail","config","flair","channels","chat_config","chat_operator","community_chat"];function gg(i,e){return e.map(t=>(i.includes(t)?"+":"-")+t).join(",")}function ed(i){return gg(i,Ec)}function Rc(i){return i.filter(e=>Ec.includes(e))}import{Block as Dc,UIResponse as Sg}from"@devvit/protos";import{Scope as Bc}from"@devvit/protos/json/reddit/devvit/app_permission/v1/app_permission.js";var rd=hd(Mc(),1);var id=i=>"text"in i?i.text:Pg(i.richtext),Pg=i=>i instanceof qt?i.build():typeof i=="object"?JSON.stringify(i):i;var wg={NONE:0,BLOCKS:1,UNRECOGNIZED:-1},mP={UNKNOWN:0,VALID:1,FAILED:2},Qi,yn,Yt,bn,Yi,vn,kn,Cn,ei,Pn,Sn,wn,Fn,xn,In,bt,Tn,An,ti,er,vt,tr,ir,rr,kt,Ct,Pt,nr,St,wt,Ft,Ve,En,Rn,On,sr,or,ar,U,D=class D{constructor(e,t){l(this,Qi);l(this,yn);l(this,Yt);l(this,bn);l(this,Yi);l(this,vn);l(this,kn);l(this,Cn);l(this,ei);l(this,Pn);l(this,Sn);l(this,wn);l(this,Fn);l(this,xn);l(this,In);l(this,bt);l(this,Tn);l(this,An);l(this,ti);l(this,er);l(this,vt);l(this,tr);l(this,ir);l(this,rr);l(this,kt);l(this,Ct);l(this,Pt);l(this,nr);l(this,St);l(this,wt);l(this,Ft);l(this,Ve);l(this,En);l(this,Rn);l(this,On);l(this,sr);l(this,or);l(this,ar);l(this,U);X(this),p(e.id,"Post is missing id"),p(e.title,"Post is missing title"),p(e.createdUtc,"Post is missing created date"),p(e.author,"Post is missing author name"),p(e.subreddit,"Post is missing subreddit name"),p(e.subredditId,"Post is missing subreddit id"),p(e.url,"Post is missing url"),p(e.permalink,"Post is missing permalink"),d(this,Qi,de(`t3_${e.id}`)),d(this,Yt,e.author),d(this,yn,e.authorFullname?ie(e.authorFullname):void 0),d(this,Yi,K(e.subredditId)),d(this,vn,e.subreddit),d(this,wn,e.score??0),d(this,Fn,e.numComments??0),d(this,xn,e.numReports??0);let r=new Date(0);r.setUTCSeconds(e.createdUtc),d(this,bn,r),d(this,Cn,e.title),d(this,ei,e.selftext),d(this,Pn,e.selftextHtml),d(this,Sn,e.url),d(this,kn,e.permalink),e.thumbnail&&e.thumbnail!=="self"&&e.thumbnail!=="nsfw"&&e.thumbnailHeight!=null&&e.thumbnailWidth!=null&&d(this,In,{url:e.thumbnail,height:e.thumbnailHeight,width:e.thumbnailWidth}),d(this,bt,e.approved??!1),d(this,Tn,e.approvedAtUtc??0),d(this,An,e.bannedAtUtc??0),d(this,vt,e.removed??!1),d(this,tr,e.removedBy),d(this,ir,e.removedByCategory),d(this,ti,e.spam??!1),d(this,er,e.stickied??!1),d(this,rr,e.archived??!1),d(this,kt,e.edited??!1),d(this,Ct,e.locked??!1),d(this,Pt,e.over18??!1),d(this,nr,e.quarantine??!1),d(this,St,e.spoiler),d(this,wt,e.hidden??!1),d(this,Ft,e.ignoreReports??!1),d(this,Ve,e.distinguished),d(this,On,e.secureMedia),d(this,sr,(e.modReports??[]).map(([s])=>s)),d(this,or,(e.userReports??[]).map(([s])=>s)),d(this,U,t),d(this,En,pn({flairBackgroundColor:e.linkFlairBackgroundColor,flairCssClass:e.linkFlairCssClass,flairText:e.linkFlairText,flairType:e.linkFlairType,flairTemplateId:e.linkFlairTemplateId,flairRichtext:e.linkFlairRichtext,flairTextColor:e.linkFlairTextColor})),d(this,Rn,pn({flairBackgroundColor:e.authorFlairBackgroundColor,flairCssClass:e.authorFlairCssClass,flairText:e.authorFlairText,flairType:e.authorFlairType,flairTemplateId:e.authorFlairTemplateId,flairRichtext:e.authorFlairRichtext,flairTextColor:e.authorFlairTextColor})),e.gallery?d(this,ar,e.gallery.map(s=>({status:s.status,url:s.url,height:s.height,width:s.width}))):d(this,ar,[])}get id(){return n(this,Qi)}get authorId(){return n(this,yn)}get authorName(){return n(this,Yt)}get subredditId(){return n(this,Yi)}get subredditName(){return n(this,vn)}get permalink(){return n(this,kn)}get title(){return n(this,Cn)}get body(){return n(this,ei)}get bodyHtml(){return n(this,Pn)}get url(){return n(this,Sn)}get thumbnail(){return n(this,In)}get createdAt(){return n(this,bn)}get score(){return n(this,wn)}get numberOfComments(){return n(this,Fn)}get numberOfReports(){return n(this,xn)}get approved(){return n(this,bt)}get approvedAtUtc(){return n(this,Tn)}get bannedAtUtc(){return n(this,An)}get spam(){return n(this,ti)}get stickied(){return n(this,er)}get removed(){return n(this,vt)}get removedBy(){return n(this,tr)}get removedByCategory(){return n(this,ir)}get archived(){return n(this,rr)}get edited(){return n(this,kt)}get locked(){return n(this,Ct)}get nsfw(){return n(this,Pt)}get quarantined(){return n(this,nr)}get spoiler(){return n(this,St)}get hidden(){return n(this,wt)}get ignoringReports(){return n(this,Ft)}get distinguishedBy(){return n(this,Ve)}get comments(){return Y.getComments({postId:this.id},n(this,U))}get flair(){return n(this,En)}get authorFlair(){return n(this,Rn)}get secureMedia(){return n(this,On)}get userReportReasons(){return n(this,or)}get modReportReasons(){return n(this,sr)}get gallery(){return n(this,ar)}toJSON(){return{id:this.id,authorId:this.authorId,authorName:this.authorName,subredditId:this.subredditId,subredditName:this.subredditName,permalink:this.permalink,title:this.title,body:this.body,bodyHtml:this.bodyHtml,url:this.url,thumbnail:this.thumbnail,score:this.score,numberOfComments:this.numberOfComments,numberOfReports:this.numberOfReports,createdAt:this.createdAt,approved:this.approved,spam:this.spam,stickied:this.stickied,removed:this.removed,removedBy:n(this,tr),removedByCategory:n(this,ir),archived:this.archived,edited:this.edited,locked:this.locked,nsfw:this.nsfw,quarantined:this.quarantined,spoiler:this.spoiler,hidden:this.hidden,ignoringReports:this.ignoringReports,distinguishedBy:this.distinguishedBy,flair:this.flair,authorFlair:this.authorFlair,secureMedia:this.secureMedia,modReportReasons:n(this,sr),userReportReasons:n(this,or)}}isApproved(){return n(this,bt)}isSpam(){return n(this,ti)}isStickied(){return n(this,er)}isRemoved(){return n(this,vt)}isArchived(){return n(this,rr)}isEdited(){return n(this,kt)}isLocked(){return n(this,Ct)}isNsfw(){return n(this,Pt)}isQuarantined(){return n(this,nr)}isSpoiler(){return n(this,St)}isHidden(){return n(this,wt)}isIgnoringReports(){return n(this,Ft)}isDistinguishedBy(){return n(this,Ve)}async edit(e){let t=await D.edit({id:this.id,...e},n(this,U));d(this,ei,t.body),d(this,kt,t.edited)}async setSuggestedCommentSort(e){await D.setSuggestedCommentSort({id:this.id,subredditId:n(this,Yi),suggestedSort:e},n(this,U))}async getPostData(){return(await D.getDevvitPostData(this.id,n(this,U)))?.developerData}async setPostData(e){let t=await D.getDevvitPostData(this.id,n(this,U));await D.setPostData({postId:this.id,postData:{...t,developerData:e}},n(this,U))}async setCustomPostPreview(e){await D.setCustomPostPreview({id:this.id,ui:e},n(this,U))}async setTextFallback(e){let t=await D.setTextFallback(e,this.id,n(this,U));d(this,ei,t.body),d(this,kt,t.edited)}async addComment(e){return Y.submit({id:this.id,...e},n(this,U))}async delete(){p(n(this,U));let e=n(this,U)?.[P.App]?.values[0];if(e!==n(this,Yt))throw new Error(`App '${e}' is not the author of Post ${this.id}, delete not allowed.`);return D.delete(this.id,n(this,U))}async approve(){await D.approve(this.id,n(this,U)),d(this,bt,!0),d(this,vt,!1)}async remove(e=!1){await D.remove(this.id,e,n(this,U)),d(this,vt,!0),d(this,ti,e),d(this,bt,!1)}async lock(){await D.lock(this.id,n(this,U)),d(this,Ct,!0)}async unlock(){await D.unlock(this.id,n(this,U)),d(this,Ct,!1)}async hide(){await D.hide(this.id,n(this,U)),d(this,wt,!0)}async unhide(){await D.unhide(this.id,n(this,U)),d(this,wt,!1)}async markAsNsfw(){await D.markAsNsfw(this.id,n(this,U)),d(this,Pt,!0)}async unmarkAsNsfw(){await D.unmarkAsNsfw(this.id,n(this,U)),d(this,Pt,!1)}async markAsSpoiler(){await D.markAsSpoiler(this.id,n(this,U)),d(this,St,!0)}async unmarkAsSpoiler(){await D.unmarkAsSpoiler(this.id,n(this,U)),d(this,St,!1)}async sticky(e){await D.sticky(this.id,e,n(this,U))}async unsticky(){await D.unsticky(this.id,n(this,U))}async distinguish(){let{distinguishedBy:e}=await D.distinguish(this.id,!1,n(this,U));d(this,Ve,e)}async distinguishAsAdmin(){let{distinguishedBy:e}=await D.distinguish(this.id,!0,n(this,U));d(this,Ve,e)}async undistinguish(){let{distinguishedBy:e}=await D.undistinguish(this.id,n(this,U));d(this,Ve,e)}async ignoreReports(){await D.ignoreReports(this.id,n(this,U)),d(this,Ft,!0)}async unignoreReports(){await D.unignoreReports(this.id,n(this,U)),d(this,Ft,!1)}async getAuthor(){return C.getByUsername(n(this,Yt),n(this,U))}async crosspost(e){return D.crosspost({...e,postId:this.id},n(this,U))}addRemovalNote(e){return ve.addRemovalNote({itemIds:[n(this,Qi)],...e},n(this,U))}async getEnrichedThumbnail(){return Fg({id:this.id},n(this,U))}static async getById(e,t){let r=u.redditAPIPlugins.LinksAndComments,s=Mt(e)?e:`t3_${e}`,o=await r.Info({subreddits:[],thingIds:[s]},t);if(!o.data?.children?.length)throw new Error("could not find post");let a=o.data.children[0];if(!a?.data)throw new Error("could not find post");return new D(a.data,t)}static async submit(e,t){let{runAs:r="APP"}=e,s=te[r],o=s===te.USER?u.userActionsPlugin:u.redditAPIPlugins.LinksAndComments;s===te.USER&&u.assertUserScope(Bc.SUBMIT_POST);let a;if("preview"in e){p(t,"Missing metadata in `SubmitPostOptions`"),s===te.USER&&p(e.userGeneratedContent,"userGeneratedContent must be set in `SubmitPostOptions` when RunAs=USER for experience posts");let y=await new Le(()=>e.preview,void 0,{},t,void 0).buildBlocksUI(),v=Dc.encode(y).finish(),{textFallback:f,...S}=e,b=f?id(f):"",_=e.userGeneratedContent?{text:e.userGeneratedContent.text??"",imageUrls:e.userGeneratedContent.imageUrls??[]}:void 0,I=e.postData?{developerData:e.postData}:void 0,N={kind:"custom",sr:e.subredditName,richtextJson:(0,rd.fromByteArray)(v),richtextFallback:b,...S,userGeneratedContent:_,runAs:s,postData:I};a=await o.SubmitCustomPost(N,t)}else a=await o.Submit({kind:"kind"in e?e.kind:"url"in e?"link":"self",sr:e.subredditName,richtextJson:"richtext"in e?_i(e.richtext):void 0,...e,runAs:s},t);if("kind"in e&&["image","video","videogif"].includes(e.kind)&&!a.json?.data?.id){if(e.kind==="image"&&"imageUrls"in e)throw new Error(`Image post type with ${e.imageUrls} is being created asynchronously and should be updated in the subreddit soon.`);if("videoPosterUrl"in e)throw new Error(`Post of ${e.kind} type with ${e.videoPosterUrl} is being created asynchronously and should be updated in the subreddit soon.`)}if(a.json?.errors?.length)throw new Error(`failed to submit post - errors: ${a.json?.errors.join(", ")}`);if(!a.json?.data?.id)throw new Error("failed to submit post - no post ID returned but no error details found");return D.getById(`t3_${a.json.data.id}`,t)}static async crosspost(e,t){let{runAs:r="APP"}=e,s=te[r],o=s===te.USER?u.userActionsPlugin:u.redditAPIPlugins.LinksAndComments,{postId:a,subredditName:c,...m}=e;s===te.USER&&u.assertUserScope(Bc.SUBMIT_POST);let y=await o.Submit({kind:"crosspost",sr:c,crosspostFullname:de(a),...m,runAs:s},t);if(!y.json?.data?.id||y.json?.errors?.length)throw new Error("failed to crosspost post");return D.getById(`t3_${y.json.data.id}`,t)}static async edit(e,t){let r=u.redditAPIPlugins.LinksAndComments,{id:s}=e,o;if("richtext"in e&&(o=_i(e.richtext)),(await r.EditUserText({thingId:s,text:"text"in e?e.text:"",richtextJson:o,runAs:te.APP},t)).json?.errors?.length)throw new Error("Failed to edit post");return D.getById(s,t)}static async setSuggestedCommentSort(e,t){if(!(await Z.query("SetSuggestedSort","cf6052acc7fefaa65b710625b81dba8041f258313aafe9730e2a3dc855e5d10d",{input:{subredditId:e.subredditId,postId:e.id,sort:e.suggestedSort}},t)).data?.setSuggestedSort?.ok)throw new Error("Failed to set suggested sort")}static async getDevvitPostData(e,t){let o=await Z.query("GetDevvitPostData","d349c9bee385336e44837c4a041d4b366fa32f16121cef7f12e1e3f230340696",{id:e},t);if(o.data?.postInfoById?.errors)throw new Error(`Failed to get devvit post data due to errors: ${o.data?.postInfoById?.errors.join(", ")}`);let a=o.data?.postInfoById?.devvit?.postData;if(a)return JSON.parse(a)}static async setPostData(e,t){let r=await u.redditAPIPlugins.LinksAndComments.EditCustomPost({thingId:e.postId,postData:e.postData},t);if(r.json?.errors?.length)throw new Error(`Failed to set post data, errors: ${r.json?.errors}`)}static async setCustomPostPreview(e,t){if(!t)throw new Error("Failed to set custom post preview. Metadata not found");let r=u.redditAPIPlugins.LinksAndComments,s=new Vt(e.ui),a=Sg.fromJSON(await s.handle({events:[]},t)).blocks,c=(0,rd.fromByteArray)(Dc.encode(a).finish());await r.SetCustomPostPreview({thingId:e.id,bodyType:wg.BLOCKS,blocksRenderContent:c},t)}static async setTextFallback(e,t,r){if(!("text"in e)&&!("richtext"in e))throw new Error(`No text fallback provided for post ${t}.`);let s=u.redditAPIPlugins.LinksAndComments,o=id(e),a=await s.EditCustomPost({thingId:t,richtextFallback:o},r);if(a.json?.errors?.length)throw Error(`set post ${t} text fallback failed: ${JSON.stringify(a.json.errors)}`);return D.getById(t,r)}static async delete(e,t){await u.redditAPIPlugins.LinksAndComments.Del({id:e},t)}static async approve(e,t){await u.redditAPIPlugins.Moderation.Approve({id:e},t)}static async remove(e,t=!1,r){await u.redditAPIPlugins.Moderation.Remove({id:e,spam:t},r)}static async hide(e,t){await u.redditAPIPlugins.LinksAndComments.Hide({id:e},t)}static async unhide(e,t){await u.redditAPIPlugins.LinksAndComments.Unhide({id:e},t)}static async markAsNsfw(e,t){await u.redditAPIPlugins.LinksAndComments.MarkNSFW({id:e},t)}static async unmarkAsNsfw(e,t){await u.redditAPIPlugins.LinksAndComments.UnmarkNSFW({id:e},t)}static async markAsSpoiler(e,t){await u.redditAPIPlugins.LinksAndComments.Spoiler({id:e},t)}static async unmarkAsSpoiler(e,t){await u.redditAPIPlugins.LinksAndComments.Unspoiler({id:e},t)}static async sticky(e,t,r){await u.redditAPIPlugins.LinksAndComments.SetSubredditSticky({id:e,state:!0,num:t},r)}static async unsticky(e,t){await u.redditAPIPlugins.LinksAndComments.SetSubredditSticky({id:e,state:!1},t)}static async lock(e,t){await u.redditAPIPlugins.LinksAndComments.Lock({id:e},t)}static async unlock(e,t){await u.redditAPIPlugins.LinksAndComments.Unlock({id:e},t)}static async distinguish(e,t,r){let a=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:t?"admin":"yes",sticky:!1},r)).json?.data?.things?.[0]?.data;return p(a),{distinguishedBy:a.distinguished}}static async undistinguish(e,t){let o=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:"no",sticky:!1},t)).json?.data?.things?.[0]?.data;return p(o),{distinguishedBy:o.distinguished}}static async ignoreReports(e,t){await u.redditAPIPlugins.Moderation.IgnoreReports({id:e},t)}static async unignoreReports(e,t){await u.redditAPIPlugins.Moderation.UnignoreReports({id:e},t)}static getControversialPosts(e={},t){return this.getSortedPosts({...e,sort:"controversial"},t)}static getTopPosts(e={},t){return this.getSortedPosts({...e,sort:"top"},t)}static getSortedPosts(e,t){let r=u.redditAPIPlugins.Listings;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Sort({show:"all",sort:e.sort,t:e.timeframe,subreddit:e.subredditName,...s},t);return fn(o,t)}})}static getHotPosts(e={location:"GLOBAL"},t){let r=u.redditAPIPlugins.Listings;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Hot({g:e.location,show:"all",subreddit:e.subredditName,...s},t);return fn(o,t)}})}static getNewPosts(e,t){let r=u.redditAPIPlugins.Listings;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.New({show:"all",subreddit:e.subredditName,...s},t);return fn(o,t)}})}static getRisingPosts(e,t){let r=u.redditAPIPlugins.Listings;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Rising({show:"all",subreddit:e.subredditName,...s},t);return fn(o,t)}})}static getPostsByUser(e,t){let r=u.redditAPIPlugins.Users;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"submitted",...s},t);return fn(o,t)}})}};Qi=new WeakMap,yn=new WeakMap,Yt=new WeakMap,bn=new WeakMap,Yi=new WeakMap,vn=new WeakMap,kn=new WeakMap,Cn=new WeakMap,ei=new WeakMap,Pn=new WeakMap,Sn=new WeakMap,wn=new WeakMap,Fn=new WeakMap,xn=new WeakMap,In=new WeakMap,bt=new WeakMap,Tn=new WeakMap,An=new WeakMap,ti=new WeakMap,er=new WeakMap,vt=new WeakMap,tr=new WeakMap,ir=new WeakMap,rr=new WeakMap,kt=new WeakMap,Ct=new WeakMap,Pt=new WeakMap,nr=new WeakMap,St=new WeakMap,wt=new WeakMap,Ft=new WeakMap,Ve=new WeakMap,En=new WeakMap,Rn=new WeakMap,On=new WeakMap,sr=new WeakMap,or=new WeakMap,ar=new WeakMap,U=new WeakMap;var G=D;function fn(i,e){if(!i.data?.children)throw new Error("Listing response is missing children");return{children:i.data.children.map(r=>new G(r.data,e)),before:i.data.before,after:i.data.after}}async function Fg(i,e){let o=(await Z.query("GetThumbnailV2","81580ce4e23d748c5a59a1618489b559bf4518b6a73af41f345d8d074c8b2ce9",{id:i.id},e)).data?.postInfoById?.thumbnailV2;if(o){if(!o.image)return}else throw new Error("Failed to get thumbnail");return{attribution:o.attribution,image:{url:o.image.url,width:o.image.dimensions.width,height:o.image.dimensions.height},isObfuscatedDefault:o.isObfuscatedDefault,...o.obfuscatedImage&&{obfuscatedImage:{url:o.obfuscatedImage.url,width:o.obfuscatedImage.dimensions.width,height:o.obfuscatedImage.dimensions.height}}}}var xg=(H=>(H.Custom="CUSTOM",H.Reddit="REDDIT",H.Instagram="INSTAGRAM",H.Twitter="TWITTER",H.Tiktok="TIKTOK",H.Twitch="TWITCH",H.Facebook="FACEBOOK",H.Youtube="YOUTUBE",H.Tumblr="TUMBLR",H.Spotify="SPOTIFY",H.Soundcloud="SOUNDCLOUD",H.Beacons="BEACONS",H.Linktree="LINKTREE",H.Discord="DISCORD",H.Venmo="VENMO",H.CashApp="CASH_APP",H.Patreon="PATREON",H.Kofi="KOFI",H.Paypal="PAYPAL",H.Cameo="CAMEO",H.Onlyfans="ONLYFANS",H.Substack="SUBSTACK",H.Kickstarter="KICKSTARTER",H.Indiegogo="INDIEGOGO",H.BuyMeACoffee="BUY_ME_A_COFFEE",H.Shopify="SHOPIFY",H))(xg||{}),Un,ii,Mn,Dn,Bn,Nn,Ln,It,_n,Hn,jn,Wn,Vn,Te,xt=class xt{constructor(e,t){l(this,Un);l(this,ii);l(this,Mn);l(this,Dn);l(this,Bn);l(this,Nn);l(this,Ln);l(this,It,new Map);l(this,_n);l(this,Hn);l(this,jn);l(this,Wn);l(this,Vn);l(this,Te);X(this),p(e.id,"User ID is missing or undefined"),p(e.name,"Username is missing or undefined"),p(e.createdUtc,"User is missing created date"),d(this,Un,ie(eo(e.id)?e.id:`t2_${e.id}`)),d(this,ii,e.name),d(this,Nn,e.over18??!1),d(this,Ln,e.isEmployee??!1);let r=new Date(0);if(r.setUTCSeconds(e.createdUtc),d(this,Mn,r),d(this,Dn,e.linkKarma??0),d(this,Bn,e.commentKarma??0),e.modPermissions)for(let[s,o]of Object.entries(e.modPermissions))n(this,It).set(s,Rc(o));d(this,_n,new URL(e.subreddit?.url??"","https://www.reddit.com").toString()),d(this,Hn,e.subreddit?.url??""),d(this,jn,e.hasVerifiedEmail??!1),d(this,Wn,e.subreddit?.title??n(this,ii)),d(this,Vn,e.subreddit?.publicDescription??""),d(this,Te,t)}get id(){return n(this,Un)}get username(){return n(this,ii)}get createdAt(){return n(this,Mn)}get linkKarma(){return n(this,Dn)}get commentKarma(){return n(this,Bn)}get nsfw(){return n(this,Nn)}get isAdmin(){return n(this,Ln)}get modPermissions(){return n(this,It)}get url(){return n(this,_n)}get permalink(){return n(this,Hn)}get hasVerifiedEmail(){return n(this,jn)}get displayName(){return n(this,Wn)}get about(){return n(this,Vn)}toJSON(){return{id:this.id,username:this.username,createdAt:this.createdAt,linkKarma:this.linkKarma,commentKarma:this.commentKarma,nsfw:this.nsfw,modPermissionsBySubreddit:Object.fromEntries(this.modPermissions)}}async getModPermissionsForSubreddit(e){if(n(this,It).has(e))return n(this,It).get(e);let t=await xt.getSubredditUsersByType({subredditName:e,type:"moderators",username:this.username},n(this,Te)).all();if(t.length===0)return[];let r=t[0].modPermissions.get(e)??[];return r.length>0&&n(this,It).set(e,r),r}getComments(e){return Y.getCommentsByUser({username:this.username,...e},n(this,Te))}getPosts(e){return G.getPostsByUser({username:this.username,...e},n(this,Te))}async getUserFlairBySubreddit(e){let t=await ce.getUserFlairBySubreddit({subreddit:e,name:n(this,ii)},n(this,Te));return t.users[0]?gn(t.users[0]):void 0}getSnoovatarUrl(){return xt.getSnoovatarUrl(this.username,n(this,Te))}async getSocialLinks(){let r=await Z.query("GetUserSocialLinks","2aca18ef5f4fc75fb91cdaace3e9aeeae2cb3843b5c26ad511e6f01b8521593a",{name:this.username},n(this,Te));return r.data?.user?.profile?.socialLinks?r.data.user.profile.socialLinks.map(s=>({...s,handle:s.handle??void 0})):[]}async getUserKarmaFromCurrentSubreddit(){return await xt.getUserKarmaFromCurrentSubreddit(this.username,n(this,Te))}static async getById(e,t){let r=await Nc(e,t);return r==null?void 0:xt.getByUsername(r,t)}static async getByUsername(e,t){let r=u.redditAPIPlugins.Users;try{let s=await r.UserAbout({username:e},t);if(s.data?.id)return new xt(s.data,t)}catch(s){if(s instanceof Error&&s.message.includes("404 Not Found"))return;throw s}}static async getFromMetadata(e,t){p(t);let r=t?.[e]?.values[0];return r?xt.getById(ie(r),t):Promise.resolve(void 0)}static getSubredditUsersByType(e,t){let r=u.redditAPIPlugins.Subreddits;return new V({hasMore:!0,pageSize:e.pageSize,limit:e.limit,after:e.after,before:e.before,fetch:async s=>{let o=await r.AboutWhere({where:e.type,user:e.username,subreddit:e.subredditName,show:"all",...s},t);return Tg(o,e.subredditName,t)}})}static async createRelationship(e,t){let r=u.redditAPIPlugins.Users,{type:s,subredditName:o,username:a,permissions:c,...m}=e,y=await r.Friend({type:s,subreddit:o,name:a,permissions:c?ed(c):void 0,...m},t);if(y.json?.errors?.length)throw new Error(y.json.errors.join(`
`))}static async removeRelationship(e,t){await u.redditAPIPlugins.Users.Unfriend({type:e.type,subreddit:e.subredditName,name:e.username},t)}static async setModeratorPermissions(e,t,r,s){let a=await u.redditAPIPlugins.Users.SetPermissions({subreddit:t,name:e,type:"moderator",permissions:ed(r)},s);if(a.json?.errors?.length)throw new Error(a.json.errors.join(`
`))}static async getSnoovatarUrl(e,t){return(await Z.query("GetSnoovatarUrlByName","c47fd42345af268616d2d8904b56856acdc05cf61d3650380f539ad7d596ac0c",{username:e},t)).data?.redditorInfoByName?.snoovatarIcon?.url}static getOverview(e,t){let r=u.redditAPIPlugins.Users;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"overview",...s},t);return Ig(o,t)}})}static async getUserKarmaFromCurrentSubreddit(e,t){p(t);let r=t?.[P.Subreddit]?.values[0];if(!r)throw new Error("Subreddit ID is missing from metadata");return await u.redditAPIPlugins.Users.GetUserKarmaForSubreddit({username:e,subredditId:r})}};Un=new WeakMap,ii=new WeakMap,Mn=new WeakMap,Dn=new WeakMap,Bn=new WeakMap,Nn=new WeakMap,Ln=new WeakMap,It=new WeakMap,_n=new WeakMap,Hn=new WeakMap,jn=new WeakMap,Wn=new WeakMap,Vn=new WeakMap,Te=new WeakMap;var C=xt;function Ig(i,e){if(!i.data?.children)throw new Error("Listing response is missing children");return{children:i.data.children.map(r=>{if(r.kind==="t3")return new G(r.data,e);if(r.kind==="t1")return new Y(r.data,e);throw new Error(`Type ${r.kind} is not supported`)}),before:i.data.before,after:i.data.after}}async function Tg(i,e,t){let r=u.redditAPIPlugins.Users;if(!i.data?.children)throw new Error("Listing response is missing children");let s=i.data.children.map(v=>(p(v.data?.id,"User id is still from listing data"),v.data.id)),o=100,a=[];for(let v=0;v<s.length;v+=o)a.push(s.slice(v,v+o));let m=(await Promise.all(a.map(v=>r.UserDataByAccountIds({ids:v.join(",")},t)))).reduce((v,f)=>({...v,...f.users}),{});return{children:i.data.children.map(v=>{let f=v.data?.id;p(f,"User id is missing from listing");let S=m[f];return p(S,"User data is missing from response"),new C({id:f,name:S.name,linkKarma:S.linkKarma,commentKarma:S.commentKarma,createdUtc:S.createdUtc,over18:S.profileOver18,snoovatarSize:[],modPermissions:{[e]:v.data?.modPermissions??[]}},t)}),before:i.data.before,after:i.data.after}}async function Nc(i,e){return(await u.redditAPIPlugins.Users.UserDataByAccountIds({ids:i},e))?.users?.[i]?.name}async function Jd(i){p(i);let e=i?.[P.Username]?.values[0];if(e)return e;let t=i?.[P.User]?.values[0];if(t)return Nc(t,i)}var ri,Gn,dr,lr,Jn,zn,ur,$n,qn,cr,Tt,Kn,Xn,ni,At,Et,Ge,si,Je,Zn,Qn,Yn,es,ts,is,rs,Rt,mr,Q,Be,No,Lo,W=class W{constructor(e,t){l(this,ri);l(this,Gn);l(this,dr);l(this,lr);l(this,Jn);l(this,zn);l(this,ur);l(this,$n);l(this,qn);l(this,cr);l(this,Tt);l(this,Kn);l(this,Xn);l(this,ni);l(this,At);l(this,Et);l(this,Ge);l(this,si);l(this,Je);l(this,Zn);l(this,Qn);l(this,Yn);l(this,es);l(this,ts);l(this,is);l(this,rs);l(this,Rt);l(this,mr);l(this,Q);var s;X(this),p(e.id,"Comment id is null or undefined"),p(e.body,"Comment body is null or undefined"),p(e.createdUtc,"Comment is missing created date"),p(e.author,"Comment author is null or undefined"),p(e.parentId,"Comment parentId is null or undefined"),p(e.linkId,"Comment linkId is null or undefined"),p(e.permalink,"Comment permalink is null or undefined"),p(e.subreddit,"Comment is missing subreddit name"),p(e.subredditId,"Comment is missing subreddit id"),d(this,ri,bi(`t1_${e.id}`)),d(this,Gn,e.authorFullname?ie(e.authorFullname):void 0),d(this,dr,e.author),d(this,lr,e.body),d(this,$n,K(e.subredditId)),d(this,qn,e.subreddit),d(this,zn,Yo(e.parentId)?bi(e.parentId):de(e.parentId)),d(this,ur,de(e.linkId)),d(this,ni,e.edited??!1),d(this,At,e.locked??!1),d(this,Et,e.removed??!1),d(this,Ge,e.stickied??!1),d(this,Tt,e.approved??!1),d(this,Kn,e.approvedAtUtc??0),d(this,Xn,e.bannedAtUtc??0),d(this,si,e.spam??!1),d(this,Je,e.distinguished),d(this,Zn,e.numReports??0),d(this,Qn,e.collapsedBecauseCrowdControl??!1),d(this,Yn,e.score??0),d(this,es,e.permalink),d(this,rs,new URL(e.permalink??"","https://www.reddit.com/").toString()),d(this,Rt,e.ignoreReports??!1),d(this,mr,pn({flairBackgroundColor:e.authorFlairBackgroundColor,flairCssClass:e.authorFlairCssClass,flairText:e.authorFlairText,flairType:e.authorFlairType,flairTemplateId:e.authorFlairTemplateId,flairRichtext:e.authorFlairRichtext,flairTextColor:e.authorFlairTextColor})),d(this,ts,(e.modReports??[]).map(([o])=>o)),d(this,is,(e.userReports??[]).map(([o])=>o));let r=new Date(0);r.setUTCSeconds(e.createdUtc),d(this,Jn,r),d(this,cr,h(s=W,Be,No).call(s,{postId:n(this,ur),commentId:n(this,ri)},t)),d(this,Q,t)}get id(){return n(this,ri)}get authorId(){return n(this,Gn)}get authorName(){return n(this,dr)}get subredditId(){return n(this,$n)}get subredditName(){return n(this,qn)}get body(){return n(this,lr)}get createdAt(){return n(this,Jn)}get parentId(){return n(this,zn)}get postId(){return n(this,ur)}get replies(){return n(this,cr)}get distinguishedBy(){return n(this,Je)}get locked(){return n(this,At)}get stickied(){return n(this,Ge)}get removed(){return n(this,Et)}get approved(){return n(this,Tt)}get approvedAtUtc(){return n(this,Kn)}get bannedAtUtc(){return n(this,Xn)}get spam(){return n(this,si)}get edited(){return n(this,ni)}get numReports(){return n(this,Zn)}get collapsedBecauseCrowdControl(){return n(this,Qn)}get score(){return n(this,Yn)}get permalink(){return n(this,es)}get userReportReasons(){return n(this,is)}get modReportReasons(){return n(this,ts)}get url(){return n(this,rs)}get ignoringReports(){return n(this,Rt)}get authorFlair(){return n(this,mr)}toJSON(){return{id:this.id,authorName:this.authorName,subredditId:this.subredditId,subredditName:this.subredditName,body:this.body,createdAt:this.createdAt,parentId:this.parentId,postId:this.postId,replies:this.replies,approved:this.approved,locked:this.locked,removed:this.removed,stickied:this.stickied,spam:this.spam,edited:this.edited,distinguishedBy:this.distinguishedBy,numReports:this.numReports,collapsedBecauseCrowdControl:this.collapsedBecauseCrowdControl,score:this.score,permalink:this.permalink,modReportReasons:this.modReportReasons,userReportReasons:this.userReportReasons,url:this.url,ignoringReports:this.ignoringReports,authorFlair:n(this,mr)}}isLocked(){return n(this,At)}isApproved(){return n(this,Tt)}isRemoved(){return n(this,Et)}isSpam(){return n(this,si)}isStickied(){return n(this,Ge)}isDistinguished(){return!!n(this,Je)}isEdited(){return n(this,ni)}isIgnoringReports(){return n(this,Rt)}async delete(){return W.delete(this.id,n(this,Q))}async edit(e){let t=await W.edit({id:this.id,...e},n(this,Q));return d(this,lr,t.body),d(this,ni,t.edited),this}async approve(){await W.approve(this.id,n(this,Q)),d(this,Tt,!0),d(this,Et,!1)}async remove(e=!1){await W.remove(this.id,e,n(this,Q)),d(this,Et,!0),d(this,si,e),d(this,Tt,!1)}async lock(){await W.lock(this.id,n(this,Q)),d(this,At,!0)}async unlock(){await W.unlock(this.id,n(this,Q)),d(this,At,!1)}async reply(e){return W.submit({id:this.id,...e},n(this,Q))}async getAuthor(){return C.getByUsername(n(this,dr),n(this,Q))}async distinguish(e=!1){let{distinguishedBy:t,stickied:r}=await W.distinguish(this.id,e,!1,n(this,Q));d(this,Je,t),d(this,Ge,r)}async distinguishAsAdmin(e=!1){let{distinguishedBy:t,stickied:r}=await W.distinguish(this.id,e,!0,n(this,Q));d(this,Je,t),d(this,Ge,r)}async undistinguish(){let{distinguishedBy:e,stickied:t}=await W.undistinguish(this.id,n(this,Q));d(this,Je,e),d(this,Ge,t)}async ignoreReports(){await W.ignoreReports(this.id,n(this,Q)),d(this,Rt,!0)}async unignoreReports(){await W.unignoreReports(this.id,n(this,Q)),d(this,Rt,!1)}addRemovalNote(e){return ve.addRemovalNote({itemIds:[n(this,ri)],...e},n(this,Q))}static async getById(e,t){let r=u.redditAPIPlugins.LinksAndComments,s=Ye(e)?e:`t1_${e}`,o=await r.Info({subreddits:[],thingIds:[s]},t);if(!o.data?.children?.[0]?.data)throw new Error("not found");return new W(o.data.children[0].data,t)}static getComments(e,t){var a;let{postId:r,commentId:s,...o}=e;return h(a=W,Be,No).call(a,{postId:de(r),commentId:s?bi(s):void 0,...o},t)}static async edit(e,t){let r=u.redditAPIPlugins.LinksAndComments,{id:s}=e,o;"richtext"in e&&(o=_i(e.richtext));let a=await r.EditUserText({thingId:s,text:"text"in e?e.text:"",richtextJson:o,runAs:te.APP},t);if(a.json?.errors?.length)throw new Error("Failed to edit comment");let c=a.json?.data?.things?.[0]?.data;return p(c),new W(c,t)}static async delete(e,t){await u.redditAPIPlugins.LinksAndComments.Del({id:e},t)}static async approve(e,t){await u.redditAPIPlugins.Moderation.Approve({id:e},t)}static async remove(e,t=!1,r){await u.redditAPIPlugins.Moderation.Remove({id:e,spam:t},r)}static async lock(e,t){await u.redditAPIPlugins.LinksAndComments.Lock({id:e},t)}static async unlock(e,t){await u.redditAPIPlugins.LinksAndComments.Unlock({id:e},t)}static async submit(e,t){let{runAs:r="APP"}=e,s=te[r],o=s===te.USER?u.userActionsPlugin:u.redditAPIPlugins.LinksAndComments,{id:a}=e;s===te.USER&&u.assertUserScope(Ag.SUBMIT_COMMENT);let c;"richtext"in e&&(c=_i(e.richtext));let m=await o.Comment({thingId:a,text:"text"in e?e.text:"",richtextJson:c,runAs:s},t);if(m.json?.errors?.length)throw new Error("failed to reply to comment");let y=m.json?.data?.things?.[0]?.data;return p(y),new W(y,t)}static async distinguish(e,t,r,s){let c=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:r?"admin":"yes",sticky:t},s)).json?.data?.things?.[0]?.data;return p(c),{distinguishedBy:c.distinguished,stickied:!!c.stickied}}static async undistinguish(e,t){let o=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:"no",sticky:!1},t)).json?.data?.things?.[0]?.data;return p(o),{distinguishedBy:o.distinguished,stickied:!!o.stickied}}static getCommentsByUser(e,t){let r=u.redditAPIPlugins.Users;return new V({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"comments",...s},t);return p(o.data,"Failed to get comments for user"),{children:o.data.children?.map(c=>new W(c.data,t))||[],before:o.data.before,after:o.data.after}}})}static async ignoreReports(e,t){await u.redditAPIPlugins.Moderation.IgnoreReports({id:e},t)}static async unignoreReports(e,t){await u.redditAPIPlugins.Moderation.UnignoreReports({id:e},t)}};ri=new WeakMap,Gn=new WeakMap,dr=new WeakMap,lr=new WeakMap,Jn=new WeakMap,zn=new WeakMap,ur=new WeakMap,$n=new WeakMap,qn=new WeakMap,cr=new WeakMap,Tt=new WeakMap,Kn=new WeakMap,Xn=new WeakMap,ni=new WeakMap,At=new WeakMap,Et=new WeakMap,Ge=new WeakMap,si=new WeakMap,Je=new WeakMap,Zn=new WeakMap,Qn=new WeakMap,Yn=new WeakMap,es=new WeakMap,ts=new WeakMap,is=new WeakMap,rs=new WeakMap,Rt=new WeakMap,mr=new WeakMap,Q=new WeakMap,Be=new WeakSet,No=function(e,t,r=0){return new V({limit:e.limit,pageSize:e.pageSize,fetch:async s=>{var S,b;let o=s.limit,a=u.redditAPIPlugins.Listings,c=u.redditAPIPlugins.LinksAndComments,m=e.commentId;if(s.more)if(s.more.children.length){let _=s.more;(!o||o>100)&&(o=100);let I=_.children.splice(0,o),N=await c.MoreChildren({linkId:e.postId,children:I,sort:e.sort},t);if(!N.json?.data?.things?.length)return{children:[]};let{children:B}=h(S=W,Be,Lo).call(S,N.json.data.things,e.postId,e,t);return{children:B,more:_.children.length?_:void 0}}else m=s.more.parentId,r=r+s.more.depth;let v=(await a.Comments({article:e.postId.substring(3),comment:m?.substring(3),limit:o,depth:e.depth,sort:e.sort},t)).listings?.[1]?.data?.children??[],f=v[0];return m&&f?.data?.replyList?.data&&(v=f.data.replyList.data.children),h(b=W,Be,Lo).call(b,v,m??e.postId,e,t,r)}})},Lo=function(e,t,r,s,o=0){var y,v;let a=[],c,m={};for(let f of e){if(!f.data||(f.data.depth!=null&&(f.data.depth=f.data.depth+o),f.data.depth!=null&&r.depth!=null&&f.data.depth>=r.depth))continue;let S=f.data.parentId?m[f.data.parentId]:void 0;if(f.kind==="t1"){if(f.data.name===t)continue;let b=new W(f.data,s);if(m[b.id]=b,d(b,cr,h(y=W,Be,No).call(y,{...r,postId:b.postId,commentId:b.id},s,o)),"replyList"in f.data&&f.data.replyList?.data){let{children:_,more:I}=h(v=W,Be,Lo).call(v,f.data.replyList.data.children,b.id,r,s,o);_.length&&b.replies.children.push(..._),I&&b.replies.setMore(I)}b.replies.preventInitialFetch(),S?S.replies.children.push(b):a.push(b)}else if(f.kind==="more"&&f.data.parentId&&f.data.depth!=null){let b={parentId:Yo(f.data.parentId)?bi(f.data.parentId):de(f.data.parentId),children:f.data.children??[],depth:f.data.depth};S?S.replies.setMore(b):b.parentId===t&&(c=b)}}return{children:a,more:c}},l(W,Be);var Y=W;function to(i,e){let t=u.redditAPIPlugins.Moderation;return new V({hasMore:!0,after:i.after,before:i.before,limit:i.limit,pageSize:i.pageSize,fetch:async r=>{let s=await t.AboutLog({subreddit:i.subredditName,mod:i.moderatorUsernames?i.moderatorUsernames.join(","):void 0,type:i.type,...r},e);return Eg(s)}})}function Eg(i){if(!i.data?.children)throw new Error("AboutLogResponse is missing children");return{children:i.data.children.map(t=>{if(!t.data)throw new Error("ModAction from AboutLogResponse is missing or invalid");let{id:r,mod:s,modId36:o,createdUtc:a,subreddit:c,subredditNamePrefixed:m,action:y,srId36:v,description:f,details:S,targetAuthor:b,targetBody:_,targetFullname:I,targetPermalink:N,targetTitle:B}=t.data;p(r,"ModAction from AboutLogResponse is missing id"),p(s,"ModAction from AboutLogResponse is missing mod"),p(o,"ModAction from AboutLogResponse is missing modId36"),p(a,"ModAction from AboutLogResponse is missing createdUtc"),p(c,"ModAction from AboutLogResponse is missing subreddit"),p(m,"ModAction from AboutLogResponse is missing subredditNamePrefixed"),p(y,"ModAction from AboutLogResponse is missing action"),p(v,"ModAction from AboutLogResponse is missing srId36");let ai=new Date(0);return ai.setUTCSeconds(a),{id:r,type:y,moderatorName:s,moderatorId:`t2_${o}`,createdAt:ai,subredditName:c,subredditId:`t5_${v}`,description:f,details:S,target:I?{id:I,author:b,body:_,permalink:N,title:B}:void 0}}),after:i.data.after,before:i.data.before}}import"@devvit/protos";var Rg=(a=>(a.New="New",a.InProgress="InProgress",a.Archived="Archived",a.Appeals="Appeals",a.JoinRequests="JoinRequests",a.Filtered="Filtered",a))(Rg||{}),Og={0:"New",1:"InProgress",2:"Archived",3:"Appeals",4:"JoinRequests",5:"Filtered"},Ug=(b=>(b.Highlighted="Highlighted",b.Unhighlighted="Unhighlighted",b.Archived="Archived",b.Unarchived="Unarchived",b.ReportedToAdmins="ReportedToAdmins",b.Muted="Muted",b.Unmuted="Unmuted",b.Banned="Banned",b.Unbanned="Unbanned",b.Approved="Approved",b.Disapproved="Disapproved",b.Filtered="Filtered",b.Unfiltered="Unfiltered",b))(Ug||{}),Mg={0:"Highlighted",1:"Unhighlighted",2:"Archived",3:"Unarchived",4:"ReportedToAdmins",5:"Muted",6:"Unmuted",7:"Banned",8:"Unbanned",9:"Approved",10:"Disapproved",11:"Filtered",12:"Unfiltered"},L,J,re,Lc,_c,io=class{constructor(e){l(this,J);l(this,L);this.notificationSubjectPrefix="[notification]";d(this,L,e)}async bulkReadConversations(e,t){let r=u.redditAPIPlugins.NewModmail,{conversationIds:s}=await r.BulkReadConversations({entity:e.join(","),state:t},n(this,L));return s}async getConversations(e){let r=await u.redditAPIPlugins.NewModmail.GetConversations({after:e.after,entity:e.subreddits?e.subreddits.join(","):void 0,limit:e.limit,sort:e.sort,state:e.state},n(this,L)),s={};for(let o in r.conversations)s[o]=h(this,J,re).call(this,{protoConversation:r.conversations[o],protoMessages:r.messages,protoModActions:{}});return{conversations:s,viewerId:r.viewerId,conversationIds:r.conversationIds}}async getConversation(e){let r=await u.redditAPIPlugins.NewModmail.GetConversation({...e,markRead:!!e.markRead},n(this,L));return{participantSubreddit:r.participantSubreddit,conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async getSubreddits(){let e=u.redditAPIPlugins.NewModmail,{subreddits:t}=await e.Subreddits({},n(this,L));return t}async createConversation(e){let r=await u.redditAPIPlugins.NewModmail.CreateConversation({body:e.body,isAuthorHidden:e.isAuthorHidden??!1,srName:e.subredditName,subject:e.subject,to:e.to?e.to:void 0},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async createModDiscussionConversation(e){return nd({subject:e.subject,bodyMarkdown:e.bodyMarkdown,subredditId:K(e.subredditId),isInternal:!0,participantType:"MODERATOR",conversationType:"INTERNAL"},n(this,L))}async createModInboxConversation(e){return nd({subject:e.subject,bodyMarkdown:e.bodyMarkdown,subredditId:K(e.subredditId),isInternal:!1,participantType:"PARTICIPANT_USER",conversationType:"SR_USER"},n(this,L))}async createModNotification(e){let t=e.subject;return e.subject.startsWith(this.notificationSubjectPrefix)||(t=`${this.notificationSubjectPrefix} ${e.subject}`),nd({subject:t,bodyMarkdown:e.bodyMarkdown,subredditId:K(e.subredditId),isInternal:!1,participantType:"PARTICIPANT_USER",conversationType:"SR_USER"},n(this,L))}async reply(e){let r=await u.redditAPIPlugins.NewModmail.CreateConversationMessage({body:e.body,conversationId:e.conversationId,isAuthorHidden:e.isAuthorHidden??!1,isInternal:e.isInternal??!1},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:{}}),user:r.user}}async highlightConversation(e){let r=await u.redditAPIPlugins.NewModmail.HighlightConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async unhighlightConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnhighlightConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async archiveConversation(e){let r=await u.redditAPIPlugins.NewModmail.ArchiveConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async unarchiveConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnarchiveConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async muteConversation(e){let r=await u.redditAPIPlugins.NewModmail.MuteConversation({conversationId:e.conversationId,numHours:e.numHours},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async unmuteConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnmuteConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async readConversations(e){await u.redditAPIPlugins.NewModmail.Read({conversationIds:e.join(",")},n(this,L))}async unreadConversations(e){await u.redditAPIPlugins.NewModmail.Unread({conversationIds:e.join(",")},n(this,L))}async approveConversation(e){let r=await u.redditAPIPlugins.NewModmail.ApproveConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async disapproveConversation(e){let r=await u.redditAPIPlugins.NewModmail.DisapproveConversation({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async tempBanConversation(e){let r=await u.redditAPIPlugins.NewModmail.TempBan({...e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async unbanConversation(e){let r=await u.redditAPIPlugins.NewModmail.Unban({conversationId:e},n(this,L));return{conversation:h(this,J,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async getUnreadCount(){return await u.redditAPIPlugins.NewModmail.UnreadCount({},n(this,L))}async getUserConversations(e){return await u.redditAPIPlugins.NewModmail.UserConversations({conversationId:e},n(this,L))}};L=new WeakMap,J=new WeakSet,re=function({protoConversation:e,protoMessages:t,protoModActions:r}){return{...e,state:Og[e.state],messages:h(this,J,Lc).call(this,e,t),modActions:h(this,J,_c).call(this,e,r)}},Lc=function(e,t){let r={},s=e.objIds.filter(o=>o.key==="messages").map(({id:o})=>o);for(let o of s){let a=t[o];a&&(r[o]=a)}return r},_c=function(e,t){let r={},s=e.objIds.filter(o=>o.key==="modActions").map(({id:o})=>o);for(let o of s){let a=t[o];a&&(r[o]={...a,actionType:Mg[a.actionTypeId]})}return r};async function nd(i,e){let t=e[P.AppUser]?.values[0],o=await Z.query("CreateModmailConversation","5f9ae20b0c7bdffcafb80241728a72e67cd4239bc09f67284b79d4aa706ee0e5",{subject:i.subject,bodyMarkdown:i.bodyMarkdown,subredditId:i.subredditId,authorId:t,isInternal:i.isInternal,participantType:i.participantType,conversationType:i.conversationType},e);if(o.data?.createModmailConversationV2?.ok)return o.data?.createModmailConversationV2?.conversationId;throw new Error("modmail conversation creation failed; ${response.data?.createModmailConversationV2?.errors[0].message}")}var pr,gr,ns,ss,os,as,sd=class sd{constructor(e,t){l(this,pr);l(this,gr);l(this,ns);l(this,ss);l(this,os);l(this,as);if(X(this),p(e.id,"PrivateMessage: Invalid data, no id"),p(e.name,"PrivateMessage: Invalid data, no name"),p(e.created,"PrivateMessage: Invalid data, no created date"),d(this,pr,be(e.name)),e.author!=null)d(this,gr,{type:"user",username:e.author,id:e.authorFullname?ie(e.authorFullname):void 0});else if(e.subreddit!=null)d(this,gr,{type:"subreddit",name:e.subreddit,id:e.subredditId?K(e.subredditId):void 0});else throw new Error("PrivateMessage: Invalid data, no author or subreddit");d(this,ns,e.body??""),d(this,ss,e.bodyHtml??"");let r=new Date(0);r.setUTCSeconds(e.createdUtc),d(this,os,r),d(this,as,t)}static async getMessages(e,t){let r=u.redditAPIPlugins.PrivateMessages;return new V({...e,fetch:async s=>{let o=await r.MessageWhere({...s,where:e.type??"inbox"},t);return{after:o.data?.after,before:o.data?.before,children:o.data?.children?.map(a=>new sd(a.data,t)).filter(Boolean)||[]}}})}static async send({to:e,subject:t,text:r},s){await u.redditAPIPlugins.PrivateMessages.Compose({to:e,subject:t,text:r,fromSr:""},s)}static async sendAsSubreddit({to:e,fromSubredditName:t,subject:r,text:s},o){await u.redditAPIPlugins.PrivateMessages.Compose({to:e,fromSr:t,subject:r,text:s},o)}static async markAllAsRead(e){await u.redditAPIPlugins.PrivateMessages.ReadAllMessages({filterTypes:""},e)}get id(){return n(this,pr)}get from(){return n(this,gr)}get body(){return n(this,ns)}get bodyHtml(){return n(this,ss)}get created(){return n(this,os)}async markAsRead(){await u.redditAPIPlugins.PrivateMessages.ReadMessage({id:n(this,pr)},n(this,as))}};pr=new WeakMap,gr=new WeakMap,ns=new WeakMap,ss=new WeakMap,os=new WeakMap,as=new WeakMap;var Dt=sd;var zd=(o=>(o.Reports="reports",o.Spam="spam",o.Modqueue="modqueue",o.Unmoderated="unmoderated",o.Edited="edited",o))(zd||{}),Hc=class{},jc=class{},Wc=class{},Vc=class{},hr,x,ds,ls,us,cs,ms,ps,gs,hs,fs,fr,R,Ae=class Ae{constructor(e,t){l(this,hr);l(this,x);l(this,ds);l(this,ls);l(this,us);l(this,cs);l(this,ms);l(this,ps);l(this,gs);l(this,hs);l(this,fs);l(this,fr);l(this,R);X(this),p(e.id,"Subreddit id is missing or undefined"),p(e.displayName,"Subreddit name is missing or undefined"),d(this,hr,K(`t5_${e.id}`)),d(this,x,e.displayName),p(e.createdUtc,"Subreddit is missing created date");let r=new Date(0);r.setUTCSeconds(e.createdUtc),d(this,ds,r),d(this,ls,od(e.subredditType)),d(this,us,e.title),d(this,cs,e.description),p(e.lang,"Subreddit is missing language"),d(this,ms,e.lang),d(this,ps,e.subscribers??0),d(this,gs,e.activeUserCount??0),d(this,hs,e.over18??!1),d(this,fr,e.url??""),d(this,fs,{acceptFollowers:e.acceptFollowers??!1,allOriginalContent:e.allOriginalContent??!1,allowChatPostCreation:e.allowChatPostCreation??!1,allowDiscovery:e.allowDiscovery??!1,allowGalleries:e.allowGalleries??!1,allowImages:e.allowImages??!1,allowPolls:e.allowPolls??!1,allowPredictionContributors:e.allowPredictionContributors??!1,allowPredictions:e.allowPredictions??!1,allowPredictionsTournament:e.allowPredictionsTournament??!1,allowTalks:e.allowTalks??!1,allowVideoGifs:e.allowVideogifs??!1,allowVideos:e.allowVideos??!1,chatPostEnabled:e.isChatPostFeatureEnabled??!1,collectionsEnabled:e.collectionsEnabled??!1,crosspostable:e.isCrosspostableSubreddit??!1,emojisEnabled:e.emojisEnabled??!1,eventPostsEnabled:e.eventPostsEnabled??!1,linkFlairEnabled:e.linkFlairEnabled??!1,originalContentTagEnabled:e.originalContentTagEnabled??!1,restrictCommenting:e.restrictCommenting??!1,restrictPosting:e.restrictPosting??!1,shouldArchivePosts:e.shouldArchivePosts??!1,spoilersEnabled:e.spoilersEnabled??!1,wikiEnabled:e.wikiEnabled??!1,allowedPostType:Dg(e.submissionType),allowedMediaInComments:(e.allowedMediaInComments??[]).map(Bg),bannerBackgroundColor:e.bannerBackgroundColor,bannerBackgroundImage:e.bannerBackgroundImage,bannerImage:e.bannerImg,communityIcon:e.communityIcon,headerTitle:e.headerTitle,keyColor:e.keyColor,mobileBannerImage:e.mobileBannerImage,primaryColor:e.primaryColor,userFlairs:{enabled:e.userFlairEnabledInSr??!1,usersCanAssign:e.canAssignUserFlair??!1,userFlairBackgroundColor:e.userFlairBackgroundColor,userFlairTextColor:e.userFlairTextColor},postFlairs:{enabled:e.linkFlairEnabled??!1,usersCanAssign:e.canAssignLinkFlair??!1},url:new URL(n(this,fr),"https://www.reddit.com").toString()}),d(this,R,t)}get id(){return n(this,hr)}get name(){return n(this,x)}get createdAt(){return n(this,ds)}get type(){return n(this,ls)}get title(){return n(this,us)}get description(){return n(this,cs)}get language(){return n(this,ms)}get numberOfSubscribers(){return n(this,ps)}get numberOfActiveUsers(){return n(this,gs)}get nsfw(){return n(this,hs)}get settings(){return n(this,fs)}get userFlairsEnabled(){return this.settings.userFlairs.enabled}get postFlairsEnabled(){return this.settings.postFlairs.enabled}get usersCanAssignUserFlairs(){return this.settings.userFlairs.usersCanAssign}get usersCanAssignPostFlairs(){return this.settings.postFlairs.usersCanAssign}get url(){return this.settings.url}get permalink(){return n(this,fr)}toJSON(){return{id:this.id,name:this.name,createdAt:this.createdAt,type:this.type,title:this.title,description:this.description,language:this.language,nsfw:this.nsfw,numberOfSubscribers:this.numberOfSubscribers,numberOfActiveUsers:this.numberOfActiveUsers,settings:this.settings}}async submitPost(e){let t={...e,subredditName:n(this,x)};return G.submit(t,n(this,R))}getControversialPosts(e={}){if(!n(this,x))throw new Error("subreddit missing displayName - it might not have been fetched");return G.getControversialPosts({...e,subredditName:n(this,x)},n(this,R))}getTopPosts(e={}){if(!n(this,x))throw new Error("subreddit missing displayName - it might not have been fetched");return G.getTopPosts({...e,subredditName:n(this,x)},n(this,R))}getApprovedUsers(e={}){return C.getSubredditUsersByType({type:"contributors",subredditName:n(this,x),...e},n(this,R))}approveUser(e){return C.createRelationship({username:e,subredditName:n(this,x),type:"contributor"},n(this,R))}removeUser(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"contributor"},n(this,R))}getWikiContributors(e={}){return C.getSubredditUsersByType({type:"wikicontributors",subredditName:n(this,x),...e},n(this,R))}addWikiContributor(e){return C.createRelationship({username:e,subredditName:n(this,x),type:"wikicontributor"},n(this,R))}removeWikiContributor(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"wikicontributor"},n(this,R))}getBannedUsers(e={}){return C.getSubredditUsersByType({type:"banned",subredditName:n(this,x),...e},n(this,R))}banUser(e){return C.createRelationship({username:e.username,subredditName:n(this,x),type:"banned",banReason:e.reason,banMessage:e.message,note:e.note,duration:e.duration,banContext:e.context},n(this,R))}unbanUser(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"banned"},n(this,R))}getBannedWikiContributors(e={}){return C.getSubredditUsersByType({type:"wikibanned",subredditName:n(this,x),...e},n(this,R))}banWikiContributor(e){return C.createRelationship({username:e.username,subredditName:n(this,x),type:"wikibanned",banReason:e.reason,note:e.note,duration:e.duration},n(this,R))}unbanWikiContributor(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"wikibanned"},n(this,R))}getModerators(e={}){return C.getSubredditUsersByType({type:"moderators",subredditName:n(this,x),...e},n(this,R))}inviteModerator(e,t){return C.createRelationship({type:"moderator_invite",subredditName:n(this,x),username:e,permissions:t??[]},n(this,R))}revokeModeratorInvite(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"moderator_invite"},n(this,R))}removeModerator(e){return C.removeRelationship({type:"moderator",subredditName:n(this,x),username:e},n(this,R))}setModeratorPermissions(e,t){return C.setModeratorPermissions(e,n(this,x),t,n(this,R))}getMutedUsers(e={}){return C.getSubredditUsersByType({type:"muted",subredditName:n(this,x),...e},n(this,R))}muteUser(e,t){return C.createRelationship({username:e,subredditName:n(this,x),type:"muted",note:t},n(this,R))}unmuteUser(e){return C.removeRelationship({username:e,subredditName:n(this,x),type:"muted"},n(this,R))}getModerationLog(e){return to({subredditName:n(this,x),...e},n(this,R))}getUserFlairTemplates(){return ne.getUserFlairTemplates(n(this,x),n(this,R))}getPostFlairTemplates(){return ne.getPostFlairTemplates(n(this,x),n(this,R))}createPostFlairTemplate(e){return ne.createPostFlairTemplate({subredditName:n(this,x),...e},n(this,R))}createUserFlairTemplate(e){return ne.createUserFlairTemplate({subredditName:n(this,x),...e},n(this,R))}async getUserFlair(e){if(e?.usernames!==void 0)return{users:await Promise.all(e.usernames.map(async r=>{let s=await ce.getUserFlairBySubreddit({subreddit:n(this,x),name:r},n(this,R));return gn(s.users[0])}))};{let t=await ce.getUserFlairBySubreddit({...e,subreddit:n(this,x)},n(this,R));return{next:t.next,prev:t.prev,users:t.users.map(r=>gn(r))}}}getModQueue(e={type:"all"}){return Ae.aboutLocation({...e,location:"modqueue",subreddit:n(this,x)},n(this,R))}getReports(e={type:"all"}){return Ae.aboutLocation({...e,location:"reports",subreddit:n(this,x)},n(this,R))}getSpam(e={type:"all"}){return Ae.aboutLocation({...e,location:"spam",subreddit:n(this,x)},n(this,R))}getUnmoderated(e={type:"all"}){return Ae.aboutLocation({...e,location:"unmoderated",subreddit:n(this,x)},n(this,R))}getEdited(e={type:"all"}){return Ae.aboutLocation({...e,location:"edited",subreddit:n(this,x)},n(this,R))}static aboutLocation(e,t){let r=u.redditAPIPlugins.Moderation,s;switch(e.type){case"post":s="links";break;case"comment":s="comments";break;default:s=void 0}return new V({...e,fetch:async o=>{let a=await r.AboutLocation({...o,...e,only:s},t);return Gc(a,t)}})}getCommentsAndPostsByIds(e){let t=u.redditAPIPlugins.LinksAndComments;return new V({fetch:async()=>{let r=await t.Info({thingIds:e,subreddits:[n(this,hr)]},n(this,R));return Gc(r,n(this,R))}})}static async addRemovalReason(e,t,r,s){return(await u.redditAPIPlugins.Subreddits.SubredditAddRemovalReason({title:t,message:r,subreddit:e},s)).id}static async getRemovalReasons(e,t){let s=await u.redditAPIPlugins.Subreddits.SubredditGetRemovalReasons({subreddit:e},t);return s.order.map(o=>({...s.data[o]}))}static async getFromMetadata(e){p(e);let t=e?.[P.SubredditName]?.values[0];if(t)return Ae.getByName(t,e);let r=e?.[P.Subreddit]?.values[0];return p(r),Ae.getById(K(r),e)}static async getById(e,t){let r=await ea(e,t);if(r)return Ae.getByName(r,t)}static async getByName(e,t){let s=await u.redditAPIPlugins.Subreddits.SubredditAbout({subreddit:e},t);if(!s?.data)throw new Error("not found");return new Ae(s.data,t)}};hr=new WeakMap,x=new WeakMap,ds=new WeakMap,ls=new WeakMap,us=new WeakMap,cs=new WeakMap,ms=new WeakMap,ps=new WeakMap,gs=new WeakMap,hs=new WeakMap,fs=new WeakMap,fr=new WeakMap,R=new WeakMap;var le=Ae;async function $d(i,e){let o=(await Z.query("GetSubredditInfoById","315a9b75c22a017d526afdf2d274616946156451aacfd56dfb91e7ad3f7a2fde",{id:i},e)).data?.subredditInfoById;if(!o)throw new Error("subreddit info not found");return o.type&&(o.type=od(o.type)),o}async function qd(i,e){let o=(await Z.query("GetSubredditInfoByName","4aa69726c7e3f5d33ab2bee22b3d74fce645824fddd5ea3ec6dfe30bdb4295cb",{name:i},e)).data?.subredditInfoByName;if(!o)throw new Error("subreddit info not found");return o.type&&(o.type=od(o.type)),o}async function Kd(i,e){let o=(await Z.query("GetSubredditLeaderboard","18ead70c46b6446d45ecd8b679b16d9a929a933d6ef25d8262a459cb18b72848",{id:i},e)).data?.subredditInfoById?.leaderboard;if(!o)throw new Error("subreddit leaderboard not found");if(!o.summary)throw new Error("subreddit leaderboard summary not found");return{id:o.id,summary:o.summary}}async function Xd(i,e){let o=(await Z.query("GetSubredditStyles","d491d17ea8858f563ea578b26b9595d64adecf4bf34557d567c7e53c470f5f22",{id:i},e)).data?.subredditInfoById?.styles;if(!o)throw new Error("subreddit styles not found");return o}function od(i){let e=i?.toLowerCase();if(e==="public"||e==="private"||e==="restricted"||e==="employees_only"||e==="gold_only"||e==="gold_restricted"||e==="archived"||e==="user")return e;throw new Error(`invalid subreddit type: ${i}`)}function Dg(i){if(i==="any"||i==="link"||i==="self")return i;throw new Error(`invalid allowed post type: ${i}`)}function Bg(i){if(i==="animated"||i==="giphy"||i==="static"||i==="expression")return i;throw new Error(`invalid comment media type: ${i}`)}function Gc(i,e){let r=(i.data?.children??[]).map(a=>{let c=s(a);if(c!=null)return c;let m=o(a);return m??null}).filter(Boolean);return{after:i.data?.after,before:i.data?.before,children:r};function s(a){try{return new G(a.data,e)}catch{return null}}function o(a){try{return new Y(a.data,e)}catch{return null}}}async function ea(i,e){return(await u.redditAPIPlugins.LinksAndComments.Info({thingIds:[i],subreddits:[]},e)).data?.children[0]?.data?.displayName}async function Zd(i,e){return Jc("GetVaultContactByAddress","3e2f7966a5c120e64fd2795d06a46595c52d988185be98d3ed71c3f81ae80d2e",{provider:"ethereum",address:i},e)}async function Qd(i,e){return Jc("GetVaultContactByUserId","a854ddc19d0e22c4f36ed917fdbd568f299f3571427e393aee5e2972080fffe9",{provider:"ethereum",userId:i},e)}async function Jc(i,e,t,r){let o=(await Z.query(i,e,t,r))?.data?.vault?.contact;return{provider:o?.provider,userId:ie(o?.userId),address:o?.address,createdAt:o?.createdAt,isActive:o?.isActive}}import{CommunityListWidget_CommunityData as Ng,GetWidgetsResponse_WidgetItem as ae}from"@devvit/protos";var ws,Fs,xs,Is,dd=class dd{constructor(e,t,r){l(this,ws);l(this,Fs);l(this,xs);l(this,Is);X(this),d(this,ws,e.id),d(this,Fs,e.shortName),d(this,xs,t),d(this,Is,r)}get id(){return n(this,ws)}get name(){return n(this,Fs)}get subredditName(){return n(this,xs)}toJSON(){return{id:this.id,name:this.name,subredditName:this.subredditName}}delete(){return dd.delete(this.subredditName,this.id,n(this,Is))}static async getWidgets(e,t){let s=await u.redditAPIPlugins.Widgets.GetWidgets({subreddit:e},t);p(s.layout,"Failed to load widgets for subreddit");let o=s.items,a=[];for(let c of s.layout.sidebar?.order??[]){let m=o[c];switch(m?.kind){case"image":a.push(new ys(m,e,t));break;case"calendar":a.push(new bs(m,e,t));break;case"textarea":a.push(new vs(m,e,t));break;case"button":a.push(new ks(m,e,t));break;case"community-list":a.push(new Cs(m,e,t));break;case"post-flair":a.push(new Ps(m,e,t));break;case"custom":a.push(new Ss(m,e,t));break;case"subreddit-rules":{let y=await u.redditAPIPlugins.Subreddits.SubredditAboutRules({subreddit:e},t);a.push(new ad(y,m,e,t));break}default:throw new Error(`Unknown widget type: ${m.kind}`)}}return a}static async delete(e,t,r){await u.redditAPIPlugins.Widgets.DeleteWidget({subreddit:e,id:t},r)}static async reorder(e,t,r){await u.redditAPIPlugins.Widgets.OrderWidgets({subreddit:e,order:t},r)}static async add(e,t){switch(e.styles={backgroundColor:e.styles?.backgroundColor??"",headerColor:e.styles?.headerColor??""},e?.type){case"image":return ys.create(e,t);case"calendar":return bs.create(e,t);case"textarea":return vs.create(e,t);case"button":return ks.create(e,t);case"community-list":return Cs.create(e,t);case"post-flair":return Ps.create(e,t);case"custom":return Ss.create(e,t);default:throw new Error(`Unknown widget type: ${e}`)}}static async patch(e,t){switch(e.styles={backgroundColor:e.styles?.backgroundColor??"",headerColor:e.styles?.headerColor??""},e?.type){case"image":return ys.update(e,t);case"calendar":return bs.update(e,t);case"textarea":return vs.update(e,t);case"button":return ks.update(e,t);case"community-list":return Cs.update(e,t);case"post-flair":return Ps.update(e,t);case"custom":return Ss.update(e,t);default:throw new Error(`Unknown widget type: ${e}`)}}};ws=new WeakMap,Fs=new WeakMap,xs=new WeakMap,Is=new WeakMap;var ee=dd,Ts,_o=class _o extends ee{constructor(t,r,s){super(t,r,s);l(this,Ts);d(this,Ts,t.data.map(o=>(p(o.url,"Image widget data is missing url"),p(o.height,"Image widget data is missing height"),p(o.width,"Image widget data is missing width"),{url:o.url,height:o.height,width:o.width,linkUrl:o.linkUrl??""})))}get images(){return n(this,Ts)}toJSON(){return{...super.toJSON(),images:this.images}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddImageWidget(t,r);return new _o(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateImageWidget(t,r);return new _o(ae.fromJSON(o),t.subreddit,r)}};Ts=new WeakMap;var ys=_o,As,Es,Rs,Ho=class Ho extends ee{constructor(t,r,s){super(t,r,s);l(this,As);l(this,Es);l(this,Rs);p(t.googleCalendarId,"Calendar widget data is missing googleCalendarId"),p(t.configuration,"Calendar widget data is missing configuration"),p(t.styles,"Calendar widget data is missing styles"),d(this,As,t.googleCalendarId),d(this,Es,t.configuration),d(this,Rs,t.styles)}get googleCalendarId(){return n(this,As)}get configuration(){return n(this,Es)}get styles(){return n(this,Rs)}toJSON(){return{...super.toJSON(),googleCalendarId:this.googleCalendarId,configuration:this.configuration,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCalendarWidget(t,r);return new Ho(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCalendarWidget(t,r);return new Ho(ae.fromJSON(o),t.subreddit,r)}};As=new WeakMap,Es=new WeakMap,Rs=new WeakMap;var bs=Ho,Os,Us,jo=class jo extends ee{constructor(t,r,s){super(t,r,s);l(this,Os);l(this,Us);p(t.text,"Textarea widget data is missing text"),p(t.styles,"Textarea widget data is missing styles"),d(this,Os,t.text),d(this,Us,t.styles)}get text(){return n(this,Os)}get styles(){return n(this,Us)}toJSON(){return{...super.toJSON(),text:this.text,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddTextAreaWidget(t,r);return new jo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateTextAreaWidget(t,r);return new jo(ae.fromJSON(o),t.subreddit,r)}};Os=new WeakMap,Us=new WeakMap;var vs=jo,Ms,Ds,Bs,Wo=class Wo extends ee{constructor(t,r,s){super(t,r,s);l(this,Ms);l(this,Ds);l(this,Bs);p(t.styles,"Button widget data is missing styles"),d(this,Ms,t.buttons),d(this,Ds,t.description??""),d(this,Bs,t.styles)}get buttons(){return n(this,Ms)}get description(){return n(this,Ds)}get styles(){return n(this,Bs)}toJSON(){return{...super.toJSON(),buttons:this.buttons,description:this.description,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddButtonWidget(t,r);return new Wo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateButtonWidget(t,r);return new Wo(ae.fromJSON(o),t.subreddit,r)}};Ms=new WeakMap,Ds=new WeakMap,Bs=new WeakMap;var ks=Wo,Ns,Ls,Vo=class Vo extends ee{constructor(t,r,s){super(t,r,s);l(this,Ns);l(this,Ls);d(this,Ns,t.data.map(o=>Ng.fromJSON(o))),p(t.styles,"Community list widget data is missing styles"),d(this,Ls,t.styles)}get communities(){return n(this,Ns)}get styles(){return n(this,Ls)}toJSON(){return{...super.toJSON(),communities:this.communities,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCommunityListWidget(t,r);return new Vo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCommunityListWidget(t,r);return new Vo(ae.fromJSON(o),t.subreddit,r)}};Ns=new WeakMap,Ls=new WeakMap;var Cs=Vo,_s,Hs,js,Go=class Go extends ee{constructor(t,r,s){super(t,r,s);l(this,_s);l(this,Hs);l(this,js);if(p(t.styles,"Post flair widget data is missing styles"),d(this,_s,t.styles),d(this,Hs,t.order.map(o=>t.templates[o])),!(t.display&&t.display==="list"||t.display==="cloud"))throw new Error("Post flair widget data is missing display type");d(this,js,t.display)}get styles(){return n(this,_s)}get templates(){return n(this,Hs)}get display(){return n(this,js)}toJSON(){return{...super.toJSON(),styles:this.styles,templates:this.templates,display:this.display}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddPostFlairWidget(t,r);return new Go(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdatePostFlairWidget(t,r);return new Go(ae.fromJSON(o),t.subreddit,r)}};_s=new WeakMap,Hs=new WeakMap,js=new WeakMap;var Ps=Go,Ws,Vs,Gs,Js,zs,Jo=class Jo extends ee{constructor(t,r,s){super(t,r,s);l(this,Ws);l(this,Vs);l(this,Gs);l(this,Js);l(this,zs);p(t.stylesheetUrl,"Custom widget data is missing stylesheetUrl"),p(t.height,"Custom widget data is missing height"),p(t.css,"Custom widget data is missing css"),d(this,Ws,t.imageData??[]),d(this,Vs,t.text??""),d(this,Gs,t.stylesheetUrl),d(this,Js,t.height),d(this,zs,t.css)}get images(){return n(this,Ws)}get text(){return n(this,Vs)}get stylesheetUrl(){return n(this,Gs)}get height(){return n(this,Js)}get css(){return n(this,zs)}toJSON(){return{...super.toJSON(),images:this.images,text:this.text,stylesheetUrl:this.stylesheetUrl,height:this.height,css:this.css}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCustomWidget(t,r);return new Jo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCustomWidget(t,r);return new Jo(ae.fromJSON(o),t.subreddit,r)}};Ws=new WeakMap,Vs=new WeakMap,Gs=new WeakMap,Js=new WeakMap,zs=new WeakMap;var Ss=Jo,$s,ad=class extends ee{constructor(t,r,s,o){super(r,s,o);l(this,$s);let a=t.rules.map(({description:c,priority:m,shortName:y,violationReason:v})=>(p(c,"Subreddit rule is missing description"),p(m,"Subreddit rule is missing priority"),p(y,"Subreddit rule is missing shortName"),p(v,"Subreddit rule is missing violationReason"),{description:c,priority:m,shortName:y,violationReason:v}));d(this,$s,a)}get rules(){return n(this,$s)}toJSON(){return{...super.toJSON(),rules:this.rules}}};$s=new WeakMap;var Lg=(r=>(r[r.SUBREDDIT_PERMISSIONS=0]="SUBREDDIT_PERMISSIONS",r[r.APPROVED_CONTRIBUTORS_ONLY=1]="APPROVED_CONTRIBUTORS_ONLY",r[r.MODS_ONLY=2]="MODS_ONLY",r))(Lg||{}),zc="WikiPageRevision_",ge,he,yr,br,vr,kr,Cr,Pr,Ee,we=class we{constructor(e,t,r,s){l(this,ge);l(this,he);l(this,yr);l(this,br);l(this,vr);l(this,kr);l(this,Cr);l(this,Pr);l(this,Ee);X(this),d(this,ge,e),d(this,he,t),d(this,yr,r.contentMd),d(this,br,r.contentHtml),d(this,vr,r.revisionId),d(this,kr,new Date(r.revisionDate*1e3)),d(this,Cr,r.reason??""),d(this,Pr,r.revisionBy?.data?new C(r.revisionBy.data,s):void 0),d(this,Ee,s)}get name(){return n(this,ge)}get subredditName(){return n(this,he)}get content(){return n(this,yr)}get contentHtml(){return n(this,br)}get revisionId(){return n(this,vr)}get revisionDate(){return n(this,kr)}get revisionReason(){return n(this,Cr)}get revisionAuthor(){return n(this,Pr)}toJSON(){return{name:n(this,ge),subredditName:n(this,he),content:n(this,yr),contentHtml:n(this,br),revisionId:n(this,vr),revisionDate:n(this,kr),revisionReason:n(this,Cr),revisionAuthor:n(this,Pr)?.toJSON()}}async update(e,t){return we.updatePage({subredditName:n(this,he),page:n(this,ge),content:e,reason:t},n(this,Ee))}async getRevisions(e){return we.getPageRevisions({subredditName:n(this,he),page:n(this,ge),...e},n(this,Ee))}async revertTo(e){return we.revertPage(n(this,he),n(this,ge),e,n(this,Ee))}async getSettings(){return we.getPageSettings(n(this,he),n(this,ge),n(this,Ee))}async updateSettings(e){return we.updatePageSettings({subredditName:n(this,he),page:n(this,ge),listed:e.listed,permLevel:e.permLevel},n(this,Ee))}async addEditor(e){return we.addEditor(n(this,he),n(this,ge),e,n(this,Ee))}async removeEditor(e){return we.removeEditor(n(this,he),n(this,ge),e,n(this,Ee))}static async getPage(e,t,r,s){let a=await u.redditAPIPlugins.Wiki.GetWikiPage({subreddit:e,page:t,revisionId:r},s);return p(a.data,"Failed to get wiki page"),new we(t,e,a.data,s)}static async getPages(e,t){return(await u.redditAPIPlugins.Wiki.GetWikiPages({subreddit:e},t)).data||[]}static async createPage(e,t){return we.updatePage(e,t)}static async updatePage(e,t){return await u.redditAPIPlugins.Wiki.EditWikiPage({subreddit:e.subredditName,page:e.page,content:e.content,reason:e.reason??""},t),we.getPage(e.subredditName,e.page,void 0,t)}static getPageRevisions(e,t){let r=u.redditAPIPlugins.Wiki,s=$c(e.after),o=$c(e.before);return new V({hasMore:!0,after:s,before:o,limit:e.limit,pageSize:e.pageSize,async fetch(a){let c=await r.GetWikiPageRevisions({subreddit:e.subredditName,page:e.page??"",limit:a.limit,after:a.after,before:a.before},t);return _g(c,t)}})}static async revertPage(e,t,r,s){await u.redditAPIPlugins.Wiki.RevertWikiPage({subreddit:e,page:t,revision:r},s)}static async getPageSettings(e,t,r){let o=await u.redditAPIPlugins.Wiki.GetWikiPageSettings({subreddit:e,page:t},r);return p(o.data,"Failed to get wiki page settings"),new zo(o.data,r)}static async updatePageSettings(e,t){let s=await u.redditAPIPlugins.Wiki.UpdateWikiPageSettings({subreddit:e.subredditName,page:e.page,listed:e.listed?"on":"",permlevel:e.permLevel},t);return p(s.data,"Failed to update wiki page settings"),new zo(s.data,t)}static async addEditor(e,t,r,s){await u.redditAPIPlugins.Wiki.AllowEditor({act:"add",subreddit:e,page:t,username:r},s)}static async removeEditor(e,t,r,s){await u.redditAPIPlugins.Wiki.AllowEditor({act:"del",subreddit:e,page:t,username:r},s)}};ge=new WeakMap,he=new WeakMap,yr=new WeakMap,br=new WeakMap,vr=new WeakMap,kr=new WeakMap,Cr=new WeakMap,Pr=new WeakMap,Ee=new WeakMap;var ue=we,Sr,wr,Fr,xr,Ir,Tr,ld=class{constructor(e,t){l(this,Sr);l(this,wr);l(this,Fr);l(this,xr);l(this,Ir);l(this,Tr);d(this,Sr,e.id),d(this,wr,e.page),d(this,Fr,new Date(e.timestamp)),p(e.author?.data,"Wiki page revision author details are missing"),d(this,xr,new C(e.author.data,t)),d(this,Ir,e.reason??""),d(this,Tr,e.revisionHidden??!1)}get id(){return n(this,Sr)}get page(){return n(this,wr)}get date(){return n(this,Fr)}get author(){return n(this,xr)}get reason(){return n(this,Ir)}get hidden(){return n(this,Tr)}toJSON(){return{id:n(this,Sr),page:n(this,wr),date:n(this,Fr),author:n(this,xr).toJSON(),reason:n(this,Ir),hidden:n(this,Tr)}}};Sr=new WeakMap,wr=new WeakMap,Fr=new WeakMap,xr=new WeakMap,Ir=new WeakMap,Tr=new WeakMap;var Ar,Er,Rr,zo=class{constructor(e,t){l(this,Ar);l(this,Er);l(this,Rr);d(this,Ar,e.listed),d(this,Er,e.permLevel),d(this,Rr,e.editors.map(r=>(p(r.data,"Wiki page editor details are missing"),new C(r.data,t))))}get listed(){return n(this,Ar)}get permLevel(){return n(this,Er)}get editors(){return n(this,Rr)}toJSON(){return{listed:n(this,Ar),permLevel:n(this,Er),editors:n(this,Rr).map(e=>e.toJSON())}}};Ar=new WeakMap,Er=new WeakMap,Rr=new WeakMap;function _g(i,e){return p(i.data?.children,"Wiki page revision listing is missing children"),{children:i.data.children.map(r=>new ld(r,e)),before:i.data.before,after:i.data.after}}function $c(i){if(i)return i.startsWith(zc)?i:`${zc}${i}`}var Hg=["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"],jg=["border-image","border-image-source","behavior","expression","list-style-image","cursor","content"],Wg=["onload","onerror","onclick","onmouseover"];function Vg(i){return/xmlns=["']http:\/\/www\.w3\.org\/2000\/svg["']/.test(i)?i:i.replace(/<svg\b/,'<svg xmlns="http://www.w3.org/2000/svg"')}function qc(i){if(i){if(!i.trim().startsWith("<svg")){console.log("The provided string is not a valid SVG.");return}try{let e=new RegExp(`<\\s*(${Hg.join("|")})\\b`,"gi"),t=new RegExp(`(${jg.join("|")})\\s*:\\s*url\\s*\\((['"]?)(.*?)\\2\\)`,"gi"),r=new RegExp(`(${Wg.join("|")})\\s*(=\\s*(['"]?)(.*?)\\3)?`,"gi");i=i.trim().replace(/\s+/g," "),i=Vg(i);let s=i.match(e)||[],o=i.match(t)||[],a=i.match(r)||[],c=!1;return s.length>0&&(c=!0,console.warn(`Disallowed elements detected in SVG: ${s.map(m=>m.replace("<","")).join(", ")}`)),o.length>0&&(c=!0,console.warn(`Disallowed styles detected in SVG: ${o.map(m=>m.split(":")[0]).join(", ")}`)),a.length>0&&(c=!0,console.warn(`Disallowed attributes detected in SVG: ${a.map(m=>m.split("=")[0]).join(", ")}`)),c?void 0:i}catch{return}}}function ZS(i,...e){let t="";return i.forEach((r,s)=>{t+=r;let o=e[s];o!==void 0&&(t+=`${o}`)}),t=qc(t),t===void 0?"":`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(t)}`}import{EffectType as Zc}from"@devvit/protos";import{WebViewVisibility as Gg}from"@devvit/protos";var Kc="/api/";var Xc=i=>i===null||typeof i!="object"?!1:"scope"in i&&i.scope===0&&"type"in i&&i.type==="devvit-internal";var Or,Ot,qs,Ur,oi,Ks,Xs,ud=class{constructor(e,t){this.state={messageCount:0,isMounted:!1};l(this,Or);l(this,Ot);l(this,qs);l(this,Ur);l(this,oi);l(this,Ks);this.postMessage=e=>{try{let t=JSON.stringify(e);n(this,oi).emitEffect(`postMessage${this.state.messageCount++}`,{type:Zc.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:n(this,Or),app:{message:e,jsonString:t}}}})}catch(t){throw console.error(rt.caughtToString(t)),Error("Something went wrong. Please check the contents of your postMessage.")}};this.mount=()=>{if(this.state.isMounted){console.warn("Webview is already mounted!");return}let e=n(this,oi)?.devvitContext?.assets,t;if(n(this,Ot).startsWith(Kc))t=n(this,Ot);else{let r=n(this,Ot).replace(/[#?].*/,"");t=`${e.getURL(r,{webView:!0})}${n(this,Ot).slice(r.length)}`}if(!t)throw Error("useWebView fullscreen request failed; web view asset could not be found");n(this,Xs).call(this,!0,t)};this.unmount=()=>{n(this,Xs).call(this,!1,"")};l(this,Xs,(e,t)=>{n(this,oi).emitEffect("fullscreen",{type:Zc.EFFECT_WEB_VIEW,webView:{fullscreen:{id:n(this,Or),show:e,url:t}}})});d(this,Ot,t.url??"index.html"),d(this,Or,e.hookId),d(this,qs,t.onMessage),d(this,Ur,t.onUnmount),d(this,oi,e.context),d(this,Ks,e.invalidate)}onStateLoaded(){}async onUIEvent(e){if(e.webView?.fullScreen){let t=e.webView.fullScreen.visibility===Gg.WEBVIEW_VISIBLE;this.state.isMounted=t,n(this,Ks).call(this),!t&&n(this,Ur)&&await n(this,Ur).call(this,this)}else if(e.webView?.postMessage){let t=e.webView.postMessage.jsonString?JSON.parse(e.webView.postMessage.jsonString):e.webView.postMessage.message;if(Xc(t))return;await n(this,qs).call(this,t,this)}}};Or=new WeakMap,Ot=new WeakMap,qs=new WeakMap,Ur=new WeakMap,oi=new WeakMap,Ks=new WeakMap,Xs=new WeakMap;function Jg(i){let e=me({namespace:"useWebView",initializer:t=>new ud(t,i)});return{postMessage:e.postMessage,mount:e.mount,unmount:e.unmount}}var zg="webbit.local";var $g=["/api","/internal"];async function qg(i,e,t){if(!$g.some(o=>e.startsWith(o)))throw new Error(`url must start with prefixes: /api or /internal. Got: ${e}`);let r=Object.entries(i.metadata??{}).reduce((o,[a,c])=>(o[a]=c.values[0],o),{}),s=new URL(e,`http://${zg}:3000/`);return await fetch(s,{...t,headers:{...t?.headers,...r}})}export{Ah as ALL_ICON_NAMES,zd as AboutLocations,Wc as AuthorFlairSettings,ks as ButtonWidget,bs as CalendarWidget,Y as Comment,Cs as CommunityListWidget,Ss as CustomWidget,Uh as DeletionReason,u as Devvit,Mh as EventSource,ce as Flair,ne as FlairTemplate,ug as FlairType,mP as GalleryMediaStatus,qe as Hook,ys as ImageWidget,V as Listing,Ug as ModMailActionType,Rg as ModMailConversationState,io as ModMailService,ve as ModNote,G as Post,Vc as PostFlairSettings,Ps as PostFlairWidget,Dt as PrivateMessage,qt as RichTextBuilder,te as RunAs,ze as SettingScope,xg as SocialLinkType,le as Subreddit,Hc as SubredditDescription,ad as SubredditRulesWidget,jc as SubredditWikiSettings,vs as TextAreaWidget,C as User,ee as Widget,ue as WikiPage,Lg as WikiPagePermissionLevel,ld as WikiPageRevision,zo as WikiPageSettings,pn as convertProtosFlairToCommonFlair,gn as convertUserFlairProtoToAPI,qg as fetchDevvitWeb,Jd as getCurrentUsernameFromMetadata,to as getModerationLog,$d as getSubredditInfoById,qd as getSubredditInfoByName,Kd as getSubredditLeaderboard,ea as getSubredditNameById,Xd as getSubredditStyles,Zd as getVaultByAddress,Qd as getVaultByUserId,ZS as svg,Zp as useAsync,Da as useChannel,Oa as useForm,La as useInterval,Wa as useState,Jg as useWebView};
/*! Bundled license information:

shallow-clone/index.js:
  (*!
   * shallow-clone <https://github.com/jonschlinkert/shallow-clone>
   *
   * Copyright (c) 2015-present, Jon Schlinkert.
   * Released under the MIT License.
   *)

isobject/index.js:
  (*!
   * isobject <https://github.com/jonschlinkert/isobject>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)

is-plain-object/index.js:
  (*!
   * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
//# sourceMappingURL=public-api.min.js.map
